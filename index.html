<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PneumoCare Pro | Academic Pulmonary Management</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --medical-deep-blue: #003366;
            --medical-blue: #005b8e;
            --medical-teal: #008c8c;
            --medical-green: #10b981;
            --medical-amber: #f59e0b;
            --medical-red: #ef4444;
            --medical-purple: #8b5cf6;
            --medical-cyan: #06b6d4;
            
            --gray-10: #f8fafc;
            --gray-50: #f1f5f9;
            --gray-100: #e2e8f0;
            --gray-200: #cbd5e1;
            --gray-300: #94a3b8;
            --gray-400: #64748b;
            --gray-500: #475569;
            --gray-600: #334155;
            --gray-700: #1e293b;
            --gray-800: #0f172a;
            
            --primary: var(--medical-deep-blue);
            --secondary: var(--medical-blue);
            --accent: var(--medical-teal);
            --success: var(--medical-green);
            --warning: var(--medical-amber);
            --error: var(--medical-red);
            
            --text-primary: var(--gray-800);
            --text-secondary: var(--gray-600);
            --background-primary: #f8fafc;
            --background-secondary: #ffffff;
            --border-light: var(--gray-200);
            
            --shadow-subtle: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 4px 6px -1px rgba(0, 0, 0, 0.08);
            --shadow-large: 0 10px 15px -3px rgba(0, 0, 0, 0.08);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-medium: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
            
            --border-radius-sm: 4px;
            --border-radius-md: 8px;
            --border-radius-lg: 12px;
            --border-radius-xl: 16px;
            
            --focus-ring: 0 0 0 3px rgba(0, 91, 142, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--background-primary);
            color: var(--text-primary);
            line-height: 1.6;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Login Container */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #003366 0%, #005b8e 100%);
            padding: 2rem;
        }

        .login-card {
            background: white;
            border-radius: var(--border-radius-xl);
            padding: 3rem;
            width: 100%;
            max-width: 480px;
            box-shadow: var(--shadow-xl);
        }

        .login-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--medical-blue), var(--medical-teal));
            border-radius: var(--border-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            margin: 0 auto 1.5rem;
        }

        .login-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--medical-deep-blue);
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .form-group {
            margin-bottom: 1.75rem;
        }

        .form-label {
            display: block;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.875rem 1.25rem;
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius-lg);
            background: var(--background-secondary);
            font-size: 0.95rem;
            transition: var(--transition-medium);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--medical-blue);
            box-shadow: var(--focus-ring);
        }

        .btn {
            background: var(--medical-blue);
            color: white;
            border: none;
            padding: 0.875rem 1.75rem;
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.925rem;
            transition: var(--transition-fast);
        }

        .btn:hover {
            background: var(--medical-deep-blue);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--medical-blue);
            color: var(--medical-blue);
        }

        .btn-outline:hover {
            background: var(--medical-blue);
            color: white;
        }

        .btn-sm {
            padding: 0.625rem 1.25rem;
            font-size: 0.875rem;
        }

        .btn-success {
            background: var(--medical-green);
        }

        .btn-danger {
            background: var(--medical-red);
        }

        .btn-warning {
            background: var(--medical-amber);
        }

        .btn-resident {
            background: var(--medical-purple);
        }

        .loading-spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(0, 91, 142, 0.2);
            border-radius: 50%;
            border-top-color: var(--medical-blue);
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--medical-blue);
            color: white;
            padding: 1.25rem 1.75rem;
            border-radius: var(--border-radius-lg);
            z-index: 1001;
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 0.875rem;
            max-width: 400px;
        }

        .toast.success {
            background: var(--medical-green);
        }

        .toast.error {
            background: var(--medical-red);
        }

        .toast.warning {
            background: var(--medical-amber);
        }

        /* App Container */
        .app-container {
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, 
                var(--medical-deep-blue) 0%, 
                #004080 50%, 
                var(--medical-blue) 100%);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: var(--shadow-large);
            z-index: 1000;
            border-right: 1px solid rgba(255,255,255,0.1);
            transition: var(--transition-medium);
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar-header {
            padding: 1.75rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: relative;
        }

        .collapse-toggle {
            position: absolute;
            right: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.12);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .brand-logo {
            width: 52px;
            height: 52px;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
            border-radius: var(--border-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .brand-text {
            color: white;
            flex: 1;
        }

        .brand-text h1 {
            font-size: 1.35rem;
            font-weight: 700;
            margin-bottom: 4px;
            letter-spacing: -0.25px;
        }

        .brand-text .subtitle {
            font-size: 0.8rem;
            opacity: 0.85;
            font-weight: 500;
            letter-spacing: 0.5px;
            color: rgba(255,255,255,0.8);
        }

        .sidebar-nav {
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            gap: 0.375rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.875rem 1.25rem;
            border: none;
            background: none;
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            color: rgba(255,255,255,0.85);
            transition: var(--transition-medium);
            font-size: 0.95rem;
            font-weight: 500;
            position: relative;
            text-align: left;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.12);
            color: white;
        }

        .nav-item.active {
            background: rgba(255,255,255,0.15);
            color: white;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition-medium);
        }

        .main-content.expanded {
            margin-left: 80px;
        }

        .content-header {
            background: var(--background-secondary);
            padding: 1.5rem 2.5rem;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-subtle);
        }

        .header-title h1 {
            font-size: 1.85rem;
            font-weight: 800;
            margin-bottom: 6px;
            color: var(--text-primary);
        }

        .header-title .subtitle {
            color: var(--text-secondary);
            font-size: 0.925rem;
            font-weight: 500;
        }

        .search-box {
            position: relative;
            width: 320px;
        }

        .search-box input {
            width: 100%;
            padding: 0.875rem 1.25rem 0.875rem 3rem;
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius-lg);
            background: var(--background-secondary);
            font-size: 0.925rem;
            transition: var(--transition-medium);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--medical-blue);
            box-shadow: var(--focus-ring);
        }

        .search-icon {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.625rem 0.875rem;
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: 700;
            font-size: 0.925rem;
        }

        .user-role {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--medical-purple), var(--medical-cyan));
            border-radius: var(--border-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 0.95rem;
        }

        .content-area {
            padding: 2.5rem;
            flex: 1;
        }

        .card {
            background: var(--background-secondary);
            border-radius: var(--border-radius-xl);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-medium);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .card-header {
            padding: 1.75rem 2rem;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 0.875rem;
            font-size: 1.35rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .card-content {
            padding: 2rem;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .metric-card {
            background: var(--background-secondary);
            border-radius: var(--border-radius-xl);
            padding: 2rem;
            border: 1px solid var(--border-light);
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--medical-blue), var(--medical-teal));
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--medical-blue);
            margin-bottom: 0.75rem;
            line-height: 1;
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        /* Status Indicators */
        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-available {
            background: rgba(0, 91, 142, 0.1);
            color: var(--medical-blue);
            border: 1px solid rgba(0, 91, 142, 0.2);
        }

        .status-approved {
            background: rgba(16, 185, 129, 0.1);
            color: var(--medical-green);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-offline {
            background: rgba(100, 116, 139, 0.1);
            color: var(--gray-500);
            border: 1px solid rgba(100, 116, 139, 0.2);
        }

        .status-busy {
            background: rgba(245, 158, 11, 0.1);
            color: var(--medical-amber);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .status-resident {
            background: rgba(139, 92, 246, 0.1);
            color: var(--medical-purple);
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        /* Person Cards */
        .person-card {
            display: flex;
            align-items: center;
            gap: 1.25rem;
            padding: 1.25rem;
            background: var(--background-secondary);
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--border-light);
            margin-bottom: 0.875rem;
        }

        .person-avatar {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--medical-blue), var(--medical-cyan));
            border-radius: var(--border-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
            font-weight: 800;
            flex-shrink: 0;
        }

        .person-info {
            flex: 1;
        }

        .person-name {
            font-weight: 800;
            margin-bottom: 4px;
            color: var(--text-primary);
            font-size: 1.05rem;
        }

        .person-clinic {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .person-meta {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 2px;
            line-height: 1.5;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 2rem;
        }

        .modal {
            background: var(--background-secondary);
            border-radius: var(--border-radius-xl);
            padding: 2.5rem;
            max-width: 640px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        .modal-large {
            max-width: 800px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-light);
        }

        .modal-title {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.875rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.75rem;
            cursor: pointer;
            color: var(--text-secondary);
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: var(--gray-50);
            color: var(--text-primary);
        }

        /* Loading State */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem;
            color: var(--text-secondary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--gray-300);
        }

        /* Form Actions */
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            padding-top: 1.75rem;
            border-top: 1px solid var(--border-light);
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1001;
            background: var(--medical-blue);
            color: white;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: var(--border-radius-lg);
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .login-container {
                padding: 1rem;
            }
            
            .login-card {
                padding: 2rem;
            }
            
            .sidebar {
                transform: translateX(-100%);
                width: 100%;
                max-width: 320px;
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .content-header {
                padding: 1.25rem;
                flex-direction: column;
                gap: 1.25rem;
            }
            
            .search-box {
                width: 100%;
            }
            
            .content-area {
                padding: 1.5rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .modal {
                margin: 1rem;
                padding: 1.75rem;
            }
            
            .mobile-menu-toggle {
                display: flex;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Login Screen -->
        <div v-if="!currentUser" class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <div class="login-logo">
                        <i class="fas fa-lungs"></i>
                    </div>
                    <h1 class="login-title">PneumoCare Pro</h1>
                    <div class="login-subtitle">Academic Pulmonary Management System</div>
                    
                    <div v-if="showSetupAdmin" style="margin-top: 1.5rem; padding: 1.5rem; background: rgba(0, 91, 142, 0.1); border-radius: var(--border-radius-lg);">
                        <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                            <i class="fas fa-user-shield" style="color: var(--medical-blue); font-size: 1.5rem;"></i>
                            <div>
                                <h3 style="color: var(--medical-blue); margin-bottom: 0.25rem;">First-Time Setup</h3>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">Create the system administrator account</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <form @submit.prevent="handleLogin">
                    <div v-if="showSetupAdmin" class="form-group">
                        <label class="form-label">System Administrator Setup</label>
                        <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
                            Create the first administrator account to manage the system.
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" v-model="loginForm.email" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" v-model="loginForm.password" required>
                    </div>
                    
                    <div v-if="!showSetupAdmin" class="form-group">
                        <label class="form-label">User Role</label>
                        <select class="form-select" v-model="loginForm.user_role" required>
                            <option value="system_admin">System Administrator</option>
                            <option value="resident_manager">Resident Manager</option>
                            <option value="department_head">Department Head</option>
                            <option value="viewing_doctor">Viewing Doctor</option>
                        </select>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn" style="width: 100%;" :disabled="loading">
                            <span v-if="loading" class="loading-spinner"></span>
                            <span v-else>
                                <i class="fas fa-sign-in-alt"></i> 
                                {{ showSetupAdmin ? 'Create Admin Account' : 'Sign In' }}
                            </span>
                        </button>
                    </div>
                </form>
                
                <div v-if="showSetupAdmin" style="margin-top: 2rem; padding: 1.5rem; background: rgba(16, 185, 129, 0.1); border-radius: var(--border-radius-lg);">
                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                        <i class="fas fa-info-circle" style="color: var(--medical-green);"></i>
                        <div style="font-weight: 600; color: var(--medical-green);">Setup Instructions</div>
                    </div>
                    <div style="font-size: 0.85rem; color: var(--text-secondary);">
                        <p>1. Create the system administrator account</p>
                        <p>2. After login, create other users from User Management</p>
                        <p>3. Assign appropriate roles and permissions</p>
                    </div>
                </div>
                
                <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-light);">
                    <div style="font-size: 0.8rem; color: var(--text-secondary); text-align: center;">
                        <i class="fas fa-shield-alt"></i> HIPAA Compliant • System ID: PC-2024-001
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <div v-else>
            <button class="mobile-menu-toggle" @click="toggleMobileMenu">
                <i class="fas fa-bars"></i>
            </button>

            <div class="app-container">
                <!-- Sidebar -->
                <div class="sidebar" :class="{ 
                    collapsed: sidebarCollapsed,
                    'mobile-open': mobileMenuOpen 
                }">
                    <div class="sidebar-header">
                        <div class="brand">
                            <div class="brand-logo">
                                <i class="fas fa-lungs"></i>
                            </div>
                            <div class="brand-text">
                                <h1>PneumoCare Pro</h1>
                                <div class="subtitle">ACADEMIC PULMONARY v4.0</div>
                            </div>
                        </div>
                        <button class="collapse-toggle" @click="sidebarCollapsed = !sidebarCollapsed">
                            <i class="fas" :class="sidebarCollapsed ? 'fa-chevron-right' : 'fa-chevron-left'"></i>
                        </button>
                    </div>
                    
                    <nav class="sidebar-nav">
                        <!-- System Admin Features -->
                        <div v-if="currentUser.user_role === 'system_admin'">
                            <button class="nav-item" :class="{ active: currentView === 'dashboard' }" 
                                    @click="switchView('dashboard'); closeMobileMenu()">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>Dashboard</span>
                            </button>
                            
                            <button class="nav-item" :class="{ active: currentView === 'user_management' }" 
                                    @click="switchView('user_management'); closeMobileMenu()">
                                <i class="fas fa-users-cog"></i>
                                <span>User Management</span>
                            </button>
                            
                            <button class="nav-item" :class="{ active: currentView === 'system_settings' }" 
                                    @click="switchView('system_settings'); closeMobileMenu()">
                                <i class="fas fa-cogs"></i>
                                <span>System Settings</span>
                            </button>
                        </div>
                        
                        <!-- Resident Manager Features -->
                        <div v-if="currentUser.user_role === 'resident_manager'">
                            <button class="nav-item" :class="{ active: currentView === 'medical_staff' }" 
                                    @click="switchView('medical_staff'); closeMobileMenu()">
                                <i class="fas fa-user-graduate"></i>
                                <span>Medical Staff</span>
                            </button>
                            
                            <button class="nav-item" :class="{ active: currentView === 'training_units' }" 
                                    @click="switchView('training_units'); closeMobileMenu()">
                                <i class="fas fa-hospital-alt"></i>
                                <span>Training Units</span>
                            </button>
                        </div>
                        
                        <!-- Department Head Features -->
                        <div v-if="currentUser.user_role === 'department_head'">
                            <button class="nav-item" :class="{ active: currentView === 'department_overview' }" 
                                    @click="switchView('department_overview'); closeMobileMenu()">
                                <i class="fas fa-chart-line"></i>
                                <span>Department Overview</span>
                            </button>
                            
                            <button class="nav-item" :class="{ active: currentView === 'staff_management' }" 
                                    @click="switchView('staff_management'); closeMobileMenu()">
                                <i class="fas fa-users"></i>
                                <span>Staff Management</span>
                            </button>
                        </div>
                        
                        <!-- Shared Features -->
                        <button class="nav-item" :class="{ active: currentView === 'daily_assignments' }" 
                                @click="switchView('daily_assignments'); closeMobileMenu()">
                            <i class="fas fa-calendar-day"></i>
                            <span>Daily Assignments</span>
                        </button>
                        
                        <button class="nav-item" :class="{ active: currentView === 'oncall_schedule' }" 
                                @click="switchView('oncall_schedule'); closeMobileMenu()">
                            <i class="fas fa-phone-alt"></i>
                            <span>On-call Schedule</span>
                        </button>
                        
                        <button class="nav-item" :class="{ active: currentView === 'leave_requests' }" 
                                @click="switchView('leave_requests'); closeMobileMenu()">
                            <i class="fas fa-calendar-times"></i>
                            <span>Leave Requests</span>
                        </button>
                        
                        <button class="nav-item" :class="{ active: currentView === 'announcements' }" 
                                @click="switchView('announcements'); closeMobileMenu()">
                            <i class="fas fa-bullhorn"></i>
                            <span>Announcements</span>
                        </button>
                    </nav>
                    
                    <div style="padding: 1.75rem; margin-top: auto; border-top: 1px solid rgba(255,255,255,0.1);">
                        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6); text-align: center; font-weight: 500;">
                            <div>Logged in as: <strong>{{ getUserRoleDisplay(currentUser.user_role) }}</strong></div>
                            <div style="margin-top: 0.25rem; font-size: 0.7rem;">
                                {{ currentUser.full_name }}
                            </div>
                            <button @click="handleLogout" 
                                    style="margin-top: 1rem; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 0.5rem 1rem; border-radius: var(--border-radius-md); font-size: 0.7rem; cursor: pointer; width: 100%;">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="main-content" :class="{ expanded: sidebarCollapsed }">
                    <header class="content-header">
                        <div class="header-title">
                            <h1>{{ getCurrentTitle() }}</h1>
                            <div class="subtitle">{{ getCurrentSubtitle() }}</div>
                        </div>
                        <div class="header-actions">
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" 
                                       v-model="searchQuery" 
                                       :placeholder="getSearchPlaceholder()">
                            </div>
                            <div class="user-profile" @click="toggleUserMenu">
                                <div class="user-info">
                                    <div class="user-name">{{ currentUser.full_name }}</div>
                                    <div class="user-role">{{ getUserRoleDisplay(currentUser.user_role) }}</div>
                                </div>
                                <div class="user-avatar">{{ getInitials(currentUser.full_name) }}</div>
                            </div>
                        </div>
                    </header>

                    <div class="content-area">
                        <div v-if="loading" class="loading-state">
                            <div class="loading-spinner"></div>
                            <p style="margin-top: 1rem;">Loading system data...</p>
                        </div>

                        <!-- Dashboard (System Admin) -->
                        <div v-if="currentView === 'dashboard' && currentUser.user_role === 'system_admin'">
                            <div class="metrics-grid">
                                <div class="metric-card">
                                    <div class="metric-value">{{ adminStats.totalUsers }}</div>
                                    <div class="metric-label">Total Users</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                        Active: {{ adminStats.activeUsers }}
                                    </div>
                                </div>
                                
                                <div class="metric-card">
                                    <div class="metric-value">{{ adminStats.totalStaff }}</div>
                                    <div class="metric-label">Medical Staff</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                        Residents: {{ adminStats.residents }}
                                    </div>
                                </div>

                                <div class="metric-card">
                                    <div class="metric-value">{{ adminStats.totalUnits }}</div>
                                    <div class="metric-label">Training Units</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                        Active: {{ adminStats.activeUnits }}
                                    </div>
                                </div>

                                <div class="metric-card">
                                    <div class="metric-value">{{ adminStats.systemUptime }}%</div>
                                    <div class="metric-label">System Uptime</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                        Last updated: Today
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-tachometer-alt"></i>
                                        System Overview
                                    </div>
                                    <button class="btn" @click="generateSystemReport">
                                        <i class="fas fa-download"></i> Generate Report
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                                        <div>
                                            <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Recent Activity</h3>
                                            <div style="color: var(--text-secondary); font-size: 0.9rem; padding: 1rem; background: var(--gray-50); border-radius: var(--border-radius-lg);">
                                                <p>System is running normally</p>
                                                <p>All services operational</p>
                                                <p>No critical alerts</p>
                                            </div>
                                        </div>
                                        <div>
                                            <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Quick Actions</h3>
                                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                                <button class="btn" @click="openAddUserModal">
                                                    <i class="fas fa-user-plus"></i> Add New User
                                                </button>
                                                <button class="btn btn-outline" @click="switchView('system_settings')">
                                                    <i class="fas fa-cogs"></i> System Settings
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- User Management (System Admin) -->
                        <div v-else-if="currentView === 'user_management' && currentUser.user_role === 'system_admin'">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-users-cog"></i>
                                        User Management
                                    </div>
                                    <button class="btn" @click="openAddUserModal">
                                        <i class="fas fa-user-plus"></i> Add New User
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div class="metrics-grid">
                                        <div class="metric-card">
                                            <div class="metric-value">{{ adminStats.totalUsers }}</div>
                                            <div class="metric-label">Total Users</div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="metric-value">{{ adminStats.activeUsers }}</div>
                                            <div class="metric-label">Active Users</div>
                                        </div>

                                        <div class="metric-card">
                                            <div class="metric-value">{{ adminStats.inactiveUsers }}</div>
                                            <div class="metric-label">Inactive Users</div>
                                        </div>

                                        <div class="metric-card">
                                            <div class="metric-value">{{ getRoleCount('system_admin') }}</div>
                                            <div class="metric-label">System Admins</div>
                                        </div>
                                    </div>

                                    <div style="margin-top: 2rem;">
                                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                                            <select class="form-select" style="width: 180px;" v-model="userFilter.user_role">
                                                <option value="">All Roles</option>
                                                <option value="system_admin">System Administrator</option>
                                                <option value="resident_manager">Resident Manager</option>
                                                <option value="department_head">Department Head</option>
                                                <option value="viewing_doctor">Viewing Doctor</option>
                                            </select>
                                            <select class="form-select" style="width: 180px;" v-model="userFilter.account_status">
                                                <option value="">All Status</option>
                                                <option value="active">Active</option>
                                                <option value="inactive">Inactive</option>
                                            </select>
                                            <input type="text" class="form-input" style="width: 200px;" 
                                                   v-model="userSearch" placeholder="Search users...">
                                        </div>

                                        <div v-if="filteredUsers.length > 0" style="display: grid; gap: 1rem;">
                                            <div v-for="user in filteredUsers" :key="user.id" class="person-card">
                                                <div class="person-avatar">
                                                    {{ getInitials(user.full_name) }}
                                                </div>
                                                <div class="person-info">
                                                    <div class="person-name">
                                                        {{ user.full_name }}
                                                        <span class="status-pill" :class="getUserStatusClass(user.account_status)">
                                                            {{ user.account_status }}
                                                        </span>
                                                        <span class="status-pill status-resident" style="margin-left: 0.5rem;">
                                                            {{ getUserRoleDisplay(user.user_role) }}
                                                        </span>
                                                    </div>
                                                    <div class="person-clinic">
                                                        ID: {{ user.user_id }} • Email: {{ user.email }}
                                                    </div>
                                                    <div class="person-meta">
                                                        <div v-if="user.department">
                                                            <strong>Department:</strong> {{ user.department }}
                                                        </div>
                                                        <div v-if="user.clinic_unit">
                                                            <strong>Clinic Unit:</strong> {{ user.clinic_unit }}
                                                        </div>
                                                        <div>
                                                            <strong>Created:</strong> {{ formatDateTime(user.created_at) }}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div style="display: flex; gap: 0.5rem;">
                                                    <button class="btn-outline btn-sm" @click="editUser(user)">
                                                        <i class="fas fa-edit"></i> Edit
                                                    </button>
                                                    <button v-if="user.account_status === 'active'" 
                                                            class="btn btn-sm btn-warning" 
                                                            @click="toggleUserStatus(user, 'inactive')">
                                                        <i class="fas fa-user-slash"></i> Deactivate
                                                    </button>
                                                    <button v-else 
                                                            class="btn btn-sm btn-success" 
                                                            @click="toggleUserStatus(user, 'active')">
                                                        <i class="fas fa-user-check"></i> Activate
                                                    </button>
                                                    <button v-if="user.id !== currentUser.id" 
                                                            class="btn btn-sm btn-danger" 
                                                            @click="deleteUser(user)">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div v-else class="empty-state">
                                            <i class="fas fa-users empty-state-icon"></i>
                                            <h3>No users found</h3>
                                            <p>Add users to get started</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- System Settings (Admin) -->
                        <div v-else-if="currentView === 'system_settings' && currentUser.user_role === 'system_admin'">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-cogs"></i>
                                        System Settings
                                    </div>
                                </div>
                                <div class="card-content">
                                    <div style="display: grid; gap: 2rem;">
                                        <div>
                                            <h3 style="margin-bottom: 1rem; color: var(--text-primary);">General Settings</h3>
                                            <div class="form-group">
                                                <label class="form-label">System Name</label>
                                                <input type="text" class="form-input" v-model="systemSettings.system_name">
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">Hospital Name</label>
                                                <input type="text" class="form-input" v-model="systemSettings.hospital_name">
                                            </div>
                                        </div>

                                        <div>
                                            <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Security Settings</h3>
                                            <div class="form-group">
                                                <label class="form-label">
                                                    <input type="checkbox" v-model="systemSettings.require_password_change">
                                                    Require password change every 90 days
                                                </label>
                                            </div>
                                            <div class="form-group">
                                                <label class="form-label">
                                                    <input type="checkbox" v-model="systemSettings.enable_two_factor">
                                                    Enable two-factor authentication
                                                </label>
                                            </div>
                                        </div>

                                        <div class="form-actions">
                                            <button class="btn-outline" @click="resetSettings">
                                                Reset to Defaults
                                            </button>
                                            <button class="btn" @click="saveSystemSettings" :disabled="saving">
                                                <span v-if="saving" class="loading-spinner"></span>
                                                <span v-else>
                                                    <i class="fas fa-save"></i> Save Settings
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Medical Staff Management -->
                        <div v-else-if="currentView === 'medical_staff' && (currentUser.user_role === 'system_admin' || currentUser.user_role === 'resident_manager')">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-user-graduate"></i>
                                        Medical Staff Management
                                    </div>
                                    <button class="btn btn-resident" @click="openAddMedicalStaffModal">
                                        <i class="fas fa-user-plus"></i> Add Medical Staff
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div class="metrics-grid">
                                        <div class="metric-card">
                                            <div class="metric-value">{{ medicalStats.total }}</div>
                                            <div class="metric-label">Total Staff</div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="metric-value">{{ medicalStats.residents }}</div>
                                            <div class="metric-label">Residents</div>
                                        </div>

                                        <div class="metric-card">
                                            <div class="metric-value">{{ medicalStats.attendings }}</div>
                                            <div class="metric-label">Attending Physicians</div>
                                        </div>

                                        <div class="metric-card">
                                            <div class="metric-value">{{ medicalStats.active }}</div>
                                            <div class="metric-label">Active Staff</div>
                                        </div>
                                    </div>

                                    <div style="margin-top: 2rem;">
                                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                                            <select class="form-select" style="width: 180px;" v-model="staffFilter.staff_type">
                                                <option value="">All Types</option>
                                                <option value="medical_resident">Medical Resident</option>
                                                <option value="attending_physician">Attending Physician</option>
                                                <option value="fellow">Fellow</option>
                                            </select>
                                            <select class="form-select" style="width: 180px;" v-model="staffFilter.employment_status">
                                                <option value="">All Status</option>
                                                <option value="active">Active</option>
                                                <option value="on_leave">On Leave</option>
                                            </select>
                                            <input type="text" class="form-input" style="width: 200px;" 
                                                   v-model="staffSearch" placeholder="Search staff...">
                                        </div>

                                        <div v-if="filteredMedicalStaff.length > 0" style="display: grid; gap: 1rem;">
                                            <div v-for="staff in filteredMedicalStaff" :key="staff.id" class="person-card">
                                                <div class="person-avatar">
                                                    {{ getInitials(staff.full_name) }}
                                                </div>
                                                <div class="person-info">
                                                    <div class="person-name">
                                                        {{ staff.full_name }}
                                                        <span class="status-pill" :class="getStaffStatusClass(staff.employment_status)">
                                                            {{ staff.employment_status }}
                                                        </span>
                                                    </div>
                                                    <div class="person-clinic">
                                                        ID: {{ staff.staff_id }} • {{ formatStaffType(staff.staff_type) }}
                                                    </div>
                                                    <div class="person-meta">
                                                        <div v-if="staff.primary_clinic">
                                                            <strong>Clinic:</strong> {{ staff.primary_clinic }}
                                                        </div>
                                                        <div v-if="staff.professional_email">
                                                            <strong>Email:</strong> {{ staff.professional_email }}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div style="display: flex; gap: 0.5rem;">
                                                    <button class="btn-outline btn-sm" @click="editMedicalStaff(staff)">
                                                        <i class="fas fa-edit"></i> Edit
                                                    </button>
                                                    <button class="btn btn-sm">
                                                        <i class="fas fa-calendar"></i> Schedule
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div v-else class="empty-state">
                                            <i class="fas fa-user-graduate empty-state-icon"></i>
                                            <h3>No medical staff found</h3>
                                            <p>Add medical staff to get started</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Training Units -->
                        <div v-else-if="currentView === 'training_units' && (currentUser.user_role === 'system_admin' || currentUser.user_role === 'resident_manager')">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-hospital-alt"></i>
                                        Training Units
                                    </div>
                                    <button class="btn" @click="openAddTrainingUnitModal">
                                        <i class="fas fa-plus"></i> Add Training Unit
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div class="metrics-grid">
                                        <div class="metric-card">
                                            <div class="metric-value">{{ unitStats.total }}</div>
                                            <div class="metric-label">Total Units</div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="metric-value">{{ unitStats.active }}</div>
                                            <div class="metric-label">Active Units</div>
                                        </div>

                                        <div class="metric-card">
                                            <div class="metric-value">{{ unitStats.capacity }}</div>
                                            <div class="metric-label">Total Capacity</div>
                                        </div>

                                        <div class="metric-card">
                                            <div class="metric-value">{{ unitStats.occupied }}</div>
                                            <div class="metric-label">Residents Placed</div>
                                        </div>
                                    </div>

                                    <div style="margin-top: 2rem;">
                                        <div v-if="trainingUnits.length > 0" style="display: grid; gap: 1.5rem;">
                                            <div v-for="unit in trainingUnits" :key="unit.id" class="person-card">
                                                <div class="person-avatar">
                                                    <i class="fas fa-hospital"></i>
                                                </div>
                                                <div class="person-info">
                                                    <div class="person-name">
                                                        {{ unit.unit_name }}
                                                        <span class="status-pill" :class="unit.unit_status === 'active' ? 'status-approved' : 'status-offline'">
                                                            {{ unit.unit_status }}
                                                        </span>
                                                    </div>
                                                    <div class="person-clinic">
                                                        {{ unit.department_name }} • Capacity: {{ unit.current_residents || 0 }}/{{ unit.maximum_residents }}
                                                    </div>
                                                    <div class="person-meta">
                                                        <div v-if="unit.unit_description">
                                                            {{ unit.unit_description }}
                                                        </div>
                                                        <div>
                                                            <strong>Unit Code:</strong> {{ unit.unit_code }}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div style="display: flex; gap: 0.5rem;">
                                                    <button class="btn-outline btn-sm" @click="editTrainingUnit(unit)">
                                                        <i class="fas fa-edit"></i> Edit
                                                    </button>
                                                    <button v-if="unit.unit_status === 'active'" 
                                                            class="btn btn-sm btn-warning" 
                                                            @click="toggleUnitStatus(unit, 'inactive')">
                                                        <i class="fas fa-times"></i> Deactivate
                                                    </button>
                                                    <button v-else 
                                                            class="btn btn-sm btn-success" 
                                                            @click="toggleUnitStatus(unit, 'active')">
                                                        <i class="fas fa-check"></i> Activate
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div v-else class="empty-state">
                                            <i class="fas fa-hospital-alt empty-state-icon"></i>
                                            <h3>No training units found</h3>
                                            <p>Add training units to get started</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Department Overview -->
                        <div v-else-if="currentView === 'department_overview' && currentUser.user_role === 'department_head'">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-chart-line"></i>
                                        Department Overview
                                    </div>
                                </div>
                                <div class="card-content">
                                    <div class="metrics-grid">
                                        <div class="metric-card">
                                            <div class="metric-value">{{ departmentStats.totalStaff }}</div>
                                            <div class="metric-label">Total Staff</div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="metric-value">{{ departmentStats.activeUnits }}</div>
                                            <div class="metric-label">Active Units</div>
                                        </div>

                                        <div class="metric-card">
                                            <div class="metric-value">{{ departmentStats.coverage }}%</div>
                                            <div class="metric-label">Today's Coverage</div>
                                        </div>

                                        <div class="metric-card">
                                            <div class="metric-value">{{ departmentStats.compliance }}%</div>
                                            <div class="metric-label">Duty Compliance</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Default View -->
                        <div v-else>
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-home"></i>
                                        Welcome to PneumoCare Pro
                                    </div>
                                </div>
                                <div class="card-content">
                                    <div style="text-align: center; padding: 3rem;">
                                        <i class="fas fa-lungs" style="font-size: 4rem; color: var(--medical-blue); margin-bottom: 1.5rem;"></i>
                                        <h2 style="margin-bottom: 1rem; color: var(--text-primary);">
                                            Welcome, {{ currentUser.full_name }}
                                        </h2>
                                        <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                                            You are logged in as {{ getUserRoleDisplay(currentUser.user_role) }}
                                        </p>
                                        <div style="display: flex; gap: 1rem; justify-content: center;">
                                            <button class="btn" @click="switchView('daily_assignments')">
                                                <i class="fas fa-calendar-day"></i> View Daily Assignments
                                            </button>
                                            <button class="btn btn-outline" @click="switchView('announcements')">
                                                <i class="fas fa-bullhorn"></i> View Announcements
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modals -->
        <!-- Add User Modal -->
        <div v-if="showAddUserModal" class="modal-overlay" @click.self="closeAddUserModal">
            <div class="modal modal-large" @click.stop>
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-user-plus"></i>
                        Add New User
                    </div>
                    <button class="modal-close" @click="closeAddUserModal">×</button>
                </div>
                <form @submit.prevent="saveNewUser">
                    <div class="card-content">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-input" v-model="newUserForm.full_name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-input" v-model="newUserForm.email" required>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">User Role</label>
                                <select class="form-select" v-model="newUserForm.user_role" required>
                                    <option value="system_admin">System Administrator</option>
                                    <option value="resident_manager">Resident Manager</option>
                                    <option value="department_head">Department Head</option>
                                    <option value="viewing_doctor">Viewing Doctor</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Department</label>
                                <input type="text" class="form-input" v-model="newUserForm.department" 
                                       placeholder="Pulmonology">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Initial Password</label>
                            <input type="password" class="form-input" v-model="newUserForm.password" required>
                            <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                User will be required to change password on first login
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Account Status</label>
                            <select class="form-select" v-model="newUserForm.account_status" required>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-outline" @click="closeAddUserModal">Cancel</button>
                        <button type="submit" class="btn" :disabled="saving">
                            <span v-if="saving" class="loading-spinner"></span>
                            <span v-else>
                                <i class="fas fa-save"></i> Create User
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Toast Notification -->
        <div v-if="toast.show" class="toast" :class="toast.type" @click="toast.show = false">
            <i :class="toast.icon"></i> {{ toast.message }}
        </div>
    </div>

    <script>
// Replace your Supabase configuration with this:
const supabaseUrl = 'https://vssmguzuvekkecbmwcjw.supabase.co';
const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZzc21ndXp1dmVra2VjYm13Y2p3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1OTI4NTIsImV4cCI6MjA4NDE2ODg1Mn0.8qPFsMEn4n5hDfxhgXvq2lQarts8OlL8hWiRYXb-vXw';

// Create Supabase client with better error handling
const createSupabaseClient = () => {
    try {
        return window.supabase.createClient(supabaseUrl, supabaseAnonKey, {
            auth: {
                autoRefreshToken: false,
                persistSession: false,
                detectSessionInUrl: false
            },
            global: {
                headers: {
                    'apikey': supabaseAnonKey
                }
            }
        });
    } catch (error) {
        console.error('Failed to create Supabase client:', error);
        return null;
    }
};

const supabaseClient = createSupabaseClient();

    createApp({
        setup() {
            // ============ STATE MANAGEMENT ============
            const currentUser = ref(null);
            const loginForm = ref({
                email: '',
                password: '',
                user_role: 'system_admin'
            });
            const loading = ref(false);
            const saving = ref(false);
            const showSetupAdmin = ref(false);
            
            const currentView = ref('login');
            const sidebarCollapsed = ref(false);
            const mobileMenuOpen = ref(false);
            const searchQuery = ref('');
            
            const systemUsers = ref([]);
            const medicalStaff = ref([]);
            const trainingUnits = ref([]);
            
            const showAddUserModal = ref(false);
            const showAddMedicalStaffModal = ref(false);
            const showAddTrainingUnitModal = ref(false);
            
            const newUserForm = ref({
                full_name: '',
                email: '',
                user_role: 'resident_manager',
                department: '',
                password: '',
                account_status: 'active'
            });
            
            const medicalStaffForm = ref({
                full_name: '',
                professional_email: '',
                staff_type: 'medical_resident',
                primary_clinic: '',
                employment_status: 'active'
            });
            
            const trainingUnitForm = ref({
                unit_code: '',
                unit_name: '',
                department_name: 'Pulmonology',
                maximum_residents: 4,
                unit_description: '',
                unit_status: 'active'
            });
            
            const systemSettings = ref({
                system_name: 'PneumoCare Pro',
                hospital_name: 'Academic Medical Center',
                require_password_change: true,
                enable_two_factor: false
            });
            
            const userFilter = ref({
                user_role: '',
                account_status: ''
            });
            const userSearch = ref('');
            
            const staffFilter = ref({
                staff_type: '',
                employment_status: ''
            });
            const staffSearch = ref('');
            
            const toast = ref({
                show: false,
                message: '',
                icon: 'fas fa-info-circle',
                type: 'info'
            });

            // ============ UTILITY FUNCTIONS ============
            const showToast = (message, type = 'info') => {
                const icons = {
                    info: 'fas fa-info-circle',
                    success: 'fas fa-check-circle',
                    error: 'fas fa-exclamation-circle',
                    warning: 'fas fa-exclamation-triangle'
                };
                
                toast.value = {
                    show: true,
                    message,
                    icon: icons[type] || icons.info,
                    type: type
                };
                
                setTimeout(() => {
                    toast.value.show = false;
                }, 4000);
            };

            const getInitials = (name) => {
                if (!name) return '??';
                return name
                    .split(' ')
                    .map(n => n[0])
                    .join('')
                    .toUpperCase()
                    .substring(0, 2);
            };

            const formatDateTime = (dateTimeString) => {
                if (!dateTimeString) return '';
                const date = new Date(dateTimeString);
                return date.toLocaleDateString('en-US', {
                    month: 'short',
                    day: 'numeric',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            const getUserRoleDisplay = (role) => {
                const roles = {
                    system_admin: 'System Administrator',
                    resident_manager: 'Resident Manager',
                    department_head: 'Head of Department',
                    viewing_doctor: 'Viewing Doctor',
                    medical_resident: 'Medical Resident',
                    attending_physician: 'Attending Physician',
                    fellow: 'Fellow'
                };
                return roles[role] || role;
            };

            const getUserStatusClass = (status) => {
                const classes = {
                    active: 'status-approved',
                    inactive: 'status-offline',
                    suspended: 'status-busy'
                };
                return classes[status] || 'status-offline';
            };

            const getStaffStatusClass = (status) => {
                const classes = {
                    active: 'status-approved',
                    on_leave: 'status-busy',
                    inactive: 'status-offline'
                };
                return classes[status] || 'status-offline';
            };

            const formatStaffType = (type) => {
                const types = {
                    medical_resident: 'Medical Resident',
                    attending_physician: 'Attending Physician',
                    fellow: 'Fellow'
                };
                return types[type] || type;
            };

            // ============ COMPUTED PROPERTIES ============
            const adminStats = computed(() => {
                return {
                    totalUsers: systemUsers.value.length,
                    activeUsers: systemUsers.value.filter(u => u.account_status === 'active').length,
                    inactiveUsers: systemUsers.value.filter(u => u.account_status !== 'active').length,
                    totalStaff: medicalStaff.value.length,
                    residents: medicalStaff.value.filter(s => s.staff_type === 'medical_resident').length,
                    totalUnits: trainingUnits.value.length,
                    activeUnits: trainingUnits.value.filter(u => u.unit_status === 'active').length,
                    systemUptime: 99.9
                };
            });

            const medicalStats = computed(() => {
                return {
                    total: medicalStaff.value.length,
                    residents: medicalStaff.value.filter(s => s.staff_type === 'medical_resident').length,
                    attendings: medicalStaff.value.filter(s => s.staff_type === 'attending_physician').length,
                    active: medicalStaff.value.filter(s => s.employment_status === 'active').length
                };
            });

            const unitStats = computed(() => {
                const totalCapacity = trainingUnits.value.reduce((sum, unit) => sum + (unit.maximum_residents || 0), 0);
                const occupied = trainingUnits.value.reduce((sum, unit) => sum + (unit.current_residents || 0), 0);
                
                return {
                    total: trainingUnits.value.length,
                    active: trainingUnits.value.filter(u => u.unit_status === 'active').length,
                    capacity: totalCapacity,
                    occupied: occupied
                };
            });

            const departmentStats = computed(() => {
                return {
                    totalStaff: medicalStaff.value.length,
                    activeUnits: trainingUnits.value.filter(u => u.unit_status === 'active').length,
                    coverage: 95,
                    compliance: 92
                };
            });

            const filteredUsers = computed(() => {
                let filtered = systemUsers.value;
                
                if (userSearch.value) {
                    const search = userSearch.value.toLowerCase();
                    filtered = filtered.filter(u => 
                        u.full_name.toLowerCase().includes(search) ||
                        u.email.toLowerCase().includes(search)
                    );
                }
                
                if (userFilter.value.user_role) {
                    filtered = filtered.filter(u => u.user_role === userFilter.value.user_role);
                }
                
                if (userFilter.value.account_status) {
                    filtered = filtered.filter(u => u.account_status === userFilter.value.account_status);
                }
                
                return filtered;
            });

            const filteredMedicalStaff = computed(() => {
                let filtered = medicalStaff.value;
                
                if (staffSearch.value) {
                    const search = staffSearch.value.toLowerCase();
                    filtered = filtered.filter(s => 
                        s.full_name.toLowerCase().includes(search) ||
                        (s.staff_id && s.staff_id.toLowerCase().includes(search))
                    );
                }
                
                if (staffFilter.value.staff_type) {
                    filtered = filtered.filter(s => s.staff_type === staffFilter.value.staff_type);
                }
                
                if (staffFilter.value.employment_status) {
                    filtered = filtered.filter(s => s.employment_status === staffFilter.value.employment_status);
                }
                
                return filtered;
            });

            const getRoleCount = (role) => {
                return systemUsers.value.filter(u => u.user_role === role).length;
            };

            // ============ NAVIGATION ============
            const switchView = (view) => {
                currentView.value = view;
                closeMobileMenu();
            };

            const getCurrentTitle = () => {
                const titles = {
                    login: 'Login',
                    dashboard: 'Dashboard',
                    user_management: 'User Management',
                    system_settings: 'System Settings',
                    medical_staff: 'Medical Staff Management',
                    training_units: 'Training Units',
                    department_overview: 'Department Overview',
                    daily_assignments: 'Daily Assignments',
                    oncall_schedule: 'On-call Schedule',
                    leave_requests: 'Leave Requests',
                    announcements: 'Announcements'
                };
                
                return titles[currentView.value] || 'PneumoCare Pro';
            };

            const getCurrentSubtitle = () => {
                const subtitles = {
                    login: 'Academic Pulmonary Management System',
                    dashboard: 'System Administration Dashboard',
                    user_management: 'Manage system users and permissions',
                    system_settings: 'Configure system preferences',
                    medical_staff: 'Manage medical staff and supervisors',
                    training_units: 'Configure training units and capacities',
                    department_overview: 'Monitor department operations',
                    daily_assignments: 'View and manage daily assignments',
                    oncall_schedule: 'Manage on-call rotations',
                    leave_requests: 'Handle leave requests',
                    announcements: 'Department announcements'
                };
                
                return subtitles[currentView.value] || '';
            };

            const getSearchPlaceholder = () => {
                const placeholders = {
                    user_management: 'Search users...',
                    medical_staff: 'Search medical staff...',
                    training_units: 'Search training units...'
                };
                
                return placeholders[currentView.value] || 'Search...';
            };

            const toggleMobileMenu = () => {
                mobileMenuOpen.value = !mobileMenuOpen.value;
            };

            const closeMobileMenu = () => {
                mobileMenuOpen.value = false;
            };

            const toggleUserMenu = () => {
                showToast('User profile options', 'info');
            };

            // ============ AUTHENTICATION ============
            const checkFirstTimeSetup = async () => {
                try {
                    const { data, error } = await supabaseClient
                        .from('app_users')
                        .select('*')
                        .eq('user_role', 'system_admin')
                        .limit(1);
                    
                    if (error) throw error;
                    showSetupAdmin.value = !data || data.length === 0;
                } catch (error) {
                    console.error('Setup check error:', error);
                    showSetupAdmin.value = true;
                }
            };

            const handleLogin = async () => {
    loading.value = true;
    
    try {
        const email = loginForm.value.email.trim().toLowerCase();
        const password = loginForm.value.password;
        
        if (!email || !password) {
            throw new Error('Please fill in all fields');
        }
        
        // Check if Supabase is available
        if (!supabaseClient) {
            throw new Error('Database service temporarily unavailable. Please try again in a few minutes.');
        }
        
        if (showSetupAdmin.value) {
            await createFirstAdmin(email, password);
            return;
        }
        
        // Try Supabase login
        const { data: authData, error: authError } = await supabaseClient.auth.signInWithPassword({
            email: email,
            password: password
        });
        
        if (authError) {
            if (authError.message.includes('Invalid login credentials')) {
                throw new Error('Invalid email or password');
            }
            throw new Error('Authentication service error: ' + authError.message);
        }
        
        await getUserProfile(authData.user.email);
        
    } catch (error) {
        console.error('Login error:', error);
        showToast(error.message || 'Login failed. Please try again.', 'error');
        loading.value = false;
    }
};

            const createFirstAdmin = async (email, password) => {
                try {
                    const { data: signUpData, error: signUpError } = await supabaseClient.auth.signUp({
                        email: email,
                        password: password,
                        options: {
                            data: {
                                full_name: email.split('@')[0].replace(/\./g, ' '),
                                user_role: 'system_admin'
                            }
                        }
                    });
                    
                    if (signUpError) {
                        if (signUpError.message.includes('User already registered')) {
                            const { data: signInData, error: signInError } = await supabaseClient.auth.signInWithPassword({
                                email: email,
                                password: password
                            });
                            
                            if (signInError) throw signInError;
                            await createAdminProfile(signInData.user);
                            return;
                        }
                        throw signUpError;
                    }
                    
                    if (signUpData.user) {
                        await createAdminProfile(signUpData.user);
                    }
                    
                } catch (error) {
                    console.error('Create admin error:', error);
                    throw error;
                }
            };

            const createAdminProfile = async (authUser) => {
                try {
                    const { data: existingUser } = await supabaseClient
                        .from('app_users')
                        .select('*')
                        .eq('email', authUser.email)
                        .maybeSingle();
                    
                    if (!existingUser) {
                        const newUser = {
                            id: authUser.id,
                            email: authUser.email,
                            full_name: authUser.user_metadata?.full_name || authUser.email.split('@')[0].replace(/\./g, ' '),
                            user_role: 'system_admin',
                            user_id: 'SYS-ADMIN-001',
                            account_status: 'active',
                            created_at: new Date().toISOString()
                        };
                        
                        const { error } = await supabaseClient
                            .from('app_users')
                            .insert([newUser]);
                        
                        if (error) throw error;
                        currentUser.value = newUser;
                    } else {
                        currentUser.value = existingUser;
                    }
                    
                    await loadInitialData();
                    currentView.value = 'dashboard';
                    showToast(`Welcome, System Administrator!`, 'success');
                    
                } catch (error) {
                    console.error('Create profile error:', error);
                    throw error;
                } finally {
                    loading.value = false;
                }
            };

            const getUserProfile = async (email) => {
                try {
                    const { data: userProfile, error } = await supabaseClient
                        .from('app_users')
                        .select('*')
                        .eq('email', email)
                        .single();
                    
                    if (error) throw error;
                    
                    currentUser.value = userProfile;
                    await loadInitialData();
                    
                    if (currentUser.value.user_role === 'system_admin') {
                        currentView.value = 'dashboard';
                    } else if (currentUser.value.user_role === 'resident_manager') {
                        currentView.value = 'medical_staff';
                    } else if (currentUser.value.user_role === 'department_head') {
                        currentView.value = 'department_overview';
                    } else {
                        currentView.value = 'daily_assignments';
                    }
                    
                    showToast(`Welcome, ${currentUser.value.full_name}!`, 'success');
                    
                } catch (error) {
                    console.error('Get profile error:', error);
                    throw error;
                } finally {
                    loading.value = false;
                }
            };

            const handleLogout = async () => {
                try {
                    const { error } = await supabaseClient.auth.signOut();
                    if (error) throw error;
                    
                    currentUser.value = null;
                    currentView.value = 'login';
                    showToast('Logged out successfully', 'success');
                } catch (error) {
                    console.error('Logout error:', error);
                    showToast('Logout failed', 'error');
                }
            };

            // ============ DATA LOADING ============
            const loadInitialData = async () => {
                loading.value = true;
                try {
                    await Promise.all([
                        loadSystemUsers(),
                        loadMedicalStaff(),
                        loadTrainingUnits()
                    ]);
                } catch (error) {
                    console.error('Error loading data:', error);
                } finally {
                    loading.value = false;
                }
            };

          const loadSystemUsers = async () => {
    try {
        if (!supabaseClient) {
            throw new Error('Database service unavailable');
        }
        
        const { data, error } = await supabaseClient
            .from('app_users')
            .select('*')
            .order('created_at', { ascending: false });
        
        if (error) {
            if (error.code === 'PGRST301' || error.code === 'PGRST302') {
                throw new Error('Database table not found. Please run setup SQL.');
            }
            throw error;
        }
        
        systemUsers.value = data || [];
        
    } catch (error) {
        console.error('Error loading users:', error);
        
        // Show user-friendly message
        if (error.message.includes('Database service unavailable')) {
            showToast('Database service is temporarily down. Some features may be limited.', 'warning');
        } else if (error.message.includes('table not found')) {
            showToast('Database setup required. Please contact system administrator.', 'error');
        } else {
            showToast('Error loading user data: ' + error.message, 'error');
        }
        
        throw error;
    }
};

            const loadMedicalStaff = async () => {
                try {
                    const { data, error } = await supabaseClient
                        .from('medical_staff')
                        .select('*')
                        .order('full_name');
                    
                    if (error) throw error;
                    medicalStaff.value = data || [];
                } catch (error) {
                    console.error('Error loading medical staff:', error);
                    throw error;
                }
            };

            const loadTrainingUnits = async () => {
                try {
                    const { data, error } = await supabaseClient
                        .from('training_units')
                        .select('*')
                        .order('unit_name');
                    
                    if (error) throw error;
                    trainingUnits.value = data || [];
                } catch (error) {
                    console.error('Error loading training units:', error);
                    throw error;
                }
            };

            // ============ USER MANAGEMENT ============
            const openAddUserModal = () => {
                newUserForm.value = {
                    full_name: '',
                    email: '',
                    user_role: 'resident_manager',
                    department: '',
                    password: '',
                    account_status: 'active'
                };
                showAddUserModal.value = true;
            };

            const closeAddUserModal = () => {
                showAddUserModal.value = false;
            };

           const saveNewUser = async () => {
    saving.value = true;
    
    try {
        if (!supabaseClient) {
            throw new Error('Database service unavailable');
        }
        
        // Use retry logic
        await retryOperation(async () => {
            const userPrefix = {
                system_admin: 'SYS',
                resident_manager: 'RM',
                department_head: 'DH',
                viewing_doctor: 'VD'
            };
            
            const user_id = `${userPrefix[newUserForm.value.user_role]}-${Date.now().toString().slice(-6)}`;
            
            const { data: authData, error: authError } = await supabaseClient.auth.signUp({
                email: newUserForm.value.email,
                password: newUserForm.value.password,
                options: {
                    data: {
                        full_name: newUserForm.value.full_name,
                        user_role: newUserForm.value.user_role
                    }
                }
            });
            
            if (authError) {
                if (authError.message.includes('User already registered')) {
                    throw new Error('User already exists. Use different email.');
                }
                throw authError;
            }
            
            const userRecord = {
                id: authData?.user?.id || crypto.randomUUID(),
                email: newUserForm.value.email,
                full_name: newUserForm.value.full_name,
                user_role: newUserForm.value.user_role,
                department: newUserForm.value.department,
                user_id: user_id,
                account_status: newUserForm.value.account_status,
                created_at: new Date().toISOString()
            };
            
            const { error: dbError } = await supabaseClient
                .from('app_users')
                .insert([userRecord]);
            
            if (dbError) throw dbError;
        }, 2);
        
        showToast('User created successfully', 'success');
        closeAddUserModal();
        await loadSystemUsers();
        
    } catch (error) {
        console.error('Error creating user:', error);
        showToast('Error: ' + error.message, 'error');
    } finally {
        saving.value = false;
    }
};
            const editUser = (user) => {
                showToast('Edit user - Coming soon', 'info');
            };

            const toggleUserStatus = async (user, newStatus) => {
                try {
                    const { error } = await supabaseClient
                        .from('app_users')
                        .update({ account_status: newStatus })
                        .eq('id', user.id);
                    
                    if (error) throw error;
                    
                    user.account_status = newStatus;
                    showToast(`User ${newStatus === 'active' ? 'activated' : 'deactivated'}`, 'success');
                    await loadSystemUsers();
                    
                } catch (error) {
                    console.error('Error updating user status:', error);
                    showToast('Error updating user status', 'error');
                }
            };

            const deleteUser = async (user) => {
                if (!confirm(`Delete user ${user.full_name}?`)) return;
                
                try {
                    const { error } = await supabaseClient
                        .from('app_users')
                        .delete()
                        .eq('id', user.id);
                    
                    if (error) throw error;
                    
                    showToast('User deleted', 'success');
                    await loadSystemUsers();
                    
                } catch (error) {
                    console.error('Error deleting user:', error);
                    showToast('Error deleting user', 'error');
                }
            };

            // ============ MEDICAL STAFF MANAGEMENT ============
            const openAddMedicalStaffModal = () => {
                showAddMedicalStaffModal.value = true;
            };

            const editMedicalStaff = (staff) => {
                showToast('Edit medical staff - Coming soon', 'info');
            };

            // ============ TRAINING UNITS MANAGEMENT ============
            const openAddTrainingUnitModal = () => {
                showAddTrainingUnitModal.value = true;
            };

            const editTrainingUnit = (unit) => {
                showToast('Edit training unit - Coming soon', 'info');
            };

            const toggleUnitStatus = async (unit, newStatus) => {
                try {
                    const { error } = await supabaseClient
                        .from('training_units')
                        .update({ unit_status: newStatus })
                        .eq('id', unit.id);
                    
                    if (error) throw error;
                    
                    unit.unit_status = newStatus;
                    showToast(`Unit ${newStatus === 'active' ? 'activated' : 'deactivated'}`, 'success');
                    await loadTrainingUnits();
                    
                } catch (error) {
                    console.error('Error updating unit status:', error);
                    showToast('Error updating unit status', 'error');
                }
            };

            // ============ SYSTEM FUNCTIONS ============
            const generateSystemReport = () => {
                showToast('System report generated', 'success');
            };

            const resetSettings = () => {
                systemSettings.value = {
                    system_name: 'PneumoCare Pro',
                    hospital_name: 'Academic Medical Center',
                    require_password_change: true,
                    enable_two_factor: false
                };
                showToast('Settings reset', 'success');
            };

            const saveSystemSettings = async () => {
                saving.value = true;
                try {
                    setTimeout(() => {
                        showToast('Settings saved', 'success');
                        saving.value = false;
                    }, 1000);
                } catch (error) {
                    console.error('Error saving settings:', error);
                    showToast('Error saving settings', 'error');
                    saving.value = false;
                }
            };

            // ============ INITIALIZATION ============
            onMounted(async () => {
    // Check database connectivity
    const checkDatabase = async () => {
        try {
            if (supabaseClient) {
                const { error } = await supabaseClient
                    .from('app_users')
                    .select('count')
                    .limit(1);
                
                if (error && error.code !== 'PGRST301') {
                    console.warn('Database connection issue:', error);
                    showToast('Database connection unstable', 'warning');
                }
            }
        } catch (error) {
            console.warn('Database check failed:', error);
        }
    };
    
    await checkDatabase();
    await checkFirstTimeSetup();
    
    // Check for existing session
    supabaseClient.auth.getSession().then(({ data: { session } }) => {
        if (session) {
            console.log('Existing session found:', session.user.email);
            getUserProfile(session.user.email);
        }
    });
    
    // Set up auth state listener
    supabaseClient.auth.onAuthStateChange((event, session) => {
        console.log('Auth state changed:', event);
        if (event === 'SIGNED_OUT') {
            currentUser.value = null;
            currentView.value = 'login';
            // Re-check setup status on logout
            checkFirstTimeSetup();
        } else if (event === 'SIGNED_IN' && session && !currentUser.value) {
            // If signed in but no current user, get profile
            getUserProfile(session.user.email);
        }
    });
    
    // Initialize week range for schedule views
    updateWeekRange();
    
    // Set default dates in forms
    const today = new Date().toISOString().split('T')[0];
    if (assignmentForm) assignmentForm.value.assignment_date = today;
    if (leaveRequestForm) leaveRequestForm.value.leave_start_date = today;
    if (leaveRequestForm) leaveRequestForm.value.leave_end_date = today;
    if (onCallForm) onCallForm.value.duty_date = today;
    if (announcementForm) announcementForm.value.publish_start_date = today;
});

            // ============ RETURN STATEMENT ============
            return {
                // State
                currentUser,
                loginForm,
                loading,
                saving,
                showSetupAdmin,
                currentView,
                sidebarCollapsed,
                mobileMenuOpen,
                searchQuery,
                systemUsers,
                medicalStaff,
                trainingUnits,
                showAddUserModal,
                showAddMedicalStaffModal,
                showAddTrainingUnitModal,
                newUserForm,
                medicalStaffForm,
                trainingUnitForm,
                systemSettings,
                userFilter,
                userSearch,
                staffFilter,
                staffSearch,
                toast,
                
                // Computed
                adminStats,
                medicalStats,
                unitStats,
                departmentStats,
                filteredUsers,
                filteredMedicalStaff,
                getRoleCount,
                
                // Utility Methods
                showToast,
                getInitials,
                formatDateTime,
                getUserRoleDisplay,
                getUserStatusClass,
                getStaffStatusClass,
                formatStaffType,
                
                // Navigation Methods
                switchView,
                getCurrentTitle,
                getCurrentSubtitle,
                getSearchPlaceholder,
                toggleMobileMenu,
                closeMobileMenu,
                toggleUserMenu,
                
                // Authentication Methods
                handleLogin,
                handleLogout,
                
                // User Management Methods
                openAddUserModal,
                closeAddUserModal,
                saveNewUser,
                editUser,
                toggleUserStatus,
                deleteUser,
                
                // Medical Staff Methods
                openAddMedicalStaffModal,
                editMedicalStaff,
                
                // Training Unit Methods
                openAddTrainingUnitModal,
                editTrainingUnit,
                toggleUnitStatus,
                
                // System Methods
                generateSystemReport,
                resetSettings,
                saveSystemSettings,
                
                // Data Loading Methods
                loadSystemUsers,
                loadMedicalStaff,
                loadTrainingUnits
            };
        }
    }).mount('#app');
    </script>
</body>
</html>
