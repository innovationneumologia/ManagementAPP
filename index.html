<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PneumoCare Pro | Department of Pneumology Management System</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Professional Pneumology Color Scheme */
            --pneumology-blue: #1e3a8a;
            --pneumology-light-blue: #3b82f6;
            --pneumology-teal: #0d9488;
            --pneumology-cyan: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #8b5cf6;
            
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            
            --primary: var(--pneumology-blue);
            --secondary: var(--pneumology-light-blue);
            --accent: var(--pneumology-teal);
            
            --text-primary: var(--gray-800);
            --text-secondary: var(--gray-600);
            --background-primary: #f8fafc;
            --background-secondary: #ffffff;
            --border-color: var(--gray-200);
            
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
            
            --focus-ring: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--background-primary);
            color: var(--text-primary);
            line-height: 1.6;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ============ LOGIN SCREEN ============ */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--pneumology-blue) 0%, var(--pneumology-light-blue) 100%);
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .login-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23ffffff' fill-opacity='0.05' fill-rule='evenodd'/%3E%3C/svg%3E");
        }

        .login-card {
            background: var(--background-secondary);
            border-radius: var(--radius-xl);
            padding: 3rem;
            width: 100%;
            max-width: 480px;
            box-shadow: var(--shadow-xl);
            position: relative;
            z-index: 1;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .login-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--pneumology-light-blue), var(--pneumology-teal));
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            margin: 0 auto 1.5rem;
            box-shadow: var(--shadow-md);
        }

        .login-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--pneumology-blue);
            margin-bottom: 0.5rem;
            letter-spacing: -0.5px;
        }

        .login-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 500;
        }

        .login-tagline {
            color: var(--pneumology-teal);
            font-size: 0.9rem;
            font-weight: 600;
            margin-top: 0.5rem;
            letter-spacing: 0.5px;
        }

        .role-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .role-btn {
            padding: 1.25rem;
            border: 2px solid var(--border-color);
            background: var(--background-secondary);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition-normal);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .role-btn:hover {
            border-color: var(--pneumology-light-blue);
            background: var(--gray-50);
            transform: translateY(-2px);
        }

        .role-btn.active {
            border-color: var(--pneumology-light-blue);
            background: rgba(59, 130, 246, 0.1);
            box-shadow: var(--shadow-sm);
        }

        .role-icon {
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--pneumology-light-blue);
        }

        .role-name {
            font-weight: 700;
            margin-bottom: 0.25rem;
            color: var(--text-primary);
        }

        .role-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* ============ MAIN APP LAYOUT ============ */
        .app-container {
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, 
                var(--pneumology-blue) 0%, 
                #2563eb 50%, 
                var(--pneumology-light-blue) 100%);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition-normal);
            display: flex;
            flex-direction: column;
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar-header {
            padding: 1.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .collapse-toggle {
            position: absolute;
            right: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.12);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }

        .collapse-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: var(--transition-normal);
        }

        .brand-logo {
            width: 52px;
            height: 52px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.05));
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            flex-shrink: 0;
        }

        .brand-text {
            color: white;
            flex: 1;
            overflow: hidden;
            transition: var(--transition-normal);
        }

        .sidebar.collapsed .brand-text {
            opacity: 0;
            width: 0;
        }

        .brand-text h1 {
            font-size: 1.35rem;
            font-weight: 700;
            margin-bottom: 4px;
            letter-spacing: -0.25px;
            line-height: 1.2;
        }

        .brand-text .subtitle {
            font-size: 0.8rem;
            opacity: 0.85;
            font-weight: 500;
            letter-spacing: 0.5px;
            color: rgba(255, 255, 255, 0.8);
        }

        .sidebar-nav {
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            gap: 0.375rem;
            flex: 1;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.875rem 1.25rem;
            border: none;
            background: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            color: rgba(255, 255, 255, 0.85);
            transition: var(--transition-normal);
            font-size: 0.95rem;
            font-weight: 500;
            position: relative;
            text-align: left;
            white-space: nowrap;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.12);
            color: white;
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-weight: 600;
            box-shadow: inset 3px 0 0 white;
        }

        .sidebar.collapsed .nav-item span {
            display: none;
        }

        .sidebar-footer {
            padding: 1.75rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.75rem;
            text-align: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--pneumology-teal), var(--pneumology-cyan));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 0.85rem;
            flex-shrink: 0;
        }

        .user-details {
            flex: 1;
            overflow: hidden;
        }

        .sidebar.collapsed .user-details {
            display: none;
        }

        .user-name {
            font-weight: 600;
            color: white;
            font-size: 0.85rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-role {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.8);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition-normal);
        }

        .main-content.expanded {
            margin-left: 80px;
        }

        .content-header {
            background: var(--background-secondary);
            padding: 1.5rem 2.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .header-title h1 {
            font-size: 1.85rem;
            font-weight: 800;
            margin-bottom: 6px;
            color: var(--text-primary);
            letter-spacing: -0.5px;
        }

        .header-title .subtitle {
            color: var(--text-secondary);
            font-size: 0.925rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .search-box {
            position: relative;
            width: 320px;
        }

        .search-box input {
            width: 100%;
            padding: 0.875rem 1.25rem 0.875rem 3rem;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            background: var(--background-secondary);
            font-size: 0.925rem;
            transition: var(--transition-normal);
            color: var(--text-primary);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--pneumology-light-blue);
            box-shadow: var(--focus-ring);
        }

        .search-icon {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.625rem 0.875rem;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition-fast);
            background: var(--gray-50);
            border: 1px solid transparent;
        }

        .user-profile:hover {
            background: var(--gray-100);
            border-color: var(--border-color);
        }

        .user-info-header {
            text-align: right;
        }

        .user-name-header {
            font-weight: 700;
            font-size: 0.925rem;
            color: var(--text-primary);
        }

        .user-role-header {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .user-avatar-header {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--pneumology-teal), var(--pneumology-cyan));
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 0.95rem;
        }

        /* Content Area */
        .content-area {
            padding: 2.5rem;
            flex: 1;
            background: var(--background-primary);
        }

        /* ============ COMPONENTS ============ */
        
        /* Cards */
        .card {
            background: var(--background-secondary);
            border-radius: var(--radius-xl);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-md);
            margin-bottom: 2rem;
            overflow: hidden;
            transition: var(--transition-normal);
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
        }

        .card-header {
            padding: 1.75rem 2rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            background: var(--gray-50);
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 0.875rem;
            font-size: 1.35rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .card-title i {
            color: var(--pneumology-light-blue);
        }

        .card-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .card-content {
            padding: 2rem;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .metric-card {
            background: var(--background-secondary);
            border-radius: var(--radius-xl);
            padding: 2rem;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
            transition: var(--transition-normal);
        }

        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--pneumology-light-blue), var(--pneumology-teal));
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--pneumology-blue);
            margin-bottom: 0.75rem;
            line-height: 1;
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .metric-trend {
            font-size: 0.85rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .metric-trend.positive {
            color: var(--success);
        }

        .metric-trend.negative {
            color: var(--error);
        }

        /* Buttons */
        .btn {
            background: var(--pneumology-light-blue);
            color: white;
            border: none;
            padding: 0.875rem 1.75rem;
            border-radius: var(--radius-lg);
            cursor: pointer;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.925rem;
            transition: var(--transition-fast);
            text-decoration: none;
        }

        .btn:hover {
            background: var(--pneumology-blue);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--pneumology-light-blue);
            color: var(--pneumology-light-blue);
        }

        .btn-outline:hover {
            background: var(--pneumology-light-blue);
            color: white;
        }

        .btn-sm {
            padding: 0.625rem 1.25rem;
            font-size: 0.875rem;
        }

        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1rem;
        }

        .btn-success {
            background: var(--success);
        }

        .btn-success:hover {
            background: #0da271;
        }

        .btn-warning {
            background: var(--warning);
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn-error {
            background: var(--error);
        }

        .btn-error:hover {
            background: #dc2626;
        }

        .btn-teal {
            background: var(--pneumology-teal);
        }

        .btn-teal:hover {
            background: #0d7c6f;
        }

        /* Status Indicators */
        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .status-inactive {
            background: rgba(100, 116, 139, 0.1);
            color: var(--gray-500);
            border: 1px solid rgba(100, 116, 139, 0.2);
        }

        .status-oncall {
            background: rgba(139, 92, 246, 0.1);
            color: var(--info);
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            margin-right: 8px;
        }

        .badge-resident {
            background: rgba(139, 92, 246, 0.1);
            color: var(--info);
        }

        .badge-attending {
            background: rgba(59, 130, 246, 0.1);
            color: var(--pneumology-light-blue);
        }

        .badge-admin {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }

        /* Person Cards */
        .person-card {
            display: flex;
            align-items: center;
            gap: 1.25rem;
            padding: 1.25rem;
            background: var(--background-secondary);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            margin-bottom: 0.875rem;
            transition: var(--transition-fast);
        }

        .person-card:hover {
            border-color: var(--pneumology-light-blue);
            background: var(--gray-50);
        }

        .person-avatar {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--pneumology-light-blue), var(--pneumology-cyan));
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
            font-weight: 800;
            flex-shrink: 0;
        }

        .person-avatar.resident {
            background: linear-gradient(135deg, var(--info), var(--pneumology-cyan));
        }

        .person-avatar.attending {
            background: linear-gradient(135deg, var(--pneumology-teal), var(--success));
        }

        .person-info {
            flex: 1;
            min-width: 0;
        }

        .person-name {
            font-weight: 800;
            margin-bottom: 4px;
            color: var(--text-primary);
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .person-id {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .person-meta {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 2px;
            line-height: 1.5;
        }

        .person-actions {
            display: flex;
            gap: 0.5rem;
            flex-shrink: 0;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.75rem;
        }

        .form-label {
            display: block;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 0.875rem 1.25rem;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            background: var(--background-secondary);
            font-size: 0.95rem;
            transition: var(--transition-normal);
            color: var(--text-primary);
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--pneumology-light-blue);
            box-shadow: var(--focus-ring);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: 'Inter', sans-serif;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            padding-top: 1.75rem;
            border-top: 1px solid var(--border-color);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            padding: 0 2rem;
            background: var(--gray-50);
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
        }

        .tab-btn {
            padding: 1.25rem 1.75rem;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 700;
            color: var(--text-secondary);
            border-bottom: 3px solid transparent;
            transition: var(--transition-fast);
            white-space: nowrap;
        }

        .tab-btn:hover {
            color: var(--text-primary);
        }

        .tab-btn.active {
            color: var(--pneumology-light-blue);
            border-bottom-color: var(--pneumology-light-blue);
        }

        /* Loading States */
        .loading-spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(59, 130, 246, 0.2);
            border-radius: 50%;
            border-top-color: var(--pneumology-light-blue);
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem;
            color: var(--text-secondary);
        }

        .loading-state p {
            margin-top: 1rem;
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--gray-300);
        }

        .empty-state h3 {
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .toast {
            background: var(--pneumology-light-blue);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 0.875rem;
            max-width: 400px;
            animation: slideIn 0.3s ease-out;
            transition: var(--transition-normal);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--error);
        }

        .toast.warning {
            background: var(--warning);
        }

        .toast.info {
            background: var(--info);
        }

        .toast-close {
            margin-left: auto;
            background: none;
            border: none;
            color: white;
            opacity: 0.7;
            cursor: pointer;
            font-size: 1.25rem;
            line-height: 1;
        }

        .toast-close:hover {
            opacity: 1;
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 2rem;
            backdrop-filter: blur(4px);
        }

        .modal {
            background: var(--background-secondary);
            border-radius: var(--radius-xl);
            padding: 2.5rem;
            max-width: 640px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-large {
            max-width: 800px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-title {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.875rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.75rem;
            cursor: pointer;
            color: var(--text-secondary);
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition-fast);
        }

        .modal-close:hover {
            background: var(--gray-50);
            color: var(--text-primary);
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1001;
            background: var(--pneumology-light-blue);
            color: white;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: var(--radius-lg);
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
        }

        /* ============ RESPONSIVE DESIGN ============ */
        @media (max-width: 768px) {
            .login-container {
                padding: 1rem;
            }
            
            .login-card {
                padding: 2rem;
            }
            
            .role-selector {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                transform: translateX(-100%);
                width: 100%;
                max-width: 320px;
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .main-content.expanded {
                margin-left: 0;
            }
            
            .content-header {
                padding: 1.25rem;
                flex-direction: column;
                align-items: stretch;
                gap: 1.25rem;
            }
            
            .header-title {
                text-align: center;
            }
            
            .search-box {
                width: 100%;
            }
            
            .content-area {
                padding: 1.5rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .card-header {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            
            .card-actions {
                width: 100%;
                justify-content: center;
            }
            
            .tabs {
                padding: 0 1rem;
                overflow-x: auto;
            }
            
            .tab-btn {
                padding: 1rem 1.25rem;
            }
            
            .modal-overlay {
                padding: 1rem;
            }
            
            .modal {
                margin: 0;
                padding: 1.75rem;
            }
            
            .mobile-menu-toggle {
                display: flex;
            }
        }

        @media (max-width: 480px) {
            .login-card {
                padding: 1.5rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .person-card {
                flex-direction: column;
                text-align: center;
                gap: 1rem;
            }
            
            .person-info {
                text-align: center;
            }
            
            .person-actions {
                width: 100%;
                justify-content: center;
            }
        }

        /* Print Styles */
        @media print {
            .sidebar,
            .content-header,
            .btn,
            .mobile-menu-toggle {
                display: none !important;
            }
            
            .main-content {
                margin-left: 0 !important;
            }
            
            .card {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Login Screen -->
        <div v-if="!currentUser" class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <div class="login-logo">
                        <i class="fas fa-lungs"></i>
                    </div>
                    <h1 class="login-title">PneumoCare Pro</h1>
                    <div class="login-subtitle">Department of Pneumology Management System</div>
                    <div class="login-tagline">
                        <i class="fas fa-shield-alt"></i> HIPAA Compliant • Version 4.2
                    </div>
                </div>
                
                <div class="role-selector">
                    <div class="role-btn" :class="{ active: loginForm.user_role === 'resident_manager' }" 
                         @click="loginForm.user_role = 'resident_manager'">
                        <div class="role-icon">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <div class="role-name">Resident Manager</div>
                        <div class="role-desc">Manage residents, clinical units, and rotations</div>
                    </div>
                    
                    <div class="role-btn" :class="{ active: loginForm.user_role === 'department_head' }" 
                         @click="loginForm.user_role = 'department_head'">
                        <div class="role-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="role-name">Head of Department</div>
                        <div class="role-desc">Oversee department operations and staffing</div>
                    </div>
                </div>
                
                <form @submit.prevent="handleLogin" novalidate>
                    <div class="form-group">
                        <label class="form-label">Hospital Email</label>
                        <input type="email" class="form-input" v-model="loginForm.email" required
                               placeholder="name@hospital.com" autocomplete="username">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" v-model="loginForm.password" required
                               placeholder="Enter your password" autocomplete="current-password"
                               @keyup.enter="handleLogin">
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn" :disabled="loading" style="width: 100%;">
                            <span v-if="loading" class="loading-spinner"></span>
                            <span v-else>
                                <i class="fas fa-sign-in-alt"></i> Sign In as {{ loginForm.user_role === 'resident_manager' ? 'Resident Manager' : 'Head of Department' }}
                            </span>
                        </button>
                    </div>
                </form>
                
                <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-color); text-align: center;">
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">
                        <i class="fas fa-lock"></i> Secure Authentication • System ID: PC-PNEU-2024-001
                    </div>
                    <div style="font-size: 0.75rem; color: var(--gray-400); margin-top: 0.5rem;">
                        For technical support, contact: support@pneumocare.hospital
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <div v-else>
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" @click="toggleMobileMenu">
                <i class="fas fa-bars"></i>
            </button>

            <div class="app-container">
                <!-- Sidebar -->
                <div class="sidebar" :class="{ 
                    collapsed: sidebarCollapsed,
                    'mobile-open': mobileMenuOpen 
                }">
                    <div class="sidebar-header">
                        <div class="brand">
                            <div class="brand-logo">
                                <i class="fas fa-lungs"></i>
                            </div>
                            <div class="brand-text">
                                <h1>PneumoCare Pro</h1>
                                <div class="subtitle">PNEUMOLOGY DEPARTMENT</div>
                            </div>
                        </div>
                        <button class="collapse-toggle" @click="sidebarCollapsed = !sidebarCollapsed">
                            <i class="fas" :class="sidebarCollapsed ? 'fa-chevron-right' : 'fa-chevron-left'"></i>
                        </button>
                    </div>
                    
                    <nav class="sidebar-nav">
                        <!-- Role-based Navigation -->
                        <template v-if="currentUser.user_role === 'resident_manager'">
                            <button class="nav-item" :class="{ active: currentView === 'medical_staff' }" 
                                    @click="switchView('medical_staff'); closeMobileMenu()">
                                <i class="fas fa-user-md"></i>
                                <span>Medical Staff</span>
                            </button>
                            
                            <button class="nav-item" :class="{ active: currentView === 'clinical_units' }" 
                                    @click="switchView('clinical_units'); closeMobileMenu()">
                                <i class="fas fa-hospital-alt"></i>
                                <span>Clinical Units</span>
                            </button>
                            
                            <button class="nav-item" :class="{ active: currentView === 'resident_rotations' }" 
                                    @click="switchView('resident_rotations'); closeMobileMenu()">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Resident Rotations</span>
                            </button>
                            
                            <button class="nav-item" :class="{ active: currentView === 'placements' }" 
                                    @click="switchView('placements'); closeMobileMenu()">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>Placements</span>
                            </button>
                        </template>
                        
                        <template v-else-if="currentUser.user_role === 'department_head'">
                            <button class="nav-item" :class="{ active: currentView === 'department_overview' }" 
                                    @click="switchView('department_overview'); closeMobileMenu()">
                                <i class="fas fa-chart-line"></i>
                                <span>Department Overview</span>
                            </button>
                            
                            <button class="nav-item" :class="{ active: currentView === 'staff_management' }" 
                                    @click="switchView('staff_management'); closeMobileMenu()">
                                <i class="fas fa-users"></i>
                                <span>Staff Management</span>
                            </button>
                            
                            <button class="nav-item" :class="{ active: currentView === 'schedule_approval' }" 
                                    @click="switchView('schedule_approval'); closeMobileMenu()">
                                <i class="fas fa-calendar-check"></i>
                                <span>Schedule Approval</span>
                            </button>
                            
                            <button class="nav-item" :class="{ active: currentView === 'performance_metrics' }" 
                                    @click="switchView('performance_metrics'); closeMobileMenu()">
                                <i class="fas fa-chart-bar"></i>
                                <span>Performance Metrics</span>
                            </button>
                        </template>
                        
                        <!-- Shared Features -->
                        <div class="sidebar-divider"></div>
                        
                        <button class="nav-item" :class="{ active: currentView === 'daily_schedule' }" 
                                @click="switchView('daily_schedule'); closeMobileMenu()">
                            <i class="fas fa-calendar-day"></i>
                            <span>Daily Schedule</span>
                        </button>
                        
                        <button class="nav-item" :class="{ active: currentView === 'oncall_coverage' }" 
                                @click="switchView('oncall_coverage'); closeMobileMenu()">
                            <i class="fas fa-phone-alt"></i>
                            <span>On-call Coverage</span>
                        </button>
                        
                        <button class="nav-item" :class="{ active: currentView === 'leave_management' }" 
                                @click="switchView('leave_management'); closeMobileMenu()">
                            <i class="fas fa-calendar-times"></i>
                            <span>Leave Management</span>
                        </button>
                        
                        <button class="nav-item" :class="{ active: currentView === 'announcements' }" 
                                @click="switchView('announcements'); closeMobileMenu()">
                            <i class="fas fa-bullhorn"></i>
                            <span>Announcements</span>
                        </button>
                        
                        <button class="nav-item" :class="{ active: currentView === 'reports' }" 
                                @click="switchView('reports'); closeMobileMenu()">
                            <i class="fas fa-file-alt"></i>
                            <span>Reports & Analytics</span>
                        </button>
                    </nav>
                    
                    <div class="sidebar-footer">
                        <div class="user-info">
                            <div class="user-avatar">
                                {{ getInitials(currentUser.full_name) }}
                            </div>
                            <div class="user-details">
                                <div class="user-name">{{ currentUser.full_name }}</div>
                                <div class="user-role">{{ getUserRoleDisplay(currentUser.user_role) }}</div>
                            </div>
                        </div>
                        <div style="font-size: 0.7rem; color: rgba(255,255,255,0.5); margin-top: 0.5rem;">
                            ID: {{ currentUser.id.slice(0, 8) }} • Last login: {{ formatTimeAgo(currentUser.last_login) }}
                        </div>
                        <button class="btn btn-sm btn-outline" @click="handleLogout" style="margin-top: 1rem; width: 100%; background: rgba(255,255,255,0.1); border-color: rgba(255,255,255,0.3); color: white;">
                            <i class="fas fa-sign-out-alt"></i> Sign Out
                        </button>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="main-content" :class="{ expanded: sidebarCollapsed }">
                    <header class="content-header">
                        <div class="header-title">
                            <h1>{{ getCurrentTitle() }}</h1>
                            <div class="subtitle">
                                <i class="fas fa-calendar"></i> {{ formatDate(new Date()) }}
                                <span v-if="systemStatus.oncall_today" style="margin-left: 1rem; color: var(--pneumology-teal);">
                                    <i class="fas fa-phone-alt"></i> On-call: {{ systemStatus.oncall_today }}
                                </span>
                            </div>
                        </div>
                        <div class="header-actions">
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" 
                                       v-model="searchQuery" 
                                       :placeholder="getSearchPlaceholder()"
                                       @input="debouncedSearch"
                                       @keyup.esc="searchQuery = ''">
                            </div>
                            <div class="user-profile" @click="toggleUserMenu">
                                <div class="user-info-header">
                                    <div class="user-name-header">{{ currentUser.full_name }}</div>
                                    <div class="user-role-header">{{ getUserRoleDisplay(currentUser.user_role) }}</div>
                                </div>
                                <div class="user-avatar-header">{{ getInitials(currentUser.full_name) }}</div>
                            </div>
                        </div>
                    </header>

                    <!-- Toast Notifications Container -->
                    <div class="toast-container">
                        <div v-for="toast in toasts" :key="toast.id" class="toast" :class="toast.type">
                            <i :class="toast.icon"></i>
                            <span>{{ toast.message }}</span>
                            <button class="toast-close" @click="removeToast(toast.id)">×</button>
                        </div>
                    </div>

                    <!-- Content Area -->
                    <div class="content-area">
                        <!-- Loading State -->
                        <div v-if="loading && !currentViewData.length" class="loading-state">
                            <div class="loading-spinner"></div>
                            <p>Loading department data...</p>
                        </div>

                        <!-- Medical Staff Management -->
                        <div v-if="currentView === 'medical_staff' && currentUser.user_role === 'resident_manager'">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-user-md"></i>
                                        Medical Staff Management
                                    </div>
                                    <div class="card-actions">
                                        <button class="btn btn-teal" @click="showAddStaffModal">
                                            <i class="fas fa-user-plus"></i> Add Medical Staff
                                        </button>
                                        <button class="btn btn-outline" @click="exportStaffList">
                                            <i class="fas fa-download"></i> Export
                                        </button>
                                    </div>
                                </div>
                                <div class="card-content">
                                    <div class="metrics-grid">
                                        <div class="metric-card">
                                            <div class="metric-value">{{ systemStats.total_staff }}</div>
                                            <div class="metric-label">Total Medical Staff</div>
                                            <div class="metric-trend">
                                                <i class="fas fa-arrow-up"></i> 12% from last month
                                            </div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="metric-value">{{ systemStats.active_residents }}</div>
                                            <div class="metric-label">Active Residents</div>
                                            <div class="metric-trend">
                                                <i class="fas fa-user-check"></i> {{ systemStats.resident_vacancies }} vacancies
                                            </div>
                                        </div>

                                        <div class="metric-card">
                                            <div class="metric-value">{{ systemStats.attendings }}</div>
                                            <div class="metric-label">Attending Physicians</div>
                                            <div class="metric-trend">
                                                <i class="fas fa-stethoscope"></i> {{ systemStats.supervisors }} supervisors
                                            </div>
                                        </div>

                                        <div class="metric-card">
                                            <div class="metric-value">{{ systemStats.coverage_rate }}%</div>
                                            <div class="metric-label">Coverage Rate</div>
                                            <div class="metric-trend positive">
                                                <i class="fas fa-check-circle"></i> Optimal
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Staff List -->
                                    <div style="margin-top: 2rem;">
                                        <div class="tabs">
                                            <button class="tab-btn" :class="{ active: staffFilter.activeTab === 'all' }" 
                                                    @click="staffFilter.activeTab = 'all'">
                                                All Staff ({{ filteredMedicalStaff.length }})
                                            </button>
                                            <button class="tab-btn" :class="{ active: staffFilter.activeTab === 'residents' }" 
                                                    @click="staffFilter.activeTab = 'residents'">
                                                Residents ({{ residents.length }})
                                            </button>
                                            <button class="tab-btn" :class="{ active: staffFilter.activeTab === 'attendings' }" 
                                                    @click="staffFilter.activeTab = 'attendings'">
                                                Attendings ({{ attendings.length }})
                                            </button>
                                            <button class="tab-btn" :class="{ active: staffFilter.activeTab === 'oncall' }" 
                                                    @click="staffFilter.activeTab = 'oncall'">
                                                On-call Today ({{ onCallToday.length }})
                                            </button>
                                        </div>

                                        <div style="padding: 1.5rem 0;">
                                            <div class="form-grid" style="margin-bottom: 1.5rem;">
                                                <div>
                                                    <select class="form-select" v-model="staffFilter.staff_type" @change="filterStaff">
                                                        <option value="">All Staff Types</option>
                                                        <option value="attending_physician">Attending Physician</option>
                                                        <option value="pulmonology_fellow">Pulmonology Fellow</option>
                                                        <option value="medical_resident">Medical Resident</option>
                                                        <option value="nurse_practitioner">Nurse Practitioner</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <select class="form-select" v-model="staffFilter.employment_status" @change="filterStaff">
                                                        <option value="">All Status</option>
                                                        <option value="active">Active</option>
                                                        <option value="on_medical_leave">On Medical Leave</option>
                                                        <option value="on_vacation">On Vacation</option>
                                                        <option value="inactive">Inactive</option>
                                                    </select>
                                                </div>
                                                <div>
                                                    <input type="text" class="form-input" 
                                                           v-model="staffFilter.search" 
                                                           placeholder="Search by name or ID..."
                                                           @input="debouncedFilterStaff">
                                                </div>
                                            </div>

                                            <div v-if="filteredMedicalStaff.length > 0">
                                                <div class="person-card" v-for="staff in filteredMedicalStaff" :key="staff.id">
                                                    <div class="person-avatar" :class="staff.staff_type">
                                                        {{ getInitials(staff.full_name) }}
                                                    </div>
                                                    <div class="person-info">
                                                        <div class="person-name">
                                                            {{ staff.full_name }}
                                                            <span class="badge" :class="getStaffBadgeClass(staff.staff_type)">
                                                                {{ formatStaffType(staff.staff_type) }}
                                                            </span>
                                                            <span v-if="staff.can_supervise_residents" class="badge badge-attending">
                                                                <i class="fas fa-user-md"></i> Supervisor
                                                            </span>
                                                        </div>
                                                        <div class="person-id">
                                                            ID: {{ staff.staff_id }}
                                                            <span v-if="staff.primary_clinic" style="margin-left: 1rem;">
                                                                <i class="fas fa-map-marker-alt"></i> {{ staff.primary_clinic }}
                                                            </span>
                                                        </div>
                                                        <div class="person-meta">
                                                            <div v-if="staff.staff_type === 'medical_resident'">
                                                                <strong>Category:</strong> {{ formatResidentCategory(staff.resident_category) }}
                                                                <span v-if="staff.training_year"> • <strong>Year:</strong> PGY-{{ staff.training_year }}</span>
                                                            </div>
                                                            <div v-if="staff.professional_email">
                                                                <strong>Email:</strong> {{ staff.professional_email }}
                                                            </div>
                                                            <div style="margin-top: 0.5rem;">
                                                                <span class="status-pill" :class="getEmploymentStatusClass(staff.employment_status)">
                                                                    {{ formatEmploymentStatus(staff.employment_status) }}
                                                                </span>
                                                                <span v-if="staff.work_phone" style="margin-left: 1rem;">
                                                                    <i class="fas fa-phone"></i> {{ staff.work_phone }}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="person-actions">
                                                        <button class="btn btn-sm btn-outline" @click="viewStaffDetails(staff)">
                                                            <i class="fas fa-eye"></i> View
                                                        </button>
                                                        <button class="btn btn-sm" @click="editMedicalStaff(staff)" v-if="canEditStaff">
                                                            <i class="fas fa-edit"></i> Edit
                                                        </button>
                                                        <button class="btn btn-sm" @click="viewStaffSchedule(staff)">
                                                            <i class="fas fa-calendar"></i> Schedule
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div v-else class="empty-state">
                                                <i class="fas fa-user-md empty-state-icon"></i>
                                                <h3>No medical staff found</h3>
                                                <p>Add medical staff members to get started</p>
                                                <button class="btn btn-teal" @click="showAddStaffModal" style="margin-top: 1rem;">
                                                    <i class="fas fa-user-plus"></i> Add First Staff Member
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Clinical Units Management -->
                        <div v-else-if="currentView === 'clinical_units' && currentUser.user_role === 'resident_manager'">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-hospital-alt"></i>
                                        Clinical Units Management
                                    </div>
                                    <div class="card-actions">
                                        <button class="btn btn-teal" @click="showAddUnitModal">
                                            <i class="fas fa-plus"></i> Add Clinical Unit
                                        </button>
                                    </div>
                                </div>
                                <div class="card-content">
                                    <!-- Clinical Units will be implemented here -->
                                    <div class="empty-state">
                                        <i class="fas fa-hospital-alt empty-state-icon"></i>
                                        <h3>Clinical Units Management</h3>
                                        <p>Manage pulmonary clinical units, ICU beds, and outpatient clinics</p>
                                        <button class="btn btn-teal" @click="showAddUnitModal" style="margin-top: 1rem;">
                                            <i class="fas fa-plus"></i> Create First Clinical Unit
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Department Overview (HOD View) -->
                        <div v-else-if="currentView === 'department_overview' && currentUser.user_role === 'department_head'">
                            <div class="metrics-grid">
                                <div class="metric-card">
                                    <div class="metric-value">{{ departmentStats.total_staff }}</div>
                                    <div class="metric-label">Total Department Staff</div>
                                    <div class="metric-trend">
                                        {{ departmentStats.attendings }} Attendings • {{ departmentStats.residents }} Residents
                                    </div>
                                </div>
                                
                                <div class="metric-card">
                                    <div class="metric-value">{{ departmentStats.unit_occupancy }}%</div>
                                    <div class="metric-label">Unit Occupancy Rate</div>
                                    <div class="metric-trend" :class="departmentStats.unit_occupancy > 85 ? 'negative' : 'positive'">
                                        <i class="fas" :class="departmentStats.unit_occupancy > 85 ? 'fa-exclamation-triangle' : 'fa-check-circle'"></i>
                                        {{ departmentStats.unit_occupancy > 85 ? 'High Occupancy' : 'Optimal' }}
                                    </div>
                                </div>

                                <div class="metric-card">
                                    <div class="metric-value">{{ departmentStats.coverage_today }}%</div>
                                    <div class="metric-label">Coverage Today</div>
                                    <div class="metric-trend">
                                        <i class="fas fa-user-clock"></i> {{ departmentStats.on_leave }} on leave
                                    </div>
                                </div>

                                <div class="metric-card">
                                    <div class="metric-value">{{ departmentStats.compliance }}%</div>
                                    <div class="metric-label">Duty Hour Compliance</div>
                                    <div class="metric-trend">
                                        <i class="fas fa-exclamation-circle"></i> {{ departmentStats.duty_hour_alerts }} alerts
                                    </div>
                                </div>
                            </div>

                            <div class="card" style="margin-top: 2rem;">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-chart-line"></i>
                                        Department Performance Dashboard
                                    </div>
                                    <div class="card-actions">
                                        <button class="btn btn-outline" @click="exportDepartmentReport">
                                            <i class="fas fa-download"></i> Export Report
                                        </button>
                                        <button class="btn" @click="refreshDepartmentData">
                                            <i class="fas fa-sync-alt"></i> Refresh
                                        </button>
                                    </div>
                                </div>
                                <div class="card-content">
                                    <!-- Department analytics will be implemented here -->
                                    <div class="empty-state">
                                        <i class="fas fa-chart-line empty-state-icon"></i>
                                        <h3>Department Analytics Dashboard</h3>
                                        <p>Real-time performance metrics, occupancy rates, and compliance tracking</p>
                                        <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 2rem;">
                                            <button class="btn" @click="showStaffingReport">
                                                <i class="fas fa-users"></i> Staffing Report
                                            </button>
                                            <button class="btn btn-outline" @click="showComplianceReport">
                                                <i class="fas fa-clipboard-check"></i> Compliance Report
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Daily Schedule View -->
                        <div v-else-if="currentView === 'daily_schedule'">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-calendar-day"></i>
                                        Daily Clinical Schedule
                                    </div>
                                    <div class="card-actions">
                                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                                            <button class="btn btn-sm btn-outline" @click="prevDay">
                                                <i class="fas fa-chevron-left"></i>
                                            </button>
                                            <div style="font-weight: 600; min-width: 200px; text-align: center;">
                                                {{ formatDate(currentDate) }}
                                            </div>
                                            <button class="btn btn-sm btn-outline" @click="nextDay">
                                                <i class="fas fa-chevron-right"></i>
                                            </button>
                                            <button class="btn btn-sm" @click="currentDate = new Date().toISOString().split('T')[0]">
                                                Today
                                            </button>
                                        </div>
                                        <button class="btn btn-teal" @click="showAddAssignmentModal" v-if="canEditSchedule">
                                            <i class="fas fa-plus"></i> New Assignment
                                        </button>
                                    </div>
                                </div>
                                <div class="card-content">
                                    <!-- Daily schedule will be implemented here -->
                                    <div class="empty-state">
                                        <i class="fas fa-calendar-day empty-state-icon"></i>
                                        <h3>Daily Clinical Schedule</h3>
                                        <p>View and manage daily assignments, rounds, and procedures</p>
                                        <button class="btn btn-teal" @click="showAddAssignmentModal" style="margin-top: 1rem;">
                                            <i class="fas fa-plus"></i> Create First Assignment
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Default/Empty State -->
                        <div v-else>
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-home"></i>
                                        Welcome to PneumoCare Pro
                                    </div>
                                </div>
                                <div class="card-content">
                                    <div style="text-align: center; padding: 3rem;">
                                        <div style="font-size: 4rem; color: var(--pneumology-light-blue); margin-bottom: 1rem;">
                                            <i class="fas fa-lungs"></i>
                                        </div>
                                        <h2 style="margin-bottom: 1rem; color: var(--text-primary);">
                                            Department of Pneumology Management System
                                        </h2>
                                        <p style="color: var(--text-secondary); margin-bottom: 2rem; max-width: 600px; margin-left: auto; margin-right: auto;">
                                            A comprehensive platform for managing pulmonary department operations, 
                                            resident rotations, clinical schedules, and departmental analytics.
                                        </p>
                                        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                                            <button class="btn btn-lg" @click="switchView('medical_staff')">
                                                <i class="fas fa-user-md"></i> Manage Medical Staff
                                            </button>
                                            <button class="btn btn-lg btn-outline" @click="switchView('daily_schedule')">
                                                <i class="fas fa-calendar"></i> View Schedule
                                            </button>
                                            <button class="btn btn-lg btn-outline" @click="switchView('reports')">
                                                <i class="fas fa-chart-bar"></i> View Reports
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modals will be implemented here -->
            
            <!-- Add Medical Staff Modal -->
            <div v-if="showAddStaffModal" class="modal-overlay" @click.self="closeAddStaffModal">
                <div class="modal modal-large" @click.stop>
                    <div class="modal-header">
                        <div class="modal-title">
                            <i class="fas fa-user-plus"></i>
                            Add Medical Staff Member
                        </div>
                        <button class="modal-close" @click="closeAddStaffModal">×</button>
                    </div>
                    <form @submit.prevent="saveMedicalStaff">
                        <div class="card-content">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Full Name *</label>
                                    <input type="text" class="form-input" v-model="staffForm.full_name" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Professional Email</label>
                                    <input type="email" class="form-input" v-model="staffForm.professional_email">
                                </div>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Staff Type *</label>
                                    <select class="form-select" v-model="staffForm.staff_type" required @change="handleStaffTypeChange">
                                        <option value="">Select type</option>
                                        <option value="attending_physician">Attending Physician</option>
                                        <option value="pulmonology_fellow">Pulmonology Fellow</option>
                                        <option value="medical_resident">Medical Resident</option>
                                        <option value="nurse_practitioner">Nurse Practitioner</option>
                                        <option value="respiratory_therapist">Respiratory Therapist</option>
                                        <option value="department_admin">Department Administrator</option>
                                    </select>
                                </div>
                                <div v-if="staffForm.staff_type === 'medical_resident'" class="form-group">
                                    <label class="form-label">Resident Category *</label>
                                    <select class="form-select" v-model="staffForm.resident_category" required>
                                        <option value="">Select category</option>
                                        <option value="department_internal">Department Internal</option>
                                        <option value="rotating_external">Rotating External</option>
                                        <option value="visiting_international">Visiting International</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-grid">
                                <div v-if="staffForm.staff_type === 'medical_resident'" class="form-group">
                                    <label class="form-label">Training Year (PGY)</label>
                                    <select class="form-select" v-model="staffForm.training_year">
                                        <option value="">Select year</option>
                                        <option value="1">PGY-1</option>
                                        <option value="2">PGY-2</option>
                                        <option value="3">PGY-3</option>
                                        <option value="4">PGY-4</option>
                                        <option value="5">PGY-5+</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Primary Clinical Unit</label>
                                    <input type="text" class="form-input" v-model="staffForm.primary_clinic" placeholder="e.g., ICU Pulmonary, Outpatient Clinic">
                                </div>
                            </div>

                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Work Phone</label>
                                    <input type="tel" class="form-input" v-model="staffForm.work_phone">
                                </div>
                                <div v-if="staffForm.staff_type === 'attending_physician'" class="form-group">
                                    <label class="form-label" style="display: flex; align-items: center; gap: 0.5rem;">
                                        <input type="checkbox" v-model="staffForm.can_supervise_residents">
                                        Can Supervise Residents
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Employment Status *</label>
                                <select class="form-select" v-model="staffForm.employment_status" required>
                                    <option value="active">Active</option>
                                    <option value="on_medical_leave">On Medical Leave</option>
                                    <option value="on_vacation">On Vacation</option>
                                    <option value="inactive">Inactive</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Clinical Notes</label>
                                <textarea class="form-textarea" v-model="staffForm.special_notes" rows="3" placeholder="Special qualifications, languages spoken, etc."></textarea>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-outline" @click="closeAddStaffModal">Cancel</button>
                            <button type="submit" class="btn btn-teal" :disabled="saving">
                                <span v-if="saving" class="loading-spinner"></span>
                                <span v-else>
                                    <i class="fas fa-save"></i> Save Medical Staff
                                </span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted, watch } = Vue;

        // Supabase Configuration
        const supabaseUrl = 'https://vssmguzuvekkecbmwcjw.supabase.co';
        const supabaseAnonKey = 'sb_publishable_QDZP5eQTlHHn0SZibWFvCQ_6RqH2f01';
        const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseAnonKey);

        createApp({
            setup() {
                // ============ STATE MANAGEMENT ============
                
                // Authentication State
                const currentUser = ref(null);
                const loading = ref(false);
                const saving = ref(false);
                
                // Login Form
                const loginForm = ref({
                    email: '',
                    password: '',
                    user_role: 'resident_manager'
                });
                
                // Navigation State
                const currentView = ref('medical_staff');
                const sidebarCollapsed = ref(false);
                const mobileMenuOpen = ref(false);
                const searchQuery = ref('');
                
                // Data Stores
                const medicalStaff = ref([]);
                const clinicalUnits = ref([]);
                const residentRotations = ref([]);
                const dailyAssignments = ref([]);
                const leaveRequests = ref([]);
                const onCallSchedule = ref([]);
                const announcements = ref([]);
                
                // UI State
                const toasts = ref([]);
                const toastCounter = ref(0);
                
                // Modal States
                const showAddStaffModal = ref(false);
                const showAddUnitModal = ref(false);
                const showAddAssignmentModal = ref(false);
                
                // Form States
                const staffForm = ref({
                    full_name: '',
                    professional_email: '',
                    staff_type: '',
                    resident_category: '',
                    training_year: '',
                    primary_clinic: '',
                    work_phone: '',
                    can_supervise_residents: false,
                    employment_status: 'active',
                    special_notes: ''
                });
                
                // Filter States
                const staffFilter = ref({
                    activeTab: 'all',
                    staff_type: '',
                    employment_status: '',
                    search: ''
                });
                
                // Date State
                const currentDate = ref(new Date().toISOString().split('T')[0]);
                
                // System Stats
                const systemStats = ref({
                    total_staff: 0,
                    active_residents: 0,
                    attendings: 0,
                    supervisors: 0,
                    coverage_rate: 95,
                    resident_vacancies: 2
                });
                
                const departmentStats = ref({
                    total_staff: 0,
                    attendings: 0,
                    residents: 0,
                    unit_occupancy: 78,
                    coverage_today: 92,
                    on_leave: 3,
                    compliance: 94,
                    duty_hour_alerts: 1
                });
                
                const systemStatus = ref({
                    oncall_today: 'Dr. Sarah Johnson',
                    critical_alerts: 0,
                    pending_approvals: 2
                });

                // ============ UTILITY FUNCTIONS ============
                
                // Toast Management
                const showToast = (message, type = 'info', duration = 5000) => {
                    const icons = {
                        info: 'fas fa-info-circle',
                        success: 'fas fa-check-circle',
                        error: 'fas fa-exclamation-circle',
                        warning: 'fas fa-exclamation-triangle'
                    };
                    
                    const toast = {
                        id: ++toastCounter.value,
                        message,
                        type,
                        icon: icons[type] || icons.info
                    };
                    
                    toasts.value.push(toast);
                    
                    setTimeout(() => {
                        removeToast(toast.id);
                    }, duration);
                };
                
                const removeToast = (id) => {
                    const index = toasts.value.findIndex(t => t.id === id);
                    if (index > -1) {
                        toasts.value.splice(index, 1);
                    }
                };
                
                // Date Formatting
                const formatDate = (date) => {
                    if (!date) return '';
                    const d = new Date(date);
                    return d.toLocaleDateString('en-US', {
                        weekday: 'long',
                        month: 'long',
                        day: 'numeric',
                        year: 'numeric'
                    });
                };
                
                const formatTimeAgo = (dateString) => {
                    if (!dateString) return 'Never';
                    const date = new Date(dateString);
                    const now = new Date();
                    const diffMs = now - date;
                    const diffMins = Math.floor(diffMs / 60000);
                    const diffHours = Math.floor(diffMs / 3600000);
                    const diffDays = Math.floor(diffMs / 86400000);
                    
                    if (diffMins < 60) return `${diffMins}m ago`;
                    if (diffHours < 24) return `${diffHours}h ago`;
                    if (diffDays < 7) return `${diffDays}d ago`;
                    return date.toLocaleDateString();
                };
                
                const formatDateShort = (dateString) => {
                    if (!dateString) return '';
                    const date = new Date(dateString);
                    return date.toLocaleDateString('en-US', {
                        month: 'short',
                        day: 'numeric'
                    });
                };
                
                // Text Utilities
                const getInitials = (name) => {
                    if (!name) return '??';
                    return name
                        .split(' ')
                        .map(n => n[0])
                        .join('')
                        .toUpperCase()
                        .substring(0, 2);
                };
                
                const getUserRoleDisplay = (role) => {
                    const roles = {
                        resident_manager: 'Resident Manager',
                        department_head: 'Head of Department',
                        system_admin: 'System Administrator',
                        viewing_doctor: 'Viewing Doctor'
                    };
                    return roles[role] || role;
                };
                
                const formatStaffType = (type) => {
                    const types = {
                        attending_physician: 'Attending Physician',
                        pulmonology_fellow: 'Pulmonology Fellow',
                        medical_resident: 'Medical Resident',
                        nurse_practitioner: 'Nurse Practitioner',
                        respiratory_therapist: 'Respiratory Therapist',
                        department_admin: 'Department Administrator'
                    };
                    return types[type] || type;
                };
                
                const formatResidentCategory = (category) => {
                    const categories = {
                        department_internal: 'Department Internal',
                        rotating_external: 'Rotating External',
                        visiting_international: 'Visiting International'
                    };
                    return categories[category] || category;
                };
                
                const formatEmploymentStatus = (status) => {
                    const statuses = {
                        active: 'Active',
                        on_medical_leave: 'On Medical Leave',
                        on_vacation: 'On Vacation',
                        inactive: 'Inactive'
                    };
                    return statuses[status] || status;
                };
                
                const getStaffBadgeClass = (staffType) => {
                    const classes = {
                        medical_resident: 'badge-resident',
                        attending_physician: 'badge-attending',
                        pulmonology_fellow: 'badge-resident',
                        nurse_practitioner: 'badge-admin',
                        respiratory_therapist: 'badge-admin',
                        department_admin: 'badge-admin'
                    };
                    return classes[staffType] || 'badge-admin';
                };
                
                const getEmploymentStatusClass = (status) => {
                    const classes = {
                        active: 'status-active',
                        on_medical_leave: 'status-pending',
                        on_vacation: 'status-pending',
                        inactive: 'status-inactive'
                    };
                    return classes[status] || 'status-inactive';
                };
                
                // Debounce Function
                const debounce = (fn, delay) => {
                    let timeoutId;
                    return (...args) => {
                        clearTimeout(timeoutId);
                        timeoutId = setTimeout(() => fn(...args), delay);
                    };
                };

                // ============ COMPUTED PROPERTIES ============
                
                // Permission Checks
                const canEditStaff = computed(() => {
                    return ['resident_manager', 'department_head', 'system_admin'].includes(currentUser.value?.user_role);
                });
                
                const canEditSchedule = computed(() => {
                    return ['resident_manager', 'department_head'].includes(currentUser.value?.user_role);
                });
                
                // Filtered Data
                const residents = computed(() => {
                    return medicalStaff.value.filter(s => s.staff_type === 'medical_resident' && s.employment_status === 'active');
                });
                
                const attendings = computed(() => {
                    return medicalStaff.value.filter(s => s.staff_type === 'attending_physician' && s.employment_status === 'active');
                });
                
                const onCallToday = computed(() => {
                    // This would be populated from onCallSchedule data
                    return [];
                });
                
                const filteredMedicalStaff = computed(() => {
                    let filtered = medicalStaff.value;
                    
                    // Apply tab filter
                    if (staffFilter.value.activeTab === 'residents') {
                        filtered = filtered.filter(s => s.staff_type === 'medical_resident');
                    } else if (staffFilter.value.activeTab === 'attendings') {
                        filtered = filtered.filter(s => s.staff_type === 'attending_physician');
                    } else if (staffFilter.value.activeTab === 'oncall') {
                        filtered = onCallToday.value;
                    }
                    
                    // Apply type filter
                    if (staffFilter.value.staff_type) {
                        filtered = filtered.filter(s => s.staff_type === staffFilter.value.staff_type);
                    }
                    
                    // Apply status filter
                    if (staffFilter.value.employment_status) {
                        filtered = filtered.filter(s => s.employment_status === staffFilter.value.employment_status);
                    }
                    
                    // Apply search filter
                    if (staffFilter.value.search) {
                        const search = staffFilter.value.search.toLowerCase();
                        filtered = filtered.filter(s => 
                            s.full_name.toLowerCase().includes(search) ||
                            s.staff_id?.toLowerCase().includes(search) ||
                            s.professional_email?.toLowerCase().includes(search)
                        );
                    }
                    
                    return filtered;
                });
                
                const currentViewData = computed(() => {
                    switch (currentView.value) {
                        case 'medical_staff': return medicalStaff.value;
                        case 'clinical_units': return clinicalUnits.value;
                        case 'resident_rotations': return residentRotations.value;
                        case 'daily_schedule': return dailyAssignments.value;
                        default: return [];
                    }
                });

                // ============ AUTHENTICATION FUNCTIONS ============
                
                const handleLogin = async () => {
                    loading.value = true;
                    
                    try {
                        const email = loginForm.value.email.trim().toLowerCase();
                        const password = loginForm.value.password;
                        const selectedRole = loginForm.value.user_role;
                        
                        // Validate inputs
                        if (!email || !password || !selectedRole) {
                            throw new Error('Please fill in all fields');
                        }
                        
                        console.log('Attempting login with:', { email, selectedRole });
                        
                        // Try Supabase authentication
                        const { data: authData, error: authError } = await supabaseClient.auth.signInWithPassword({
                            email: email,
                            password: password
                        });
                        
                        if (authError) {
                            console.error('Auth error:', authError);
                            
                            // Check if it's an invalid credentials error
                            if (authError.message.includes('Invalid login credentials')) {
                                showToast('Invalid email or password. Please try again.', 'error');
                                loading.value = false;
                                return;
                            }
                            
                            throw authError;
                        }
                        
                        console.log('Auth successful, user ID:', authData.user.id);
                        
                        // Now get or create app_users record
                        await handleAuthenticatedUser(authData.user, selectedRole);
                        
                    } catch (error) {
                        console.error('Login error:', error);
                        showToast(error.message || 'Login failed. Please check your credentials.', 'error');
                        loading.value = false;
                    }
                };
                
                const handleAuthenticatedUser = async (authUser, selectedRole) => {
                    try {
                        console.log('Getting app_users record for user:', authUser.id);
                        
                        // Query by 'id' NOT 'user_id'
                        const { data: userData, error: userError } = await supabaseClient
                            .from('app_users')
                            .select('*')
                            .eq('id', authUser.id)  // CORRECT: Use 'id' column
                            .single();
                        
                        if (userError || !userData) {
                            console.log('No app_users record found, creating new one...');
                            
                            // Create new app_users record
                            const { data: newUser, error: createError } = await supabaseClient
                                .from('app_users')
                                .insert([{
                                    id: authUser.id,  // This MUST match auth.users.id
                                    email: authUser.email,
                                    full_name: authUser.email.split('@')[0] || 'User',
                                    user_role: selectedRole,
                                    department: 'Pneumology',
                                    created_at: new Date().toISOString(),
                                    updated_at: new Date().toISOString()
                                }])
                                .select()
                                .single();
                            
                            if (createError) {
                                console.error('Error creating app_users record:', createError);
                                
                                // If it's a duplicate key error, try to fetch again
                                if (createError.code === '23505') { // duplicate key
                                    const { data: existingUser } = await supabaseClient
                                        .from('app_users')
                                        .select('*')
                                        .eq('id', authUser.id)
                                        .single();
                                    
                                    if (existingUser) {
                                        currentUser.value = {
                                            ...existingUser,
                                            user_role: existingUser.user_role || selectedRole
                                        };
                                        await completeLogin();
                                        return;
                                    }
                                }
                                throw createError;
                            }
                            
                            currentUser.value = {
                                ...newUser,
                                user_role: selectedRole
                            };
                        } else {
                            console.log('Found existing app_users record:', userData);
                            
                            // Update user_role if it's different (optional)
                            if (userData.user_role !== selectedRole) {
                                const { error: updateError } = await supabaseClient
                                    .from('app_users')
                                    .update({ 
                                        user_role: selectedRole,
                                        updated_at: new Date().toISOString()
                                    })
                                    .eq('id', authUser.id);
                                
                                if (updateError) {
                                    console.warn('Could not update user role:', updateError);
                                }
                            }
                            
                            currentUser.value = {
                                ...userData,
                                user_role: selectedRole
                            };
                        }
                        
                        await completeLogin();
                        
                    } catch (error) {
                        console.error('Error in handleAuthenticatedUser:', error);
                        throw error;
                    }
                };
                
                const completeLogin = async () => {
                    try {
                        // Update last login time
                        const { error: updateError } = await supabaseClient
                            .from('app_users')
                            .update({ 
                                last_login: new Date().toISOString(),
                                updated_at: new Date().toISOString()
                            })
                            .eq('id', currentUser.value.id);
                        
                        if (updateError) {
                            console.warn('Could not update last login:', updateError);
                        }
                        
                        // Load initial data
                        await loadInitialData();
                        
                        // Set initial view based on role
                        if (currentUser.value.user_role === 'resident_manager') {
                            currentView.value = 'medical_staff';
                        } else if (currentUser.value.user_role === 'department_head') {
                            currentView.value = 'department_overview';
                        } else if (currentUser.value.user_role === 'system_admin') {
                            currentView.value = 'medical_staff';
                        } else if (currentUser.value.user_role === 'viewing_doctor') {
                            currentView.value = 'daily_schedule';
                        }
                        
                        showToast(`Welcome, ${currentUser.value.full_name}!`, 'success');
                        
                    } catch (error) {
                        console.error('Error in completeLogin:', error);
                        throw error;
                    } finally {
                        loading.value = false;
                    }
                };
                
                const handleLogout = async () => {
                    try {
                        await supabaseClient.auth.signOut();
                        currentUser.value = null;
                        showToast('Successfully logged out', 'info');
                    } catch (error) {
                        console.error('Logout error:', error);
                        showToast('Error logging out', 'error');
                    }
                };

                // ============ DATA LOADING FUNCTIONS ============
                
                const loadInitialData = async () => {
                    loading.value = true;
                    try {
                        await Promise.all([
                            loadMedicalStaff(),
                            loadClinicalUnits(),
                            loadSystemStats()
                        ]);
                    } catch (error) {
                        console.error('Error loading initial data:', error);
                        showToast('Error loading system data', 'error');
                    } finally {
                        loading.value = false;
                    }
                };
                
                const loadMedicalStaff = async () => {
                    try {
                        const { data, error } = await supabaseClient
                            .from('medical_staff')
                            .select('*')
                            .order('full_name');
                        
                        if (error) throw error;
                        
                        medicalStaff.value = data;
                        
                        // Update stats
                        systemStats.value.total_staff = data.length;
                        systemStats.value.active_residents = data.filter(s => 
                            s.staff_type === 'medical_resident' && s.employment_status === 'active'
                        ).length;
                        systemStats.value.attendings = data.filter(s => 
                            s.staff_type === 'attending_physician' && s.employment_status === 'active'
                        ).length;
                        systemStats.value.supervisors = data.filter(s => 
                            s.can_supervise_residents && s.employment_status === 'active'
                        ).length;
                        
                    } catch (error) {
                        console.error('Error loading medical staff:', error);
                        throw error;
                    }
                };
                
                const loadClinicalUnits = async () => {
                    try {
                        const { data, error } = await supabaseClient
                            .from('training_units')
                            .select('*')
                            .order('unit_name');
                        
                        if (error) throw error;
                        clinicalUnits.value = data;
                    } catch (error) {
                        console.error('Error loading clinical units:', error);
                        throw error;
                    }
                };
                
                const loadSystemStats = async () => {
                    // This would load additional system statistics
                    // For now, we'll use mock data
                    departmentStats.value.total_staff = medicalStaff.value.length;
                    departmentStats.value.attendings = medicalStaff.value.filter(s => 
                        s.staff_type === 'attending_physician'
                    ).length;
                    departmentStats.value.residents = medicalStaff.value.filter(s => 
                        s.staff_type === 'medical_resident'
                    ).length;
                };

                // ============ UI FUNCTIONS ============
                
                const switchView = async (view) => {
                    currentView.value = view;
                    closeMobileMenu();
                    
                    // Load view-specific data
                    try {
                        switch (view) {
                            case 'medical_staff':
                                await loadMedicalStaff();
                                break;
                            case 'clinical_units':
                                await loadClinicalUnits();
                                break;
                            // Add other view data loads here
                        }
                    } catch (error) {
                        console.error(`Error loading ${view} data:`, error);
                        showToast(`Error loading ${view} data`, 'error');
                    }
                };
                
                const getCurrentTitle = () => {
                    const titles = {
                        medical_staff: 'Medical Staff Management',
                        clinical_units: 'Clinical Units',
                        resident_rotations: 'Resident Rotations',
                        placements: 'Placements',
                        department_overview: 'Department Overview',
                        staff_management: 'Staff Management',
                        schedule_approval: 'Schedule Approval',
                        performance_metrics: 'Performance Metrics',
                        daily_schedule: 'Daily Clinical Schedule',
                        oncall_coverage: 'On-call Coverage',
                        leave_management: 'Leave Management',
                        announcements: 'Announcements',
                        reports: 'Reports & Analytics'
                    };
                    
                    return titles[currentView.value] || 'PneumoCare Pro';
                };
                
                const getSearchPlaceholder = () => {
                    const placeholders = {
                        medical_staff: 'Search medical staff by name, ID, or email...',
                        clinical_units: 'Search clinical units...',
                        daily_schedule: 'Search assignments...',
                        reports: 'Search reports...'
                    };
                    
                    return placeholders[currentView.value] || 'Search...';
                };
                
                const toggleMobileMenu = () => {
                    mobileMenuOpen.value = !mobileMenuOpen.value;
                };
                
                const closeMobileMenu = () => {
                    mobileMenuOpen.value = false;
                };
                
                const toggleUserMenu = () => {
                    // User menu functionality would go here
                    showToast('User menu would open here', 'info');
                };
                
                const debouncedSearch = debounce(() => {
                    // Search functionality
                    console.log('Searching for:', searchQuery.value);
                }, 300);
                
                const debouncedFilterStaff = debounce(() => {
                    // Filter staff - computed property handles this
                }, 300);
                
                const filterStaff = () => {
                    // Trigger filter update
                };

                // ============ MEDICAL STAFF MANAGEMENT ============
                
                const showAddStaffModal = () => {
                    staffForm.value = {
                        full_name: '',
                        professional_email: '',
                        staff_type: '',
                        resident_category: '',
                        training_year: '',
                        primary_clinic: '',
                        work_phone: '',
                        can_supervise_residents: false,
                        employment_status: 'active',
                        special_notes: ''
                    };
                    showAddStaffModal.value = true;
                };
                
                const closeAddStaffModal = () => {
                    showAddStaffModal.value = false;
                };
                
                const handleStaffTypeChange = () => {
                    // Reset resident-specific fields if not a resident
                    if (staffForm.value.staff_type !== 'medical_resident') {
                        staffForm.value.resident_category = '';
                        staffForm.value.training_year = '';
                    }
                    
                    // Reset supervisor flag if not an attending
                    if (staffForm.value.staff_type !== 'attending_physician') {
                        staffForm.value.can_supervise_residents = false;
                    }
                };
                
                const saveMedicalStaff = async () => {
                    saving.value = true;
                    
                    try {
                        // Validate form
                        if (!staffForm.value.full_name || !staffForm.value.staff_type) {
                            throw new Error('Please fill in all required fields');
                        }
                        
                        // Prepare staff data
                        const staffData = {
                            ...staffForm.value,
                            // Generate a staff ID if needed
                            staff_id: `STAFF-${Date.now().toString().slice(-6)}`
                        };
                        
                        // Insert into database
                        const { data, error } = await supabaseClient
                            .from('medical_staff')
                            .insert([staffData])
                            .select()
                            .single();
                        
                        if (error) throw error;
                        
                        // Add to local state
                        medicalStaff.value.push(data);
                        
                        // Update stats
                        systemStats.value.total_staff++;
                        if (data.staff_type === 'medical_resident' && data.employment_status === 'active') {
                            systemStats.value.active_residents++;
                        } else if (data.staff_type === 'attending_physician' && data.employment_status === 'active') {
                            systemStats.value.attendings++;
                            if (data.can_supervise_residents) {
                                systemStats.value.supervisors++;
                            }
                        }
                        
                        showToast('Medical staff member added successfully', 'success');
                        closeAddStaffModal();
                        
                    } catch (error) {
                        console.error('Error saving medical staff:', error);
                        showToast('Error saving medical staff: ' + error.message, 'error');
                    } finally {
                        saving.value = false;
                    }
                };
                
                const editMedicalStaff = (staff) => {
                    // Implement edit functionality
                    showToast(`Editing ${staff.full_name} - Not implemented yet`, 'info');
                };
                
                const viewStaffDetails = (staff) => {
                    // Implement view details functionality
                    showToast(`Viewing details for ${staff.full_name} - Not implemented yet`, 'info');
                };
                
                const viewStaffSchedule = (staff) => {
                    // Implement view schedule functionality
                    showToast(`Viewing schedule for ${staff.full_name} - Not implemented yet`, 'info');
                };
                
                const exportStaffList = () => {
                    // Implement export functionality
                    showToast('Exporting staff list - Not implemented yet', 'info');
                };

                // ============ OTHER UI FUNCTIONS ============
                
                const showAddUnitModal = () => {
                    showToast('Add clinical unit modal - Not implemented yet', 'info');
                };
                
                const showAddAssignmentModal = () => {
                    showToast('Add assignment modal - Not implemented yet', 'info');
                };
                
                const prevDay = () => {
                    const date = new Date(currentDate.value);
                    date.setDate(date.getDate() - 1);
                    currentDate.value = date.toISOString().split('T')[0];
                };
                
                const nextDay = () => {
                    const date = new Date(currentDate.value);
                    date.setDate(date.getDate() + 1);
                    currentDate.value = date.toISOString().split('T')[0];
                };
                
                const exportDepartmentReport = () => {
                    showToast('Exporting department report - Not implemented yet', 'info');
                };
                
                const refreshDepartmentData = async () => {
                    loading.value = true;
                    try {
                        await loadMedicalStaff();
                        await loadSystemStats();
                        showToast('Department data refreshed', 'success');
                    } catch (error) {
                        console.error('Error refreshing data:', error);
                        showToast('Error refreshing data', 'error');
                    } finally {
                        loading.value = false;
                    }
                };
                
                const showStaffingReport = () => {
                    showToast('Showing staffing report - Not implemented yet', 'info');
                };
                
                const showComplianceReport = () => {
                    showToast('Showing compliance report - Not implemented yet', 'info');
                };

                // ============ LIFECYCLE HOOKS ============
                
                onMounted(() => {
                    // Check for existing session
                    supabaseClient.auth.getSession().then(({ data: { session } }) => {
                        if (session) {
                            // User is already logged in
                            handleAuthenticatedUser(session.user, 'resident_manager');
                        }
                    });
                    
                    // Set current date
                    currentDate.value = new Date().toISOString().split('T')[0];
                });

                // ============ RETURN ============
                
                return {
                    // State
                    currentUser,
                    loading,
                    saving,
                    loginForm,
                    currentView,
                    sidebarCollapsed,
                    mobileMenuOpen,
                    searchQuery,
                    medicalStaff,
                    clinicalUnits,
                    toasts,
                    showAddStaffModal,
                    showAddUnitModal,
                    showAddAssignmentModal,
                    staffForm,
                    staffFilter,
                    currentDate,
                    systemStats,
                    departmentStats,
                    systemStatus,
                    
                    // Computed
                    residents,
                    attendings,
                    onCallToday,
                    filteredMedicalStaff,
                    currentViewData,
                    canEditStaff,
                    canEditSchedule,
                    
                    // Authentication
                    handleLogin,
                    handleLogout,
                    
                    // UI Functions
                    switchView,
                    getCurrentTitle,
                    getSearchPlaceholder,
                    toggleMobileMenu,
                    closeMobileMenu,
                    toggleUserMenu,
                    debouncedSearch,
                    debouncedFilterStaff,
                    filterStaff,
                    prevDay,
                    nextDay,
                    
                    // Utility Functions
                    showToast,
                    removeToast,
                    formatDate,
                    formatTimeAgo,
                    formatDateShort,
                    getInitials,
                    getUserRoleDisplay,
                    formatStaffType,
                    formatResidentCategory,
                    formatEmploymentStatus,
                    getStaffBadgeClass,
                    getEmploymentStatusClass,
                    
                    // Medical Staff Management
                    showAddStaffModal: () => showAddStaffModal.value = true,
                    closeAddStaffModal,
                    handleStaffTypeChange,
                    saveMedicalStaff,
                    editMedicalStaff,
                    viewStaffDetails,
                    viewStaffSchedule,
                    exportStaffList,
                    
                    // Other Functions
                    showAddUnitModal: () => showAddUnitModal.value = true,
                    showAddAssignmentModal: () => showAddAssignmentModal.value = true,
                    exportDepartmentReport,
                    refreshDepartmentData,
                    showStaffingReport,
                    showComplianceReport
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
