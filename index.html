<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PneumoCare Pro | Academic Pulmonary Management</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* All the CSS styles remain exactly the same as in your original code */
        :root {
            --medical-deep-blue: #003366;
            --medical-blue: #005b8e;
            --medical-teal: #008c8c;
            --medical-green: #10b981;
            --medical-amber: #f59e0b;
            --medical-red: #ef4444;
            --medical-purple: #8b5cf6;
            --medical-cyan: #06b6d4;
            
            --gray-10: #f8fafc;
            --gray-50: #f1f5f9;
            --gray-100: #e2e8f0;
            --gray-200: #cbd5e1;
            --gray-300: #94a3b8;
            --gray-400: #64748b;
            --gray-500: #475569;
            --gray-600: #334155;
            --gray-700: #1e293b;
            --gray-800: #0f172a;
            
            --primary: var(--medical-deep-blue);
            --secondary: var(--medical-blue);
            --accent: var(--medical-teal);
            --success: var(--medical-green);
            --warning: var(--medical-amber);
            --error: var(--medical-red);
            
            --text-primary: var(--gray-800);
            --text-secondary: var(--gray-600);
            --background-primary: #f8fafc;
            --background-secondary: #ffffff;
            --border-light: var(--gray-200);
            
            --shadow-subtle: 0 1px 3px rgba(0, 0, 0, 0.05);
            --shadow-medium: 0 4px 6px -1px rgba(0, 0, 0, 0.08);
            --shadow-large: 0 10px 15px -3px rgba(0, 0, 0, 0.08);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-medium: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
            
            --border-radius-sm: 4px;
            --border-radius-md: 8px;
            --border-radius-lg: 12px;
            --border-radius-xl: 16px;
            
            --focus-ring: 0 0 0 3px rgba(0, 91, 142, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--background-primary);
            color: var(--text-primary);
            line-height: 1.6;
            font-weight: 400;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Login Container */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #003366 0%, #005b8e 100%);
            padding: 2rem;
        }

        .login-card {
            background: white;
            border-radius: var(--border-radius-xl);
            padding: 3rem;
            width: 100%;
            max-width: 480px;
            box-shadow: var(--shadow-xl);
        }

        .login-header {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--medical-blue), var(--medical-teal));
            border-radius: var(--border-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            margin: 0 auto 1.5rem;
        }

        .login-title {
            font-size: 2rem;
            font-weight: 800;
            color: var(--medical-deep-blue);
            margin-bottom: 0.5rem;
        }

        .login-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .role-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .role-btn {
            padding: 1.25rem;
            border: 2px solid var(--border-light);
            background: white;
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            transition: var(--transition-fast);
            text-align: center;
        }

        .role-btn:hover {
            border-color: var(--medical-blue);
            background: var(--gray-50);
        }

        .role-btn.active {
            border-color: var(--medical-blue);
            background: rgba(0, 91, 142, 0.1);
        }

        .role-icon {
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--medical-blue);
        }

        .role-name {
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .role-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* App Container */
        .app-container {
            display: flex;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, 
                var(--medical-deep-blue) 0%, 
                #004080 50%, 
                var(--medical-blue) 100%);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            box-shadow: var(--shadow-large);
            z-index: 1000;
            border-right: 1px solid rgba(255,255,255,0.1);
            transition: var(--transition-medium);
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar-header {
            padding: 1.75rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            position: relative;
        }

        .collapse-toggle {
            position: absolute;
            right: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.12);
            border: none;
            color: white;
            width: 28px;
            height: 28px;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .brand-logo {
            width: 52px;
            height: 52px;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0.05));
            border-radius: var(--border-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .brand-text {
            color: white;
            flex: 1;
        }

        .brand-text h1 {
            font-size: 1.35rem;
            font-weight: 700;
            margin-bottom: 4px;
            letter-spacing: -0.25px;
        }

        .brand-text .subtitle {
            font-size: 0.8rem;
            opacity: 0.85;
            font-weight: 500;
            letter-spacing: 0.5px;
            color: rgba(255,255,255,0.8);
        }

        .sidebar-nav {
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            gap: 0.375rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.875rem 1.25rem;
            border: none;
            background: none;
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            color: rgba(255,255,255,0.85);
            transition: var(--transition-medium);
            font-size: 0.95rem;
            font-weight: 500;
            position: relative;
            text-align: left;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.12);
            color: white;
        }

        .nav-item.active {
            background: rgba(255,255,255,0.15);
            color: white;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: var(--transition-medium);
        }

        .main-content.expanded {
            margin-left: 80px;
        }

        .content-header {
            background: var(--background-secondary);
            padding: 1.5rem 2.5rem;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-subtle);
        }

        .header-title h1 {
            font-size: 1.85rem;
            font-weight: 800;
            margin-bottom: 6px;
            color: var(--text-primary);
        }

        .header-title .subtitle {
            color: var(--text-secondary);
            font-size: 0.925rem;
            font-weight: 500;
        }

        .search-box {
            position: relative;
            width: 320px;
        }

        .search-box input {
            width: 100%;
            padding: 0.875rem 1.25rem 0.875rem 3rem;
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius-lg);
            background: var(--background-secondary);
            font-size: 0.925rem;
            transition: var(--transition-medium);
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--medical-blue);
            box-shadow: var(--focus-ring);
        }

        .search-icon {
            position: absolute;
            left: 1.25rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.625rem 0.875rem;
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: 700;
            font-size: 0.925rem;
        }

        .user-role {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--medical-purple), var(--medical-cyan));
            border-radius: var(--border-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 0.95rem;
        }

        .content-area {
            padding: 2.5rem;
            flex: 1;
        }

        /* Cards */
        .card {
            background: var(--background-secondary);
            border-radius: var(--border-radius-xl);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-medium);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .card-header {
            padding: 1.75rem 2rem;
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-title {
            display: flex;
            align-items: center;
            gap: 0.875rem;
            font-size: 1.35rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .card-content {
            padding: 2rem;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .metric-card {
            background: var(--background-secondary);
            border-radius: var(--border-radius-xl);
            padding: 2rem;
            border: 1px solid var(--border-light);
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--medical-blue), var(--medical-teal));
        }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--medical-blue);
            margin-bottom: 0.75rem;
            line-height: 1;
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        /* Status Indicators */
        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-available {
            background: rgba(0, 91, 142, 0.1);
            color: var(--medical-blue);
            border: 1px solid rgba(0, 91, 142, 0.2);
        }

        .status-oncall {
            background: rgba(139, 92, 246, 0.1);
            color: var(--medical-purple);
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .status-busy {
            background: rgba(245, 158, 11, 0.1);
            color: var(--medical-amber);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .status-reported {
            background: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .status-approved {
            background: rgba(16, 185, 129, 0.1);
            color: var(--medical-green);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-offline {
            background: rgba(100, 116, 139, 0.1);
            color: var(--gray-500);
            border: 1px solid rgba(100, 116, 139, 0.2);
        }

        .status-completed {
            background: rgba(6, 182, 212, 0.1);
            color: var(--medical-cyan);
            border: 1px solid rgba(6, 182, 212, 0.2);
        }

        .status-resident {
            background: rgba(139, 92, 246, 0.1);
            color: var(--medical-purple);
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .status-attending {
            background: rgba(0, 91, 142, 0.1);
            color: var(--medical-blue);
            border: 1px solid rgba(0, 91, 142, 0.2);
        }

        /* Buttons */
        .btn {
            background: var(--medical-blue);
            color: white;
            border: none;
            padding: 0.875rem 1.75rem;
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            font-weight: 700;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.925rem;
            transition: var(--transition-fast);
        }

        .btn:hover {
            background: var(--medical-deep-blue);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--medical-blue);
            color: var(--medical-blue);
        }

        .btn-outline:hover {
            background: var(--medical-blue);
            color: white;
        }

        .btn-sm {
            padding: 0.625rem 1.25rem;
            font-size: 0.875rem;
        }

        .btn-success {
            background: var(--medical-green);
        }

        .btn-warning {
            background: var(--medical-amber);
        }

        .btn-danger {
            background: var(--medical-red);
        }

        .btn-resident {
            background: var(--medical-purple);
        }

        /* Person Cards */
        .person-card {
            display: flex;
            align-items: center;
            gap: 1.25rem;
            padding: 1.25rem;
            background: var(--background-secondary);
            border-radius: var(--border-radius-lg);
            border: 1px solid var(--border-light);
            margin-bottom: 0.875rem;
        }

        .person-avatar {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, var(--medical-blue), var(--medical-cyan));
            border-radius: var(--border-radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
            font-weight: 800;
            flex-shrink: 0;
        }

        .person-avatar.resident {
            background: linear-gradient(135deg, var(--medical-purple), var(--medical-cyan));
        }

        .person-info {
            flex: 1;
        }

        .person-name {
            font-weight: 800;
            margin-bottom: 4px;
            color: var(--text-primary);
            font-size: 1.05rem;
        }

        .person-clinic {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 4px;
        }

        .person-meta {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 2px;
            line-height: 1.5;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            padding: 0 2rem;
            background: var(--gray-50);
            border-bottom: 1px solid var(--border-light);
        }

        .tab-btn {
            padding: 1.25rem 1.75rem;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 700;
            color: var(--text-secondary);
            border-bottom: 3px solid transparent;
            transition: var(--transition-fast);
        }

        .tab-btn:hover {
            color: var(--text-primary);
        }

        .tab-btn.active {
            color: var(--medical-blue);
            border-bottom-color: var(--medical-blue);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1.75rem;
        }

        .form-label {
            display: block;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--text-primary);
            font-size: 0.95rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.875rem 1.25rem;
            border: 2px solid var(--border-light);
            border-radius: var(--border-radius-lg);
            background: var(--background-secondary);
            font-size: 0.95rem;
            transition: var(--transition-medium);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--medical-blue);
            box-shadow: var(--focus-ring);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            padding-top: 1.75rem;
            border-top: 1px solid var(--border-light);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 2rem;
        }

        .modal {
            background: var(--background-secondary);
            border-radius: var(--border-radius-xl);
            padding: 2.5rem;
            max-width: 640px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        .modal-large {
            max-width: 800px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--border-light);
        }

        .modal-title {
            font-size: 1.75rem;
            font-weight: 800;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.875rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.75rem;
            cursor: pointer;
            color: var(--text-secondary);
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-close:hover {
            background: var(--gray-50);
            color: var(--text-primary);
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background: var(--medical-blue);
            color: white;
            padding: 1.25rem 1.75rem;
            border-radius: var(--border-radius-lg);
            z-index: 1001;
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 0.875rem;
            max-width: 400px;
        }

        .toast.success {
            background: var(--medical-green);
        }

        .toast.error {
            background: var(--medical-red);
        }

        .toast.warning {
            background: var(--medical-amber);
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(0, 91, 142, 0.2);
            border-radius: 50%;
            border-top-color: var(--medical-blue);
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Schedule Timeline */
        .timeline {
            display: grid;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .timeline-day {
            background: var(--background-secondary);
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius-lg);
            overflow: hidden;
        }

        .timeline-header {
            padding: 1rem 1.5rem;
            background: var(--gray-50);
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-light);
        }

        .timeline-slots {
            display: grid;
            gap: 0.5rem;
            padding: 1rem;
        }

        .time-slot {
            padding: 0.75rem 1rem;
            background: var(--gray-50);
            border-radius: var(--border-radius-md);
            border: 2px solid transparent;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .time-slot:hover {
            border-color: var(--medical-blue);
            background: white;
        }

        .time-slot.assigned {
            background: rgba(0, 91, 142, 0.1);
            border-color: rgba(0, 91, 142, 0.2);
        }

        .time-slot.resident {
            background: rgba(139, 92, 246, 0.1);
            border-color: rgba(139, 92, 246, 0.2);
        }

        .time-slot.leave {
            background: rgba(245, 158, 11, 0.1);
            border-color: rgba(245, 158, 11, 0.2);
        }

        /* Drag & Drop */
        .dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .drop-zone {
            border: 2px dashed var(--medical-blue);
            background: rgba(0, 91, 142, 0.05);
        }

        /* Loading State */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem;
            color: var(--text-secondary);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--gray-300);
        }

        /* Resident Badge */
        .resident-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: rgba(139, 92, 246, 0.1);
            color: var(--medical-purple);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            margin-left: 8px;
        }

        /* Role Badge */
        .role-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            margin-right: 8px;
        }

        .badge-resident {
            background: rgba(139, 92, 246, 0.1);
            color: var(--medical-purple);
        }

        .badge-attending {
            background: rgba(0, 91, 142, 0.1);
            color: var(--medical-blue);
        }

        .badge-admin {
            background: rgba(245, 158, 11, 0.1);
            color: var(--medical-amber);
        }

        /* Duty Hours */
        .duty-hours {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .duty-hours.warning {
            color: var(--medical-amber);
            font-weight: 600;
        }

        .duty-hours.critical {
            color: var(--medical-red);
            font-weight: 700;
        }

        /* Clinical Units Grid */
        .units-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .unit-card {
            background: var(--background-secondary);
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
            transition: var(--transition-fast);
        }

        .unit-card:hover {
            border-color: var(--medical-blue);
            box-shadow: var(--shadow-medium);
        }

        .unit-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .unit-name {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text-primary);
        }

        .unit-capacity {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .unit-residents {
            margin-top: 1rem;
        }

        .unit-resident {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: var(--gray-50);
            border-radius: var(--border-radius-md);
            margin-bottom: 0.5rem;
        }

        /* On-call Schedule */
        .call-schedule {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .call-day {
            background: var(--background-secondary);
            border: 1px solid var(--border-light);
            border-radius: var(--border-radius-lg);
            padding: 1.5rem;
        }

        .call-date {
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .login-container {
                padding: 1rem;
            }
            
            .login-card {
                padding: 2rem;
            }
            
            .role-selector {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                transform: translateX(-100%);
                width: 100%;
                max-width: 320px;
            }
            
            .sidebar.mobile-open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .content-header {
                padding: 1.25rem;
                flex-direction: column;
                gap: 1.25rem;
            }
            
            .search-box {
                width: 100%;
            }
            
            .content-area {
                padding: 1.5rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .modal {
                margin: 1rem;
                padding: 1.75rem;
            }
            
            .tabs {
                padding: 0 1rem;
            }
            
            .tab-btn {
                padding: 1rem 1.25rem;
            }
            
            .units-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
            }
            
            .tab-btn {
                padding: 0.875rem 1rem;
                white-space: nowrap;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Mobile Menu Toggle */
        .mobile-menu-toggle {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 1001;
            background: var(--medical-blue);
            color: white;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: var(--border-radius-lg);
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: flex;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Login Screen -->
        <div v-if="!currentUser" class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <div class="login-logo">
                        <i class="fas fa-lungs"></i>
                    </div>
                    <h1 class="login-title">PneumoCare Pro</h1>
                    <div class="login-subtitle">Academic Pulmonary Management System</div>
                </div>
                
                <div class="role-selector">
                    <div class="role-btn" :class="{ active: loginForm.user_role === 'resident_manager' }" 
                         @click="loginForm.user_role = 'resident_manager'">
                        <div class="role-icon">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <div class="role-name">Resident Manager</div>
                        <div class="role-desc">Manage residents, units, rotations</div>
                    </div>
                    
                    <div class="role-btn" :class="{ active: loginForm.user_role === 'department_head' }" 
                         @click="loginForm.user_role = 'department_head'">
                        <div class="role-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="role-name">Head of Department</div>
                        <div class="role-desc">Oversee department operations</div>
                    </div>
                </div>
                
                <form @submit.prevent="handleLogin">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" v-model="loginForm.email" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-input" v-model="loginForm.password" required>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn" style="width: 100%;" :disabled="loading">
                            <span v-if="loading" class="loading-spinner"></span>
                            <span v-else>
                                <i class="fas fa-sign-in-alt"></i> Sign In as {{ loginForm.user_role === 'resident_manager' ? 'Resident Manager' : 'Head of Department' }}
                            </span>
                        </button>
                    </div>
                </form>
                
                <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border-light);">
                    <div style="font-size: 0.8rem; color: var(--text-secondary); text-align: center;">
                        <i class="fas fa-shield-alt"></i> HIPAA Compliant • System ID: PC-2024-001
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Application -->
        <div v-else>
            <!-- Mobile Menu Toggle -->
            <button class="mobile-menu-toggle" @click="toggleMobileMenu">
                <i class="fas fa-bars"></i>
            </button>

            <div class="app-container">
                <!-- Sidebar -->
                <div class="sidebar" :class="{ 
                    collapsed: sidebarCollapsed,
                    'mobile-open': mobileMenuOpen 
                }">
                    <div class="sidebar-header">
                        <div class="brand">
                            <div class="brand-logo">
                                <i class="fas fa-lungs"></i>
                            </div>
                            <div class="brand-text">
                                <h1>PneumoCare Pro</h1>
                                <div class="subtitle">ACADEMIC PULMONARY v4.0</div>
                            </div>
                        </div>
                        <button class="collapse-toggle" @click="sidebarCollapsed = !sidebarCollapsed">
                            <i class="fas" :class="sidebarCollapsed ? 'fa-chevron-right' : 'fa-chevron-left'"></i>
                        </button>
                    </div>
                    
                    <nav class="sidebar-nav">
                        <!-- Resident Manager Features -->
                        <div v-if="currentUser.user_role === 'resident_manager'">
                            <button class="nav-item" :class="{ active: currentView === 'medical_staff' }" 
                                    @click="switchView('medical_staff'); closeMobileMenu()">
                                <i class="fas fa-user-graduate"></i>
                                <span>Medical Staff</span>
                            </button>
                            
                            <button class="nav-item" :class="{ active: currentView === 'training_units' }" 
                                    @click="switchView('training_units'); closeMobileMenu()">
                                <i class="fas fa-hospital-alt"></i>
                                <span>Training Units</span>
                            </button>
                            
                            <button class="nav-item" :class="{ active: currentView === 'resident_rotations' }" 
                                    @click="switchView('resident_rotations'); closeMobileMenu()">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Resident Rotations</span>
                            </button>
                            
                            <button class="nav-item" :class="{ active: currentView === 'placements' }" 
                                    @click="switchView('placements'); closeMobileMenu()">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>Placements</span>
                            </button>
                        </div>
                        
                        <!-- HOD Features -->
                        <div v-if="currentUser.user_role === 'department_head'">
                            <button class="nav-item" :class="{ active: currentView === 'department_overview' }" 
                                    @click="switchView('department_overview'); closeMobileMenu()">
                                <i class="fas fa-chart-line"></i>
                                <span>Department Overview</span>
                            </button>
                            
                            <button class="nav-item" :class="{ active: currentView === 'staff_management' }" 
                                    @click="switchView('staff_management'); closeMobileMenu()">
                                <i class="fas fa-users"></i>
                                <span>Staff Management</span>
                            </button>
                            
                            <button class="nav-item" :class="{ active: currentView === 'schedule_approval' }" 
                                    @click="switchView('schedule_approval'); closeMobileMenu()">
                                <i class="fas fa-calendar-check"></i>
                                <span>Schedule Approval</span>
                            </button>
                        </div>
                        
                        <!-- Shared Features -->
                        <button class="nav-item" :class="{ active: currentView === 'daily_assignments' }" 
                                @click="switchView('daily_assignments'); closeMobileMenu()">
                            <i class="fas fa-calendar-day"></i>
                            <span>Daily Assignments</span>
                        </button>
                        
                        <button class="nav-item" :class="{ active: currentView === 'oncall_schedule' }" 
                                @click="switchView('oncall_schedule'); closeMobileMenu()">
                            <i class="fas fa-phone-alt"></i>
                            <span>On-call Schedule</span>
                        </button>
                        
                        <button class="nav-item" :class="{ active: currentView === 'leave_requests' }" 
                                @click="switchView('leave_requests'); closeMobileMenu()">
                            <i class="fas fa-calendar-times"></i>
                            <span>Leave Requests</span>
                        </button>
                        
                        <button class="nav-item" :class="{ active: currentView === 'announcements' }" 
                                @click="switchView('announcements'); closeMobileMenu()">
                            <i class="fas fa-bullhorn"></i>
                            <span>Announcements</span>
                        </button>
                    </nav>
                    
                    <div style="padding: 1.75rem; margin-top: auto; border-top: 1px solid rgba(255,255,255,0.1);">
                        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.6); text-align: center; font-weight: 500;">
                            <div>Logged in as: <strong>{{ getUserRoleDisplay(currentUser.user_role) }}</strong></div>
                            <small>ID: {{ currentUser.user_id }}</small>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="main-content" :class="{ expanded: sidebarCollapsed }">
                    <header class="content-header">
                        <div class="header-title">
                            <h1>{{ getCurrentTitle() }}</h1>
                            <div class="subtitle">{{ getCurrentSubtitle() }}</div>
                        </div>
                        <div class="header-actions">
                            <div class="search-box">
                                <i class="fas fa-search search-icon"></i>
                                <input type="text" 
                                       v-model="searchQuery" 
                                       :placeholder="getSearchPlaceholder()"
                                       @input="handleSearch">
                            </div>
                            <div class="user-profile" @click="toggleUserMenu">
                                <div class="user-info">
                                    <div class="user-name">{{ currentUser.full_name }}</div>
                                    <div class="user-role">{{ getUserRoleDisplay(currentUser.user_role) }}</div>
                                </div>
                                <div class="user-avatar">{{ getInitials(currentUser.full_name) }}</div>
                            </div>
                        </div>
                    </header>

                    <div class="content-area">
                        <!-- Loading State -->
                        <div v-if="loading" class="loading-state">
                            <div class="loading-spinner"></div>
                            <p style="margin-top: 1rem;">Loading system data...</p>
                        </div>

                        <!-- Medical Staff Management -->
                        <div v-if="currentView === 'medical_staff'">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-user-graduate"></i>
                                        Medical Staff Management
                                    </div>
                                    <button class="btn btn-resident" @click="showAddMedicalStaffModal" v-if="canEditMedicalStaff">
                                        <i class="fas fa-user-plus"></i> Add Medical Staff
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div class="metrics-grid">
                                        <div class="metric-card">
                                            <div class="metric-value">{{ stats.totalStaff }}</div>
                                            <div class="metric-label">Total Medical Staff</div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="metric-value">{{ stats.activeResidents }}</div>
                                            <div class="metric-label">Active Residents</div>
                                        </div>

                                        <div class="metric-card">
                                            <div class="metric-value">{{ stats.attendings }}</div>
                                            <div class="metric-label">Attending Physicians</div>
                                        </div>

                                        <div class="metric-card">
                                            <div class="metric-value">{{ stats.availableSupervisors }}</div>
                                            <div class="metric-label">Available Supervisors</div>
                                        </div>
                                    </div>

                                    <!-- Medical Staff List -->
                                    <div style="margin-top: 2rem;">
                                        <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                                            <select class="form-select" style="width: 180px;" v-model="staffFilter.staff_type" @change="loadMedicalStaff">
                                                <option value="">All Types</option>
                                                <option value="medical_resident">Medical Resident</option>
                                                <option value="attending_physician">Attending Physician</option>
                                                <option value="fellow">Fellow</option>
                                                <option value="nurse_practitioner">Nurse Practitioner</option>
                                            </select>
                                            <select class="form-select" style="width: 180px;" v-model="staffFilter.employment_status" @change="loadMedicalStaff">
                                                <option value="">All Status</option>
                                                <option value="active">Active</option>
                                                <option value="on_leave">On Leave</option>
                                                <option value="inactive">Inactive</option>
                                            </select>
                                            <input type="text" class="form-input" style="width: 200px;" 
                                                   v-model="staffSearch" placeholder="Search staff..." @input="handleStaffSearch">
                                        </div>

                                        <div v-if="filteredMedicalStaff.length > 0" style="display: grid; gap: 1rem;">
                                            <div v-for="staff in filteredMedicalStaff" :key="staff.id" class="person-card">
                                                <div class="person-avatar" :class="{ resident: staff.staff_type === 'medical_resident' }">
                                                    {{ getInitials(staff.full_name) }}
                                                </div>
                                                <div class="person-info">
                                                    <div class="person-name">
                                                        {{ staff.full_name }}
                                                        <span class="role-badge" :class="getStaffTypeClass(staff.staff_type)">
                                                            {{ formatStaffType(staff.staff_type) }}
                                                        </span>
                                                        <span v-if="staff.can_supervise_residents" class="resident-badge">
                                                            <i class="fas fa-user-md"></i> Supervisor
                                                        </span>
                                                    </div>
                                                    <div class="person-clinic">
                                                        ID: {{ staff.staff_id }}
                                                        <span v-if="staff.primary_clinic" style="margin-left: 1rem;">
                                                            • {{ staff.primary_clinic }}
                                                        </span>
                                                    </div>
                                                    <div class="person-meta">
                                                        <div v-if="staff.staff_type === 'medical_resident'">
                                                            <strong>Category:</strong> {{ formatResidentCategory(staff.resident_category) }}
                                                            <span v-if="staff.training_year"> • <strong>Year:</strong> {{ staff.training_year }}</span>
                                                        </div>
                                                        <div v-if="staff.professional_email">
                                                            <strong>Email:</strong> {{ staff.professional_email }}
                                                        </div>
                                                        <div class="duty-hours">
                                                            <i class="fas fa-user-check"></i> {{ formatEmploymentStatus(staff.employment_status) }}
                                                        </div>
                                                    </div>
                                                </div>
                                                <div style="display: flex; gap: 0.5rem;" v-if="canEditMedicalStaff">
                                                    <button class="btn-outline btn-sm" @click="editMedicalStaff(staff)">
                                                        <i class="fas fa-edit"></i> Edit
                                                    </button>
                                                    <button class="btn btn-sm" @click="viewStaffSchedule(staff)">
                                                        <i class="fas fa-calendar"></i> Schedule
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div v-else class="empty-state">
                                            <i class="fas fa-user-graduate empty-state-icon"></i>
                                            <h3>No medical staff found</h3>
                                            <p>Add medical staff to get started</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Training Units Management -->
                        <div v-else-if="currentView === 'training_units'">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-hospital-alt"></i>
                                        Training Units Management
                                    </div>
                                    <button class="btn" @click="showAddTrainingUnitModal" v-if="canEditTrainingUnits">
                                        <i class="fas fa-plus"></i> Add Training Unit
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div class="units-grid">
                                        <div v-for="unit in trainingUnits" :key="unit.id" class="unit-card">
                                            <div class="unit-header">
                                                <div class="unit-name">{{ unit.unit_name }}</div>
                                                <div class="unit-capacity">
                                                    {{ unit.current_residents || 0 }}/{{ unit.maximum_residents }} residents
                                                </div>
                                            </div>
                                            <div style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 1rem;">
                                                {{ unit.department_name }}
                                                <span v-if="unit.default_supervisor_id" style="display: block; margin-top: 0.25rem;">
                                                    Default Supervisor: {{ getSupervisorName(unit.default_supervisor_id) }}
                                                </span>
                                            </div>
                                            
                                            <div v-if="unit.unit_description" style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem;">
                                                {{ unit.unit_description }}
                                            </div>
                                            
                                            <div class="unit-residents" v-if="getUnitResidents(unit.id).length > 0">
                                                <div style="font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem;">
                                                    Current Residents:
                                                </div>
                                                <div v-for="resident in getUnitResidents(unit.id)" :key="resident.id" class="unit-resident">
                                                    <div style="width: 24px; height: 24px; background: var(--medical-purple); 
                                                              border-radius: 50%; display: flex; align-items: center; 
                                                              justify-content: center; color: white; font-size: 0.7rem; font-weight: 700;">
                                                        {{ getInitials(resident.full_name).charAt(0) }}
                                                    </div>
                                                    <div style="flex: 1;">
                                                        <div style="font-weight: 500; font-size: 0.85rem;">{{ resident.full_name }}</div>
                                                        <div style="font-size: 0.7rem; color: var(--text-secondary);">
                                                            Supervisor: {{ getSupervisorName(resident.supervising_attending_id) }}
                                                        </div>
                                                    </div>
                                                    <div style="font-size: 0.7rem; color: var(--text-secondary);">
                                                        Ends: {{ formatDateShort(resident.rotation_end_date) }}
                                                    </div>
                                                </div>
                                            </div>
                                            <div v-else style="color: var(--text-secondary); font-size: 0.85rem; text-align: center; padding: 1rem 0;">
                                                No residents currently assigned
                                            </div>
                                            
                                            <div style="display: flex; gap: 0.5rem; margin-top: 1rem;" v-if="canEditTrainingUnits">
                                                <button class="btn-outline btn-sm" @click="editTrainingUnit(unit)">
                                                    <i class="fas fa-edit"></i> Edit
                                                </button>
                                                <button class="btn btn-sm" :class="{'btn-danger': unit.unit_status === 'active', 'btn-success': unit.unit_status !== 'active'}" 
                                                        @click="toggleUnitStatus(unit)">
                                                    <i class="fas" :class="unit.unit_status === 'active' ? 'fa-times' : 'fa-check'"></i>
                                                    {{ unit.unit_status === 'active' ? 'Deactivate' : 'Activate' }}
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Resident Rotations -->
                        <div v-else-if="currentView === 'resident_rotations'">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-calendar-alt"></i>
                                        Resident Rotations
                                    </div>
                                    <button class="btn btn-resident" @click="showNewRotationModal" v-if="canEditResidentRotations">
                                        <i class="fas fa-plus"></i> New Rotation
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                                        <select class="form-select" style="width: 180px;" v-model="rotationFilter.rotation_status" @change="loadResidentRotations">
                                            <option value="">All Status</option>
                                            <option value="scheduled">Scheduled</option>
                                            <option value="active">Active</option>
                                            <option value="completed">Completed</option>
                                            <option value="extended">Extended</option>
                                        </select>
                                        <input type="date" class="form-input" style="width: 180px;" v-model="rotationFilter.start_date" @change="loadResidentRotations">
                                        <input type="date" class="form-input" style="width: 180px;" v-model="rotationFilter.end_date" @change="loadResidentRotations">
                                    </div>

                                    <div v-if="residentRotations.length > 0" style="display: grid; gap: 1rem;">
                                        <div v-for="rotation in residentRotations" :key="rotation.id" class="person-card">
                                            <div class="person-avatar resident">
                                                {{ getInitials(rotation.resident_name).charAt(0) }}
                                            </div>
                                            <div class="person-info">
                                                <div class="person-name">{{ rotation.resident_name }}</div>
                                                <div class="person-clinic">{{ rotation.unit_name }}</div>
                                                <div class="person-meta">
                                                    <strong>Supervisor:</strong> {{ rotation.supervisor_name }}
                                                    <br>
                                                    <strong>Rotation:</strong> {{ formatDate(rotation.rotation_start_date) }} to {{ formatDate(rotation.rotation_end_date) }}
                                                    <br>
                                                    <strong>Category:</strong> {{ rotation.rotation_category }}
                                                    <span class="status-pill" :class="getRotationStatusClass(rotation.rotation_status)" style="margin-top: 0.5rem; display: inline-block;">
                                                        {{ rotation.rotation_status }}
                                                    </span>
                                                </div>
                                            </div>
                                            <div style="display: flex; gap: 0.5rem;" v-if="canEditResidentRotations">
                                                <button class="btn-outline btn-sm" @click="editRotation(rotation)">
                                                    <i class="fas fa-edit"></i> Edit
                                                </button>
                                                <button class="btn btn-sm btn-warning" @click="extendRotation(rotation)">
                                                    <i class="fas fa-calendar-plus"></i> Extend
                                                </button>
                                                <button v-if="rotation.rotation_status === 'active'" class="btn btn-sm btn-danger" @click="endRotation(rotation)">
                                                    <i class="fas fa-stop"></i> End
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div v-else class="empty-state">
                                        <i class="fas fa-calendar-alt empty-state-icon"></i>
                                        <h3>No rotations found</h3>
                                        <p>Create rotations to get started</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Placements View -->
                        <div v-else-if="currentView === 'placements'">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-map-marker-alt"></i>
                                        Resident Placements
                                    </div>
                                    <button class="btn" @click="showNewPlacementModal" v-if="canEditResidentRotations">
                                        <i class="fas fa-plus"></i> New Placement
                                    </button>
                                </div>
                                <div class="card-content">
                                    <!-- Placement Actions -->
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
                                        <div>
                                            <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Unplaced Residents</h3>
                                            <div v-if="unplacedResidents.length > 0" style="display: grid; gap: 0.75rem;">
                                                <div v-for="resident in unplacedResidents" :key="resident.id" 
                                                     class="person-card" draggable="true"
                                                     @dragstart="dragResident(resident)">
                                                    <div class="person-avatar resident">
                                                        {{ getInitials(resident.full_name).charAt(0) }}
                                                    </div>
                                                    <div>
                                                        <div style="font-weight: 600;">{{ resident.full_name }}</div>
                                                        <div style="font-size: 0.8rem; color: var(--text-secondary);">
                                                            {{ formatResidentCategory(resident.resident_category) }}
                                                        </div>
                                                    </div>
                                                    <button class="btn btn-sm btn-resident" @click="quickPlaceResident(resident)" v-if="canEditResidentRotations">
                                                        <i class="fas fa-map-marker-alt"></i> Place
                                                    </button>
                                                </div>
                                            </div>
                                            <div v-else style="color: var(--text-secondary); text-align: center; padding: 2rem;">
                                                <i class="fas fa-check-circle" style="font-size: 2rem; margin-bottom: 1rem; color: var(--medical-green);"></i>
                                                <div>All residents are placed</div>
                                            </div>
                                        </div>
                                        
                                        <div>
                                            <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Available Units</h3>
                                            <div style="display: grid; gap: 0.75rem;">
                                                <div v-for="unit in availableUnits" :key="unit.id"
                                                     class="unit-card" @dragover.prevent="dragOverUnit($event, unit)"
                                                     @drop="dropResidentOnUnit($event, unit)">
                                                    <div class="unit-header">
                                                        <div class="unit-name">{{ unit.unit_name }}</div>
                                                        <div class="unit-capacity">
                                                            {{ unit.current_residents || 0 }}/{{ unit.maximum_residents }}
                                                        </div>
                                                    </div>
                                                    <div style="color: var(--text-secondary); font-size: 0.85rem;">
                                                        {{ unit.department_name }}
                                                    </div>
                                                    <div style="margin-top: 1rem; padding: 1rem; background: var(--gray-50); 
                                                             border-radius: var(--border-radius-md); text-align: center; 
                                                             border: 2px dashed var(--border-light);">
                                                        <i class="fas fa-arrow-down" style="margin-bottom: 0.5rem; color: var(--medical-blue);"></i>
                                                        <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                                            Drop resident here to place
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Active Placements -->
                                    <div>
                                        <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Active Placements</h3>
                                        <div v-if="activePlacements.length > 0" style="display: grid; gap: 1rem;">
                                            <div v-for="placement in activePlacements" :key="placement.id" class="person-card">
                                                <div class="person-avatar resident">
                                                    {{ getInitials(placement.resident_name).charAt(0) }}
                                                </div>
                                                <div class="person-info">
                                                    <div class="person-name">{{ placement.resident_name }}</div>
                                                    <div class="person-clinic">{{ placement.unit_name }}</div>
                                                    <div class="person-meta">
                                                        <strong>Supervisor:</strong> {{ placement.supervisor_name }}
                                                        <br>
                                                        <strong>Rotation:</strong> {{ formatDate(placement.rotation_start_date) }} to {{ formatDate(placement.rotation_end_date) }}
                                                        <br>
                                                        <span :class="getDaysRemainingClass(placement.rotation_end_date)" style="margin-top: 0.5rem; display: inline-block;">
                                                            {{ getDaysRemaining(placement.rotation_end_date) }} days remaining
                                                        </span>
                                                    </div>
                                                </div>
                                                <div style="display: flex; gap: 0.5rem;" v-if="canEditResidentRotations">
                                                    <button class="btn-outline btn-sm" @click="editPlacement(placement)">
                                                        <i class="fas fa-edit"></i> Edit
                                                    </button>
                                                    <button class="btn btn-sm btn-warning" @click="extendPlacement(placement)">
                                                        <i class="fas fa-calendar-plus"></i> Extend
                                                    </button>
                                                    <button class="btn btn-sm btn-danger" @click="endPlacement(placement)">
                                                        <i class="fas fa-stop"></i> End
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div v-else class="empty-state">
                                            <i class="fas fa-map-marker-alt empty-state-icon"></i>
                                            <h3>No active placements</h3>
                                            <p>Place residents to start tracking rotations</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Daily Assignments -->
                        <div v-else-if="currentView === 'daily_assignments'">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-calendar-day"></i>
                                        Daily Assignments
                                    </div>
                                    <div style="display: flex; gap: 1rem; align-items: center;">
                                        <button class="btn-outline btn-sm" @click="prevWeek">
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <div style="font-weight: 600; min-width: 200px; text-align: center;">
                                            {{ formatDateRange(currentWeekStart, currentWeekEnd) }}
                                        </div>
                                        <button class="btn-outline btn-sm" @click="nextWeek">
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                        <button class="btn" @click="showNewAssignmentModal" v-if="canEditDailyAssignments">
                                            <i class="fas fa-plus"></i> New Assignment
                                        </button>
                                    </div>
                                </div>
                                <div class="card-content">
                                    <div class="timeline">
                                        <div v-for="day in weekDays" :key="day.date" class="timeline-day">
                                            <div class="timeline-header">
                                                {{ formatDayHeader(day.date) }}
                                                <span v-if="isToday(day.date)" style="color: var(--medical-green); margin-left: 0.5rem;">
                                                    • TODAY
                                                </span>
                                            </div>
                                            <div class="timeline-slots">
                                                <div v-for="assignment in getAssignmentsForDay(day.date)" 
                                                     :key="assignment.id"
                                                     class="time-slot" 
                                                     :class="{ 
                                                         'assigned': assignment.person_role !== 'medical_resident',
                                                         'resident': assignment.person_role === 'medical_resident'
                                                     }">
                                                    <div style="font-weight: 600; margin-bottom: 0.25rem;">
                                                        {{ assignment.staff_name }}
                                                        <span v-if="assignment.person_role === 'medical_resident'" class="resident-badge">
                                                            <i class="fas fa-graduation-cap"></i> RES
                                                        </span>
                                                    </div>
                                                    <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                                        {{ assignment.assignment_type }} • {{ formatTimeRange(assignment.start_time, assignment.end_time) }}
                                                    </div>
                                                    <div style="font-size: 0.75rem; color: var(--medical-blue); margin-top: 0.25rem;">
                                                        {{ assignment.location_name }}
                                                        <span v-if="assignment.supervisor_name" style="color: var(--medical-purple); margin-left: 0.5rem;">
                                                            • Supervisor: {{ assignment.supervisor_name }}
                                                        </span>
                                                    </div>
                                                </div>
                                                <div v-if="getAssignmentsForDay(day.date).length === 0" 
                                                     class="time-slot"
                                                     style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                                                    <i class="fas fa-calendar-plus" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                                                    <div>No assignments scheduled</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- On-call Schedule -->
                        <div v-else-if="currentView === 'oncall_schedule'">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-phone-alt"></i>
                                        On-call Schedule
                                    </div>
                                    <button class="btn" @click="showNewOnCallModal" v-if="canEditOnCallSchedule">
                                        <i class="fas fa-plus"></i> Assign On-call
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div class="call-schedule">
                                        <div v-for="day in onCallDays" :key="day.date" class="call-day">
                                            <div class="call-date">
                                                {{ formatDayHeader(day.date) }}
                                                <span v-if="isToday(day.date)" style="color: var(--medical-green); font-size: 0.8rem;">
                                                    • TODAY
                                                </span>
                                            </div>
                                            <div v-if="day.oncall" style="margin-bottom: 1rem;">
                                                <div style="font-weight: 600; color: var(--medical-blue); margin-bottom: 0.5rem;">
                                                    Primary: {{ day.oncall.primary_name }}
                                                </div>
                                                <div v-if="day.oncall.backup_name" style="font-size: 0.9rem; color: var(--text-secondary);">
                                                    Backup: {{ day.oncall.backup_name }}
                                                </div>
                                                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                                    <i class="fas fa-clock"></i> {{ day.oncall.start_time }} - {{ day.oncall.end_time }}
                                                </div>
                                            </div>
                                            <div v-else style="color: var(--text-secondary); font-size: 0.9rem; text-align: center; padding: 1rem 0;">
                                                No on-call assigned
                                            </div>
                                            <div v-if="day.coverage_gap" style="margin-top: 1rem; padding: 0.75rem; background: rgba(245, 158, 11, 0.1); 
                                                  border-radius: var(--border-radius-md); border-left: 3px solid var(--medical-amber);">
                                                <div style="font-size: 0.8rem; color: var(--medical-amber); font-weight: 600;">
                                                    <i class="fas fa-exclamation-triangle"></i> Coverage Gap
                                                </div>
                                                <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem;">
                                                    {{ day.coverage_gap }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Leave Requests -->
                        <div v-else-if="currentView === 'leave_requests'">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-calendar-times"></i>
                                        Leave Requests Management
                                    </div>
                                    <button class="btn" @click="showNewLeaveModal" v-if="canCreateLeaveRequest">
                                        <i class="fas fa-plus"></i> Request Leave
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div class="metrics-grid">
                                        <div class="metric-card">
                                            <div class="metric-value">{{ leaveStats.pending }}</div>
                                            <div class="metric-label">Pending Requests</div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="metric-value">{{ leaveStats.active }}</div>
                                            <div class="metric-label">Active Leave</div>
                                        </div>

                                        <div class="metric-card">
                                            <div class="metric-value">{{ leaveStats.coverageAssigned }}/{{ leaveStats.needsCoverage }}</div>
                                            <div class="metric-label">Coverage Status</div>
                                        </div>

                                        <div class="metric-card">
                                            <div class="metric-value">{{ leaveStats.upcoming }}</div>
                                            <div class="metric-label">Upcoming Leave</div>
                                        </div>
                                    </div>

                                    <!-- Pending Approvals -->
                                    <div v-if="pendingLeaveRequests.length > 0" style="margin-top: 2rem;">
                                        <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Pending Approval</h3>
                                        <div style="display: grid; gap: 1rem;">
                                            <div v-for="request in pendingLeaveRequests" :key="request.id" class="person-card">
                                                <div class="person-avatar">
                                                    {{ getInitials(request.staff_name) }}
                                                </div>
                                                <div class="person-info">
                                                    <div class="person-name">{{ request.staff_name }}</div>
                                                    <div class="person-clinic">{{ request.leave_category }}</div>
                                                    <div class="person-meta">
                                                        {{ formatDate(request.leave_start_date) }} to {{ formatDate(request.leave_end_date) }}
                                                        • {{ request.total_days }} days
                                                        <br>
                                                        <strong>Reason:</strong> {{ request.leave_reason }}
                                                    </div>
                                                </div>
                                                <div style="display: flex; gap: 0.5rem;" v-if="canApproveLeaveRequest">
                                                    <button class="btn btn-sm btn-success" @click="approveLeaveRequest(request)">
                                                        <i class="fas fa-check"></i> Approve
                                                    </button>
                                                    <button class="btn btn-sm btn-danger" @click="rejectLeaveRequest(request)">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                    <button class="btn-outline btn-sm" @click="viewCoverageOptions(request)">
                                                        <i class="fas fa-user-plus"></i> Coverage
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Active Leave -->
                                    <div v-if="activeLeave.length > 0" style="margin-top: 2rem;">
                                        <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Active Leave</h3>
                                        <div style="display: grid; gap: 1rem;">
                                            <div v-for="request in activeLeave" :key="request.id" class="person-card">
                                                <div class="person-avatar">
                                                    {{ getInitials(request.staff_name) }}
                                                </div>
                                                <div class="person-info">
                                                    <div class="person-name">{{ request.staff_name }}</div>
                                                    <div class="person-clinic">{{ request.leave_category }}</div>
                                                    <div class="person-meta">
                                                        {{ formatDate(request.leave_start_date) }} to {{ formatDate(request.leave_end_date) }}
                                                        <br>
                                                        <span :class="request.coverage_assigned ? 'status-approved' : 'status-reported'" 
                                                              class="status-pill" style="margin-top: 0.5rem;">
                                                            {{ request.coverage_assigned ? 'Coverage Assigned' : 'Needs Coverage' }}
                                                        </span>
                                                        <span v-if="request.coverage_notes" style="display: block; margin-top: 0.5rem; font-size: 0.8rem;">
                                                            <strong>Coverage Notes:</strong> {{ request.coverage_notes }}
                                                        </span>
                                                    </div>
                                                </div>
                                                <div style="display: flex; gap: 0.5rem;" v-if="canEditLeaveRequests">
                                                    <button v-if="!request.coverage_assigned" class="btn btn-sm" @click="assignCoverage(request)">
                                                        <i class="fas fa-user-plus"></i> Assign Coverage
                                                    </button>
                                                    <button class="btn-outline btn-sm" @click="editLeaveRequest(request)">
                                                        <i class="fas fa-edit"></i> Edit
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div v-if="pendingLeaveRequests.length === 0 && activeLeave.length === 0" 
                                         class="empty-state" style="margin-top: 2rem;">
                                        <i class="fas fa-calendar-check empty-state-icon"></i>
                                        <h3>No leave requests</h3>
                                        <p>All staff are currently available</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Announcements -->
                        <div v-else-if="currentView === 'announcements'">
                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-bullhorn"></i>
                                        Department Announcements
                                    </div>
                                    <button class="btn" @click="showNewAnnouncementModal" v-if="canEditAnnouncements">
                                        <i class="fas fa-plus"></i> New Announcement
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div v-if="announcements.length > 0" style="display: grid; gap: 1.5rem;">
                                        <div v-for="announcement in announcements" :key="announcement.id" 
                                             :class="['person-card', announcement.priority_level === 'high' ? 'highlight' : '']"
                                             :style="announcement.priority_level === 'high' ? 'border-left: 4px solid var(--medical-red);' : ''">
                                            <div class="person-avatar" style="background: var(--medical-teal);">
                                                <i class="fas fa-bullhorn"></i>
                                            </div>
                                            <div class="person-info">
                                                <div class="person-name">{{ announcement.announcement_title }}</div>
                                                <div class="person-clinic">
                                                    <span class="role-badge" :class="getPriorityClass(announcement.priority_level)">
                                                        {{ announcement.priority_level }}
                                                    </span>
                                                    {{ formatAnnouncementType(announcement.announcement_type) }}
                                                </div>
                                                <div class="person-meta">
                                                    {{ announcement.announcement_content }}
                                                    <div style="margin-top: 0.5rem; font-size: 0.75rem; color: var(--text-secondary);">
                                                        <i class="fas fa-calendar"></i> 
                                                        {{ formatDate(announcement.publish_start_date) }} 
                                                        <span v-if="announcement.publish_end_date">
                                                            to {{ formatDate(announcement.publish_end_date) }}
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div style="display: flex; gap: 0.5rem;" v-if="canEditAnnouncements">
                                                <button class="btn-outline btn-sm" @click="editAnnouncement(announcement)">
                                                    <i class="fas fa-edit"></i> Edit
                                                </button>
                                                <button class="btn btn-sm btn-danger" @click="archiveAnnouncement(announcement)">
                                                    <i class="fas fa-archive"></i> Archive
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div v-else class="empty-state">
                                        <i class="fas fa-bullhorn empty-state-icon"></i>
                                        <h3>No announcements</h3>
                                        <p>Create announcements to share important information</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Department Overview (HOD) -->
                        <div v-else-if="currentView === 'department_overview' && currentUser.user_role === 'department_head'">
                            <div class="metrics-grid">
                                <div class="metric-card">
                                    <div class="metric-value">{{ hodStats.totalStaff }}</div>
                                    <div class="metric-label">Total Staff</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                        {{ hodStats.attendings }} Attendings • {{ hodStats.residents }} Residents
                                    </div>
                                </div>
                                
                                <div class="metric-card">
                                    <div class="metric-value">{{ hodStats.occupancyRate }}%</div>
                                    <div class="metric-label">Unit Occupancy</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                        {{ hodStats.occupiedUnits }}/{{ hodStats.totalUnits }} units at capacity
                                    </div>
                                </div>

                                <div class="metric-card">
                                    <div class="metric-value">{{ hodStats.coverageToday }}%</div>
                                    <div class="metric-label">Coverage Today</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                        {{ hodStats.onLeave }} staff on leave
                                    </div>
                                </div>

                                <div class="metric-card">
                                    <div class="metric-value">{{ hodStats.compliance }}%</div>
                                    <div class="metric-label">Duty Hour Compliance</div>
                                    <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                        {{ hodStats.dutyHourAlerts }} alerts
                                    </div>
                                </div>
                            </div>

                            <div class="card">
                                <div class="card-header">
                                    <div class="card-title">
                                        <i class="fas fa-chart-line"></i>
                                        Department Summary
                                    </div>
                                    <button class="btn" @click="exportDepartmentReport">
                                        <i class="fas fa-download"></i> Export Report
                                    </button>
                                </div>
                                <div class="card-content">
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                                        <div>
                                            <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Unit Status</h3>
                                            <div v-for="unit in trainingUnits" :key="unit.id" style="margin-bottom: 1rem;">
                                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                                    <span>{{ unit.unit_name }}</span>
                                                    <span style="font-weight: 600;">
                                                        {{ unit.current_residents || 0 }}/{{ unit.maximum_residents }}
                                                    </span>
                                                </div>
                                                <div style="height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden;">
                                                    <div :style="{ 
                                                        width: `${((unit.current_residents || 0) / unit.maximum_residents) * 100}%`,
                                                        background: (unit.current_residents || 0) >= unit.maximum_residents ? 'var(--medical-red)' : 'var(--medical-green)',
                                                        height: '100%'
                                                    }"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <h3 style="margin-bottom: 1rem; color: var(--text-primary);">Supervisor Load</h3>
                                            <div v-for="supervisor in supervisors" :key="supervisor.id" style="margin-bottom: 1rem;">
                                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.25rem;">
                                                    <span>{{ supervisor.full_name }}</span>
                                                    <span style="font-weight: 600;">
                                                        {{ getSupervisorResidentsCount(supervisor.id) }} residents
                                                    </span>
                                                </div>
                                                <div style="height: 8px; background: var(--gray-200); border-radius: 4px; overflow: hidden;">
                                                    <div :style="{ 
                                                        width: `${Math.min(getSupervisorResidentsCount(supervisor.id) / 6 * 100, 100)}%`,
                                                        background: getSupervisorResidentsCount(supervisor.id) > 4 ? 'var(--medical-amber)' : 'var(--medical-green)',
                                                        height: '100%'
                                                    }"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modals -->
        
        <!-- Add Medical Staff Modal -->
        <div v-if="showMedicalStaffModal" class="modal-overlay" @click.self="closeMedicalStaffModal">
            <div class="modal modal-large" @click.stop>
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-user-graduate"></i>
                        {{ editingMedicalStaff ? 'Edit Medical Staff' : 'Add New Medical Staff' }}
                    </div>
                    <button class="modal-close" @click="closeMedicalStaffModal">×</button>
                </div>
                <form @submit.prevent="saveMedicalStaff">
                    <div class="card-content">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-input" v-model="medicalStaffForm.full_name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Professional Email</label>
                                <input type="email" class="form-input" v-model="medicalStaffForm.professional_email">
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Staff Type</label>
                                <select class="form-select" v-model="medicalStaffForm.staff_type" required @change="handleStaffTypeChange">
                                    <option value="medical_resident">Medical Resident</option>
                                    <option value="attending_physician">Attending Physician</option>
                                    <option value="fellow">Fellow</option>
                                    <option value="nurse_practitioner">Nurse Practitioner</option>
                                    <option value="administrator">Administrator</option>
                                </select>
                            </div>
                            <div v-if="medicalStaffForm.staff_type === 'medical_resident'" class="form-group">
                                <label class="form-label">Resident Category</label>
                                <select class="form-select" v-model="medicalStaffForm.resident_category">
                                    <option value="department_internal">Department Internal</option>
                                    <option value="rotating_other_dept">Rotating - Other Dept</option>
                                    <option value="external_abroad">External/Abroad</option>
                                </select>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div v-if="medicalStaffForm.staff_type === 'medical_resident'" class="form-group">
                                <label class="form-label">Training Year</label>
                                <select class="form-select" v-model="medicalStaffForm.training_year">
                                    <option value="1">Year 1</option>
                                    <option value="2">Year 2</option>
                                    <option value="3">Year 3</option>
                                    <option value="4">Year 4</option>
                                    <option value="5">Year 5+</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Primary Clinic/Unit</label>
                                <input type="text" class="form-input" v-model="medicalStaffForm.primary_clinic">
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Work Phone</label>
                                <input type="text" class="form-input" v-model="medicalStaffForm.work_phone">
                            </div>
                            <div v-if="medicalStaffForm.staff_type === 'attending_physician'" class="form-group">
                                <label class="form-label" style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" v-model="medicalStaffForm.can_supervise_residents">
                                    Can Supervise Residents
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Employment Status</label>
                            <select class="form-select" v-model="medicalStaffForm.employment_status" required>
                                <option value="active">Active</option>
                                <option value="on_leave">On Leave</option>
                                <option value="inactive">Inactive</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Notes</label>
                            <textarea class="form-textarea" v-model="medicalStaffForm.special_notes" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-outline" @click="closeMedicalStaffModal">Cancel</button>
                        <button type="submit" class="btn btn-resident" :disabled="saving">
                            <span v-if="saving" class="loading-spinner"></span>
                            <span v-else>
                                <i class="fas fa-save"></i> {{ editingMedicalStaff ? 'Update' : 'Save' }} Medical Staff
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Add Training Unit Modal -->
        <div v-if="showTrainingUnitModal" class="modal-overlay" @click.self="closeTrainingUnitModal">
            <div class="modal modal-large" @click.stop>
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-hospital-alt"></i>
                        {{ editingTrainingUnit ? 'Edit Training Unit' : 'Add New Training Unit' }}
                    </div>
                    <button class="modal-close" @click="closeTrainingUnitModal">×</button>
                </div>
                <form @submit.prevent="saveTrainingUnit">
                    <div class="card-content">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Unit Code</label>
                                <input type="text" class="form-input" v-model="trainingUnitForm.unit_code" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Unit Name</label>
                                <input type="text" class="form-input" v-model="trainingUnitForm.unit_name" required>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Department Name</label>
                                <input type="text" class="form-input" v-model="trainingUnitForm.department_name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Maximum Residents</label>
                                <input type="number" class="form-input" v-model="trainingUnitForm.maximum_residents" min="1" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Default Supervisor</label>
                            <select class="form-select" v-model="trainingUnitForm.default_supervisor_id">
                                <option value="">None (assign manually)</option>
                                <option v-for="supervisor in supervisors" :value="supervisor.id">
                                    {{ supervisor.full_name }} ({{ supervisor.staff_id }})
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Unit Description</label>
                            <textarea class="form-textarea" v-model="trainingUnitForm.unit_description" rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" v-model="trainingUnitForm.unit_status" true-value="active" false-value="inactive">
                                Active (available for resident placement)
                            </label>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-outline" @click="closeTrainingUnitModal">Cancel</button>
                        <button type="submit" class="btn" :disabled="saving">
                            <span v-if="saving" class="loading-spinner"></span>
                            <span v-else>
                                <i class="fas fa-save"></i> {{ editingTrainingUnit ? 'Update' : 'Save' }} Unit
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- New Rotation/Placement Modal -->
        <div v-if="showPlacementModal" class="modal-overlay" @click.self="closePlacementModal">
            <div class="modal modal-large" @click.stop>
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-map-marker-alt"></i>
                        {{ editingPlacement ? 'Edit Rotation' : 'New Resident Rotation' }}
                    </div>
                    <button class="modal-close" @click="closePlacementModal">×</button>
                </div>
                <form @submit.prevent="saveRotation">
                    <div class="card-content">
                        <div class="form-group">
                            <label class="form-label">Select Resident</label>
                            <select class="form-select" v-model="rotationForm.resident_id" required>
                                <option value="">Select resident...</option>
                                <option v-for="resident in availableResidentsForRotation" :value="resident.id">
                                    {{ resident.full_name }} ({{ formatResidentCategory(resident.resident_category) }} • {{ resident.staff_id }})
                                </option>
                            </select>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Training Unit</label>
                                <select class="form-select" v-model="rotationForm.training_unit_id" required @change="updateDefaultSupervisor">
                                    <option value="">Select unit...</option>
                                    <option v-for="unit in availableTrainingUnits" :value="unit.id">
                                        {{ unit.unit_name }} ({{ unit.current_residents || 0 }}/{{ unit.maximum_residents }})
                                    </option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Supervising Attending</label>
                                <select class="form-select" v-model="rotationForm.supervising_attending_id" required>
                                    <option value="">Select supervisor...</option>
                                    <option v-for="supervisor in supervisors" :value="supervisor.id">
                                        {{ supervisor.full_name }} ({{ supervisor.staff_id }})
                                    </option>
                                </select>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Rotation Start Date</label>
                                <input type="date" class="form-input" v-model="rotationForm.rotation_start_date" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Rotation End Date</label>
                                <input type="date" class="form-input" v-model="rotationForm.rotation_end_date" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Rotation Category</label>
                            <select class="form-select" v-model="rotationForm.rotation_category">
                                <option value="clinical_rotation">Clinical Rotation</option>
                                <option value="elective_rotation">Elective Rotation</option>
                                <option value="research_rotation">Research Rotation</option>
                                <option value="administrative_rotation">Administrative Rotation</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Clinical Notes</label>
                            <textarea class="form-textarea" v-model="rotationForm.clinical_notes" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-outline" @click="closePlacementModal">Cancel</button>
                        <button type="submit" class="btn btn-resident" :disabled="saving">
                            <span v-if="saving" class="loading-spinner"></span>
                            <span v-else>
                                <i class="fas fa-save"></i> {{ editingPlacement ? 'Update' : 'Create' }} Rotation
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- New Assignment Modal -->
        <div v-if="showAssignmentModal" class="modal-overlay" @click.self="closeAssignmentModal">
            <div class="modal modal-large" @click.stop>
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-calendar-plus"></i>
                        New Daily Assignment
                    </div>
                    <button class="modal-close" @click="closeAssignmentModal">×</button>
                </div>
                <form @submit.prevent="saveAssignment">
                    <div class="card-content">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Assignment Date</label>
                                <input type="date" class="form-input" v-model="assignmentForm.assignment_date" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Assignment Type</label>
                                <select class="form-select" v-model="assignmentForm.assignment_type" required>
                                    <option value="outpatient_clinic">Outpatient Clinic</option>
                                    <option value="icu_rounds">ICU Rounds</option>
                                    <option value="bronchoscopy">Bronchoscopy</option>
                                    <option value="procedure">Procedure</option>
                                    <option value="ward_rounds">Ward Rounds</option>
                                    <option value="meeting">Meeting</option>
                                    <option value="research">Research</option>
                                </select>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Start Time</label>
                                <input type="time" class="form-input" v-model="assignmentForm.start_time" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Time</label>
                                <input type="time" class="form-input" v-model="assignmentForm.end_time" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-input" v-model="assignmentForm.location_name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Staff Member</label>
                            <select class="form-select" v-model="assignmentForm.staff_member_id" required @change="updateAssignmentSupervisor">
                                <option value="">Select staff member...</option>
                                <optgroup label="Residents">
                                    <option v-for="resident in availableResidentsForAssignment" :value="resident.id">
                                        {{ resident.full_name }} (Resident • {{ resident.staff_id }})
                                    </option>
                                </optgroup>
                                <optgroup label="Attendings">
                                    <option v-for="attending in availableAttendingsForAssignment" :value="attending.id">
                                        {{ attending.full_name }} (Attending • {{ attending.staff_id }})
                                    </option>
                                </optgroup>
                                <optgroup label="Other Staff">
                                    <option v-for="staff in otherStaffForAssignment" :value="staff.id">
                                        {{ staff.full_name }} ({{ formatStaffType(staff.staff_type) }} • {{ staff.staff_id }})
                                    </option>
                                </optgroup>
                            </select>
                        </div>
                        <div v-if="isResidentSelected" class="form-group">
                            <label class="form-label">Supervisor for this assignment</label>
                            <select class="form-select" v-model="assignmentForm.supervising_attending_id">
                                <option value="">No specific supervisor</option>
                                <option v-for="supervisor in supervisors" :value="supervisor.id">
                                    {{ supervisor.full_name }} ({{ supervisor.staff_id }})
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Assignment Notes</label>
                            <textarea class="form-textarea" v-model="assignmentForm.assignment_notes" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-outline" @click="closeAssignmentModal">Cancel</button>
                        <button type="submit" class="btn" :disabled="saving">
                            <span v-if="saving" class="loading-spinner"></span>
                            <span v-else>
                                <i class="fas fa-save"></i> Create Assignment
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- New Leave Request Modal -->
        <div v-if="showLeaveModal" class="modal-overlay" @click.self="closeLeaveModal">
            <div class="modal modal-large" @click.stop>
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-calendar-plus"></i>
                        New Leave Request
                    </div>
                    <button class="modal-close" @click="closeLeaveModal">×</button>
                </div>
                <form @submit.prevent="saveLeaveRequest">
                    <div class="card-content">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Leave Category</label>
                                <select class="form-select" v-model="leaveRequestForm.leave_category" required>
                                    <option value="vacation_leave">Vacation Leave</option>
                                    <option value="sick_leave">Sick Leave</option>
                                    <option value="conference_cme">Conference/CME</option>
                                    <option value="personal_leave">Personal Leave</option>
                                    <option value="maternity_paternity">Maternity/Paternity</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Staff Member</label>
                                <select class="form-select" v-model="leaveRequestForm.staff_member_id" required>
                                    <option value="">Select staff member...</option>
                                    <optgroup label="Residents">
                                        <option v-for="resident in allResidents" :value="resident.id">
                                            {{ resident.full_name }} (Resident • {{ resident.staff_id }})
                                        </option>
                                    </optgroup>
                                    <optgroup label="Attendings">
                                        <option v-for="attending in allAttendings" :value="attending.id">
                                            {{ attending.full_name }} (Attending • {{ attending.staff_id }})
                                        </option>
                                    </optgroup>
                                    <optgroup label="Other Staff">
                                        <option v-for="staff in allOtherStaff" :value="staff.id">
                                            {{ staff.full_name }} ({{ formatStaffType(staff.staff_type) }} • {{ staff.staff_id }})
                                        </option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Leave Start Date</label>
                                <input type="date" class="form-input" v-model="leaveRequestForm.leave_start_date" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Leave End Date</label>
                                <input type="date" class="form-input" v-model="leaveRequestForm.leave_end_date" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Leave Reason</label>
                            <textarea class="form-textarea" v-model="leaveRequestForm.leave_reason" required rows="3"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Coverage Notes</label>
                            <textarea class="form-textarea" v-model="leaveRequestForm.coverage_notes" rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" v-model="leaveRequestForm.coverage_required">
                                Coverage Required During Leave
                            </label>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-outline" @click="closeLeaveModal">Cancel</button>
                        <button type="submit" class="btn" :disabled="saving">
                            <span v-if="saving" class="loading-spinner"></span>
                            <span v-else>
                                <i class="fas fa-paper-plane"></i> Submit Leave Request
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- New On-call Assignment Modal -->
        <div v-if="showOnCallModal" class="modal-overlay" @click.self="closeOnCallModal">
            <div class="modal modal-large" @click.stop>
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-phone-alt"></i>
                        Assign On-call
                    </div>
                    <button class="modal-close" @click="closeOnCallModal">×</button>
                </div>
                <form @submit.prevent="saveOnCallAssignment">
                    <div class="card-content">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Duty Date</label>
                                <input type="date" class="form-input" v-model="onCallForm.duty_date" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Shift Type</label>
                                <select class="form-select" v-model="onCallForm.shift_type" required>
                                    <option value="primary_call">Primary Call</option>
                                    <option value="backup_call">Backup Call</option>
                                    <option value="float_call">Float Call</option>
                                </select>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Start Time</label>
                                <input type="time" class="form-input" v-model="onCallForm.start_time" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">End Time</label>
                                <input type="time" class="form-input" v-model="onCallForm.end_time" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Primary Physician</label>
                            <select class="form-select" v-model="onCallForm.primary_physician_id" required>
                                <option value="">Select primary...</option>
                                <optgroup label="Attendings">
                                    <option v-for="attending in availableAttendingsForOnCall" :value="attending.id">
                                        {{ attending.full_name }} (Attending • {{ attending.staff_id }})
                                    </option>
                                </optgroup>
                                <optgroup label="Senior Residents (PGY-3+)">
                                    <option v-for="resident in seniorResidents" :value="resident.id">
                                        {{ resident.full_name }} (Resident • {{ resident.staff_id }})
                                    </option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Backup Physician</label>
                            <select class="form-select" v-model="onCallForm.backup_physician_id">
                                <option value="">No backup</option>
                                <optgroup label="Attendings">
                                    <option v-for="attending in availableAttendingsForOnCall" :value="attending.id">
                                        {{ attending.full_name }} (Attending • {{ attending.staff_id }})
                                    </option>
                                </optgroup>
                                <optgroup label="Residents">
                                    <option v-for="resident in availableResidentsForOnCall" :value="resident.id">
                                        {{ resident.full_name }} (Resident • {{ resident.staff_id }})
                                    </option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Coverage Notes</label>
                            <textarea class="form-textarea" v-model="onCallForm.coverage_notes" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-outline" @click="closeOnCallModal">Cancel</button>
                        <button type="submit" class="btn" :disabled="saving">
                            <span v-if="saving" class="loading-spinner"></span>
                            <span v-else>
                                <i class="fas fa-save"></i> Assign On-call
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- New Announcement Modal -->
        <div v-if="showAnnouncementModal" class="modal-overlay" @click.self="closeAnnouncementModal">
            <div class="modal modal-large" @click.stop>
                <div class="modal-header">
                    <div class="modal-title">
                        <i class="fas fa-bullhorn"></i>
                        {{ editingAnnouncement ? 'Edit Announcement' : 'New Announcement' }}
                    </div>
                    <button class="modal-close" @click="closeAnnouncementModal">×</button>
                </div>
                <form @submit.prevent="saveAnnouncement">
                    <div class="card-content">
                        <div class="form-group">
                            <label class="form-label">Announcement Title</label>
                            <input type="text" class="form-input" v-model="announcementForm.announcement_title" required>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Announcement Type</label>
                                <select class="form-select" v-model="announcementForm.announcement_type" required>
                                    <option value="general_notice">General Notice</option>
                                    <option value="training_opportunity">Training Opportunity</option>
                                    <option value="policy_update">Policy Update</option>
                                    <option value="schedule_change">Schedule Change</option>
                                    <option value="emergency_alert">Emergency Alert</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Priority Level</label>
                                <select class="form-select" v-model="announcementForm.priority_level" required>
                                    <option value="normal">Normal</option>
                                    <option value="high">High</option>
                                    <option value="urgent">Urgent</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Announcement Content</label>
                            <textarea class="form-textarea" v-model="announcementForm.announcement_content" required rows="4"></textarea>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
                            <div class="form-group">
                                <label class="form-label">Publish Start Date</label>
                                <input type="date" class="form-input" v-model="announcementForm.publish_start_date" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Publish End Date (Optional)</label>
                                <input type="date" class="form-input" v-model="announcementForm.publish_end_date">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Visible To Roles</label>
                            <div style="display: flex; flex-wrap: wrap; gap: 1rem;">
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" v-model="announcementForm.visible_to_roles" value="resident_manager">
                                    Resident Manager
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" v-model="announcementForm.visible_to_roles" value="department_head">
                                    Department Head
                                </label>
                                <label style="display: flex; align-items: center; gap: 0.5rem;">
                                    <input type="checkbox" v-model="announcementForm.visible_to_roles" value="viewing_doctor">
                                    Viewing Doctor
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn-outline" @click="closeAnnouncementModal">Cancel</button>
                        <button type="submit" class="btn" :disabled="saving">
                            <span v-if="saving" class="loading-spinner"></span>
                            <span v-else>
                                <i class="fas fa-save"></i> {{ editingAnnouncement ? 'Update' : 'Publish' }} Announcement
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Toast Notification -->
        <div v-if="toast.show" class="toast" :class="toast.type" @click="toast.show = false">
            <i :class="toast.icon"></i> {{ toast.message }}
        </div>
    </div>
<script>
const { createApp, ref, computed, onMounted } = Vue;

// Use a different name to avoid conflict
const supabaseUrl = 'https://vssmguzuvekkecbmwcjw.supabase.co';
const supabaseAnonKey = 'sb_publishable_QDZP5eQTlHHn0SZibWFvCQ_6RqH2f01';

// Use supabaseClient instead of supabase
const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseAnonKey);

createApp({
    setup() {
        // ============ STATE MANAGEMENT ============
        // Authentication
        const currentUser = ref(null);
        const loginForm = ref({
            email: '',
            password: '',
            user_role: 'resident_manager'
        });
        const loading = ref(false);
        const saving = ref(false);
        
        // Navigation
        const currentView = ref('medical_staff');
        const sidebarCollapsed = ref(false);
        const mobileMenuOpen = ref(false);
        const searchQuery = ref('');
        
        // Data Stores
        const medicalStaff = ref([]);
        const trainingUnits = ref([]);
        const residentRotations = ref([]);
        const dailyAssignments = ref([]);
        const leaveRequests = ref([]);
        const onCallSchedule = ref([]);
        const announcements = ref([]);
        
        // Modals
        const showMedicalStaffModal = ref(false);
        const showTrainingUnitModal = ref(false);
        const showPlacementModal = ref(false);
        const showAssignmentModal = ref(false);
        const showLeaveModal = ref(false);
        const showOnCallModal = ref(false);
        const showAnnouncementModal = ref(false);
        
        // Forms
        const medicalStaffForm = ref({
            full_name: '',
            professional_email: '',
            staff_type: 'medical_resident',
            resident_category: 'department_internal',
            training_year: '1',
            primary_clinic: '',
            work_phone: '',
            can_supervise_residents: false,
            employment_status: 'active',
            special_notes: ''
        });
        
        const trainingUnitForm = ref({
            unit_code: '',
            unit_name: '',
            department_name: 'Pulmonology',
            maximum_residents: 4,
            default_supervisor_id: '',
            unit_description: '',
            unit_status: 'active'
        });
        
        const rotationForm = ref({
            resident_id: '',
            training_unit_id: '',
            supervising_attending_id: '',
            rotation_start_date: '',
            rotation_end_date: '',
            rotation_category: 'clinical_rotation',
            clinical_notes: ''
        });
        
        const assignmentForm = ref({
            assignment_date: '',
            assignment_type: 'outpatient_clinic',
            start_time: '08:00',
            end_time: '17:00',
            location_name: '',
            staff_member_id: '',
            supervising_attending_id: '',
            assignment_notes: ''
        });
        
        const leaveRequestForm = ref({
            leave_category: 'vacation_leave',
            staff_member_id: '',
            leave_start_date: '',
            leave_end_date: '',
            leave_reason: '',
            coverage_notes: '',
            coverage_required: true
        });
        
        const onCallForm = ref({
            duty_date: '',
            shift_type: 'primary_call',
            start_time: '17:00',
            end_time: '08:00',
            primary_physician_id: '',
            backup_physician_id: '',
            coverage_notes: ''
        });
        
        const announcementForm = ref({
            announcement_title: '',
            announcement_content: '',
            announcement_type: 'general_notice',
            priority_level: 'normal',
            publish_start_date: '',
            publish_end_date: '',
            visible_to_roles: []
        });
        
        
        // Editing State
        const editingMedicalStaff = ref(null);
        const editingTrainingUnit = ref(null);
        const editingPlacement = ref(null);
        const editingAnnouncement = ref(null);
        
        // Filters
        const staffFilter = ref({
            staff_type: '',
            employment_status: ''
        });
        const staffSearch = ref('');
        
        const rotationFilter = ref({
            rotation_status: '',
            start_date: '',
            end_date: ''
        });
        
        // Schedule
        const currentWeekStart = ref(new Date());
        const currentWeekEnd = ref(new Date());
        
        // Toast
        const toast = ref({
            show: false,
            message: '',
            icon: 'fas fa-info-circle',
            type: 'info'
        });
        
        // ============ UTILITY FUNCTIONS ============
        const showToast = (message, type = 'info') => {
            const icons = {
                info: 'fas fa-info-circle',
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle'
            };
            
            toast.value = {
                show: true,
                message,
                icon: icons[type] || icons.info,
                type: type
            };
            
            setTimeout(() => {
                toast.value.show = false;
            }, 4000);
        };
        
        const getInitials = (name) => {
            if (!name) return '??';
            return name
                .split(' ')
                .map(n => n[0])
                .join('')
                .toUpperCase()
                .substring(0, 2);
        };
        
        const formatDate = (dateString) => {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric'
            });
        };
        
        const formatDateShort = (dateString) => {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric'
            });
        };
        
        const formatDateTime = (dateTimeString) => {
            if (!dateTimeString) return '';
            const date = new Date(dateTimeString);
            return date.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        };
        
        const formatTime = (timeString) => {
            if (!timeString) return '';
            return timeString;
        };
        
        const formatTimeRange = (start, end) => {
            return `${formatTime(start)} - ${formatTime(end)}`;
        };
        
        const formatDateRange = (start, end) => {
            return `${formatDate(start)} - ${formatDate(end)}`;
        };
        
        const formatDayHeader = (dateString) => {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                weekday: 'long',
                month: 'short',
                day: 'numeric'
            });
        };
        
        const isToday = (dateString) => {
            const today = new Date().toISOString().split('T')[0];
            return dateString === today;
        };
        
        const generateSystemId = (prefix) => {
            const timestamp = Date.now().toString().slice(-6);
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            return `${prefix}-${timestamp}-${random}`;
        };
        
        const getUserRoleDisplay = (role) => {
            const roles = {
                resident_manager: 'Resident Manager',
                department_head: 'Head of Department',
                system_admin: 'System Administrator',
                viewing_doctor: 'Viewing Doctor'
            };
            return roles[role] || role;
        };
        
        const formatStaffType = (type) => {
            const types = {
                medical_resident: 'Medical Resident',
                attending_physician: 'Attending Physician',
                fellow: 'Fellow',
                nurse_practitioner: 'Nurse Practitioner',
                administrator: 'Administrator'
            };
            return types[type] || type;
        };
        
        const formatResidentCategory = (category) => {
            const categories = {
                department_internal: 'Department Internal',
                rotating_other_dept: 'Rotating - Other Dept',
                external_abroad: 'External/Abroad'
            };
            return categories[category] || category;
        };
        
        const formatEmploymentStatus = (status) => {
            const statuses = {
                active: 'Active',
                on_leave: 'On Leave',
                inactive: 'Inactive'
            };
            return statuses[status] || status;
        };
        
        const formatAnnouncementType = (type) => {
            const types = {
                general_notice: 'General Notice',
                training_opportunity: 'Training Opportunity',
                policy_update: 'Policy Update',
                schedule_change: 'Schedule Change',
                emergency_alert: 'Emergency Alert'
            };
            return types[type] || type;
        };
        
        const getStaffTypeClass = (type) => {
            const classes = {
                medical_resident: 'badge-resident',
                attending_physician: 'badge-attending',
                fellow: 'badge-resident',
                nurse_practitioner: 'badge-admin',
                administrator: 'badge-admin'
            };
            return classes[type] || 'badge-admin';
        };
        
        const getPriorityClass = (priority) => {
            const classes = {
                normal: 'status-completed',
                high: 'status-reported',
                urgent: 'status-busy'
            };
            return classes[priority] || 'status-completed';
        };
        
        const getRotationStatusClass = (status) => {
            const classes = {
                scheduled: 'status-reported',
                active: 'status-approved',
                completed: 'status-completed',
                extended: 'status-warning',
                terminated_early: 'status-busy'
            };
            return classes[status] || 'status-reported';
        };
        
        // ============ COMPUTED PROPERTIES ============
        // Permission Checks
        const canEditMedicalStaff = computed(() => {
            return ['resident_manager', 'department_head', 'system_admin'].includes(currentUser.value?.user_role);
        });
        
        const canEditTrainingUnits = computed(() => {
            return ['resident_manager', 'department_head', 'system_admin'].includes(currentUser.value?.user_role);
        });
        
        const canEditResidentRotations = computed(() => {
            return ['resident_manager', 'department_head', 'system_admin'].includes(currentUser.value?.user_role);
        });
        
        const canEditDailyAssignments = computed(() => {
            return ['resident_manager', 'department_head', 'system_admin'].includes(currentUser.value?.user_role);
        });
        
        const canEditOnCallSchedule = computed(() => {
            return ['resident_manager', 'department_head', 'system_admin'].includes(currentUser.value?.user_role);
        });
        
        const canCreateLeaveRequest = computed(() => {
            return currentUser.value !== null;
        });
        
        const canEditLeaveRequests = computed(() => {
            return ['resident_manager', 'department_head', 'system_admin'].includes(currentUser.value?.user_role);
        });
        
        const canApproveLeaveRequest = computed(() => {
            return ['department_head', 'system_admin'].includes(currentUser.value?.user_role);
        });
        
        const canEditAnnouncements = computed(() => {
            return ['department_head', 'system_admin'].includes(currentUser.value?.user_role);
        });
        
        // Stats for Dashboard
        const stats = computed(() => {
            const residents = medicalStaff.value.filter(s => s.staff_type === 'medical_resident' && s.employment_status === 'active');
            const attendings = medicalStaff.value.filter(s => s.staff_type === 'attending_physician' && s.employment_status === 'active');
            const supervisors = medicalStaff.value.filter(s => s.can_supervise_residents && s.employment_status === 'active');
            
            return {
                totalStaff: medicalStaff.value.length,
                activeResidents: residents.length,
                attendings: attendings.length,
                availableSupervisors: supervisors.length
            };
        });
        
        const hodStats = computed(() => {
            const residents = medicalStaff.value.filter(s => s.staff_type === 'medical_resident' && s.employment_status === 'active');
            const attendings = medicalStaff.value.filter(s => s.staff_type === 'attending_physician' && s.employment_status === 'active');
            const activeUnits = trainingUnits.value.filter(u => u.unit_status === 'active');
            const occupiedUnits = trainingUnits.value.filter(u => 
                (u.current_residents || 0) >= u.maximum_residents
            );
            
            return {
                totalStaff: medicalStaff.value.length,
                residents: residents.length,
                attendings: attendings.length,
                totalUnits: activeUnits.length,
                occupiedUnits: occupiedUnits.length,
                occupancyRate: activeUnits.length > 0 ? 
                    Math.round((occupiedUnits.length / activeUnits.length) * 100) : 0,
                coverageToday: 95,
                onLeave: leaveRequests.value.filter(l => l.approval_status === 'approved' && 
                    new Date(l.leave_end_date) >= new Date()).length,
                compliance: 92,
                dutyHourAlerts: 2
            };
        });
        
        const leaveStats = computed(() => {
            const pending = leaveRequests.value.filter(l => l.approval_status === 'pending_review').length;
            const active = leaveRequests.value.filter(l => l.approval_status === 'approved' && 
                new Date(l.leave_end_date) >= new Date()).length;
            const upcoming = leaveRequests.value.filter(l => l.approval_status === 'approved' && 
                new Date(l.leave_start_date) > new Date()).length;
            const needsCoverage = leaveRequests.value.filter(l => l.coverage_required && !l.coverage_assigned).length;
            const coverageAssigned = leaveRequests.value.filter(l => l.coverage_assigned).length;
            
            return {
                pending,
                active,
                upcoming,
                needsCoverage,
                coverageAssigned
            };
        });
        
        // Filtered Lists
        const filteredMedicalStaff = computed(() => {
            let filtered = medicalStaff.value;
            
            if (staffSearch.value) {
                const search = staffSearch.value.toLowerCase();
                filtered = filtered.filter(s => 
                    s.full_name.toLowerCase().includes(search) ||
                    s.staff_id.toLowerCase().includes(search)
                );
            }
            
            if (staffFilter.value.staff_type) {
                filtered = filtered.filter(s => s.staff_type === staffFilter.value.staff_type);
            }
            
            if (staffFilter.value.employment_status) {
                filtered = filtered.filter(s => s.employment_status === staffFilter.value.employment_status);
            }
            
            return filtered;
        });
        
        // Supervisors
        const supervisors = computed(() => {
            return medicalStaff.value.filter(s => 
                s.staff_type === 'attending_physician' && 
                s.can_supervise_residents && 
                s.employment_status === 'active'
            );
        });
        
        // Available residents for placement
        const unplacedResidents = computed(() => {
            const residentsWithActiveRotation = new Set(
                residentRotations.value
                    .filter(r => r.rotation_status === 'active' || r.rotation_status === 'scheduled')
                    .map(r => r.resident_id)
            );
            
            return medicalStaff.value.filter(s => 
                s.staff_type === 'medical_resident' && 
                s.employment_status === 'active' &&
                !residentsWithActiveRotation.has(s.id)
            );
        });
        
        // Available training units
        const availableUnits = computed(() => {
            return trainingUnits.value.filter(u => 
                u.unit_status === 'active' && 
                (u.current_residents || 0) < u.maximum_residents
            );
        });
        
        // Active placements
        const activePlacements = computed(() => {
            return residentRotations.value
                .filter(r => r.rotation_status === 'active' || r.rotation_status === 'scheduled')
                .map(r => ({
                    ...r,
                    resident_name: getResidentName(r.resident_id),
                    unit_name: getUnitName(r.training_unit_id),
                    supervisor_name: getSupervisorName(r.supervising_attending_id)
                }));
        });
        
        // Available staff for assignments
        const availableResidentsForAssignment = computed(() => {
            return medicalStaff.value.filter(s => 
                s.staff_type === 'medical_resident' && s.employment_status === 'active'
            );
        });
        
        const availableAttendingsForAssignment = computed(() => {
            return medicalStaff.value.filter(s => 
                s.staff_type === 'attending_physician' && s.employment_status === 'active'
            );
        });
        
        const otherStaffForAssignment = computed(() => {
            return medicalStaff.value.filter(s => 
                !['medical_resident', 'attending_physician'].includes(s.staff_type) && 
                s.employment_status === 'active'
            );
        });
        
        const availableResidentsForRotation = computed(() => {
            return medicalStaff.value.filter(s => 
                s.staff_type === 'medical_resident' && s.employment_status === 'active'
            );
        });
        
        const availableTrainingUnits = computed(() => {
            return trainingUnits.value.filter(u => u.unit_status === 'active');
        });
        
        const seniorResidents = computed(() => {
            return medicalStaff.value.filter(s => 
                s.staff_type === 'medical_resident' && 
                s.employment_status === 'active' &&
                parseInt(s.training_year) >= 3
            );
        });
        
        // All staff for leave requests
        const allResidents = computed(() => 
            medicalStaff.value.filter(s => s.staff_type === 'medical_resident' && s.employment_status === 'active')
        );
        const allAttendings = computed(() => 
            medicalStaff.value.filter(s => s.staff_type === 'attending_physician' && s.employment_status === 'active')
        );
        const allOtherStaff = computed(() => 
            medicalStaff.value.filter(s => 
                !['medical_resident', 'attending_physician'].includes(s.staff_type) && 
                s.employment_status === 'active'
            )
        );
        
        // For on-call assignments
        const availableAttendingsForOnCall = computed(() => availableAttendingsForAssignment.value);
        const availableResidentsForOnCall = computed(() => availableResidentsForAssignment.value);
        
        // Week days for schedule view
        const weekDays = computed(() => {
            const days = [];
            const start = new Date(currentWeekStart.value);
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(start);
                date.setDate(start.getDate() + i);
                
                days.push({
                    date: date.toISOString().split('T')[0],
                    day: date.toLocaleDateString('en-US', { weekday: 'short' }),
                    number: date.getDate()
                });
            }
            
            return days;
        });
        
        // On-call days
        const onCallDays = computed(() => {
            return weekDays.value.map(day => {
                const oncall = onCallSchedule.value.find(a => a.duty_date === day.date);
                return {
                    ...day,
                    oncall,
                    coverage_gap: oncall ? null : 'No on-call assigned'
                };
            });
        });
        
        // Pending leave requests
        const pendingLeaveRequests = computed(() => {
            return leaveRequests.value
                .filter(l => l.approval_status === 'pending_review')
                .map(request => ({
                    ...request,
                    staff_name: getStaffName(request.staff_member_id)
                }));
        });
        
        const activeLeave = computed(() => {
            const today = new Date().toISOString().split('T')[0];
            return leaveRequests.value
                .filter(l => l.approval_status === 'approved' && l.leave_end_date >= today)
                .map(request => ({
                    ...request,
                    staff_name: getStaffName(request.staff_member_id)
                }));
        });
        
        // Form helpers
        const isResidentSelected = computed(() => {
            const staffId = assignmentForm.value.staff_member_id;
            if (!staffId) return false;
            const staff = medicalStaff.value.find(s => s.id === staffId);
            return staff?.staff_type === 'medical_resident';
        });
        
        // ============ HELPER FUNCTIONS ============
        const getStaffName = (staffId) => {
            const staff = medicalStaff.value.find(s => s.id === staffId);
            return staff ? staff.full_name : 'Unknown';
        };
        
        const getResidentName = (residentId) => {
            const resident = medicalStaff.value.find(s => s.id === residentId);
            return resident ? resident.full_name : 'Unknown Resident';
        };
        
        const getUnitName = (unitId) => {
            const unit = trainingUnits.value.find(u => u.id === unitId);
            return unit ? unit.unit_name : 'Unknown Unit';
        };
        
        const getSupervisorName = (supervisorId) => {
            const supervisor = supervisors.value.find(s => s.id === supervisorId);
            return supervisor ? supervisor.full_name : 'Not Assigned';
        };
        
        const getUnitResidents = (unitId) => {
            const unitRotations = residentRotations.value.filter(r => 
                r.training_unit_id === unitId && 
                (r.rotation_status === 'active' || r.rotation_status === 'scheduled')
            );
            
            return unitRotations.map(r => {
                const resident = medicalStaff.value.find(s => s.id === r.resident_id);
                return resident ? {
                    ...resident,
                    supervising_attending_id: r.supervising_attending_id,
                    rotation_end_date: r.rotation_end_date
                } : null;
            }).filter(r => r);
        };
        
        const getSupervisorResidentsCount = (supervisorId) => {
            return residentRotations.value.filter(r => 
                r.supervising_attending_id === supervisorId && 
                (r.rotation_status === 'active' || r.rotation_status === 'scheduled')
            ).length;
        };
        
        const getAssignmentsForDay = (date) => {
            return dailyAssignments.value
                .filter(a => a.assignment_date === date)
                .map(assignment => {
                    const staff = medicalStaff.value.find(s => s.id === assignment.staff_member_id);
                    return {
                        ...assignment,
                        staff_name: staff ? staff.full_name : 'Unknown',
                        person_role: staff ? staff.staff_type : 'unknown',
                        supervisor_name: assignment.supervising_attending_id ? 
                            getSupervisorName(assignment.supervising_attending_id) : null
                    };
                });
        };
        
        const getDaysRemaining = (endDate) => {
            const today = new Date();
            const end = new Date(endDate);
            const diffTime = end - today;
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        };
        
        const getDaysRemainingClass = (endDate) => {
            const days = getDaysRemaining(endDate);
            if (days <= 7) return 'duty-hours critical';
            if (days <= 14) return 'duty-hours warning';
            return '';
        };
        
        // ============ NAVIGATION ============
        const switchView = async (view) => {
            currentView.value = view;
            closeMobileMenu();
            
            await loadViewData(view);
        };
        
        const getCurrentTitle = () => {
            const titles = {
                medical_staff: 'Medical Staff Management',
                training_units: 'Training Units',
                resident_rotations: 'Resident Rotations',
                placements: 'Resident Placements',
                department_overview: 'Department Overview',
                staff_management: 'Staff Management',
                schedule_approval: 'Schedule Approval',
                daily_assignments: 'Daily Assignments',
                oncall_schedule: 'On-call Schedule',
                leave_requests: 'Leave Requests',
                announcements: 'Announcements'
            };
            
            return titles[currentView.value] || 'PneumoCare Pro';
        };
        
        const getCurrentSubtitle = () => {
            const subtitles = {
                medical_staff: 'Manage medical staff and supervisors',
                training_units: 'Configure training units and capacities',
                resident_rotations: 'View and manage resident rotations',
                placements: 'Assign residents to training units',
                department_overview: 'Monitor department operations and metrics',
                staff_management: 'Manage department staff and roles',
                schedule_approval: 'Review and approve department schedules',
                daily_assignments: 'View and manage daily assignments',
                oncall_schedule: 'Manage on-call rotations and coverage',
                leave_requests: 'Handle leave requests and coverage arrangements',
                announcements: 'Department announcements and notifications'
            };
            
            return subtitles[currentView.value] || '';
        };
        
        const getSearchPlaceholder = () => {
            const placeholders = {
                medical_staff: 'Search medical staff by name or ID...',
                training_units: 'Search training units...',
                placements: 'Search placements...',
                daily_assignments: 'Search assignments...',
                leave_requests: 'Search leave requests...',
                announcements: 'Search announcements...'
            };
            
            return placeholders[currentView.value] || 'Search...';
        };
        
        const toggleMobileMenu = () => {
            mobileMenuOpen.value = !mobileMenuOpen.value;
        };
        
        const closeMobileMenu = () => {
            mobileMenuOpen.value = false;
        };
        
        const toggleUserMenu = () => {
            showToast('User menu would open here', 'info');
        };
        
        const handleSearch = () => {
            // Search is handled by computed properties
        };
        
        const handleStaffSearch = () => {
            // Search is handled by computed property
        };
        
        // ============ API FUNCTIONS ============
        
        // Authentication
        const handleLogin = async () => {
            loading.value = true;
            
            try {
                // Sign in with Supabase Auth
                const { data: authData, error: authError } = await supabase.auth.signInWithPassword({
                    email: loginForm.value.email,
                    password: loginForm.value.password
                });
                
                if (authError) throw authError;
                
                // Get user profile
                const { data: userData, error: userError } = await supabase
                    .from('app_users')
                    .select('*')
                    .eq('user_id', authData.user.id)
                    .single();
                
                if (userError) throw userError;
                
                currentUser.value = {
                    ...userData,
                    user_role: loginForm.value.user_role
                };
                
                // Load initial data
                await loadInitialData();
                
                // Set initial view based on role
                if (currentUser.value.user_role === 'resident_manager') {
                    currentView.value = 'medical_staff';
                } else if (currentUser.value.user_role === 'department_head') {
                    currentView.value = 'department_overview';
                }
                
                showToast(`Welcome, ${currentUser.value.full_name}!`, 'success');
                
            } catch (error) {
                console.error('Login error:', error);
                showToast('Login failed. Please check your credentials.', 'error');
            } finally {
                loading.value = false;
            }
        };
        
        // Load Initial Data
        const loadInitialData = async () => {
            loading.value = true;
            try {
                await Promise.all([
                    loadMedicalStaff(),
                    loadTrainingUnits(),
                    loadResidentRotations(),
                    loadDailyAssignments(),
                    loadLeaveRequests(),
                    loadOnCallSchedule(),
                    loadAnnouncements()
                ]);
            } catch (error) {
                console.error('Error loading initial data:', error);
                showToast('Error loading system data', 'error');
            } finally {
                loading.value = false;
            }
        };
        
        const loadViewData = async (view) => {
            try {
                switch (view) {
                    case 'medical_staff':
                        await loadMedicalStaff();
                        break;
                    case 'training_units':
                        await loadTrainingUnits();
                        break;
                    case 'resident_rotations':
                    case 'placements':
                        await loadResidentRotations();
                        break;
                    case 'daily_assignments':
                        await loadDailyAssignments();
                        break;
                    case 'oncall_schedule':
                        await loadOnCallSchedule();
                        break;
                    case 'leave_requests':
                        await loadLeaveRequests();
                        break;
                    case 'announcements':
                        await loadAnnouncements();
                        break;
                }
            } catch (error) {
                console.error(`Error loading ${view} data:`, error);
                showToast(`Error loading ${view} data`, 'error');
            }
        };
        
        // Medical Staff API
        const loadMedicalStaff = async () => {
            try {
                const { data, error } = await supabase
                    .from('medical_staff')
                    .select('*')
                    .order('full_name');
                
                if (error) throw error;
                medicalStaff.value = data;
            } catch (error) {
                console.error('Error loading medical staff:', error);
                throw error;
            }
        };
        
        const saveMedicalStaff = async () => {
            saving.value = true;
            
            try {
                if (editingMedicalStaff.value) {
                    // Update existing staff
                    const { error } = await supabase
                        .from('medical_staff')
                        .update(medicalStaffForm.value)
                        .eq('id', editingMedicalStaff.value);
                    
                    if (error) throw error;
                    showToast('Medical staff updated successfully', 'success');
                } else {
                    // Add new staff
                    const newStaff = {
                        ...medicalStaffForm.value,
                        staff_id: generateSystemId(medicalStaffForm.value.staff_type === 'medical_resident' ? 'RES' : 'STAFF')
                    };
                    
                    const { data, error } = await supabase
                        .from('medical_staff')
                        .insert([newStaff])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    medicalStaff.value.push(data);
                    showToast('Medical staff added successfully', 'success');
                }
                
                closeMedicalStaffModal();
                await loadMedicalStaff();
                
            } catch (error) {
                console.error('Error saving medical staff:', error);
                showToast('Error saving medical staff: ' + error.message, 'error');
            } finally {
                saving.value = false;
            }
        };
        
        const editMedicalStaff = (staff) => {
            editingMedicalStaff.value = staff.id;
            medicalStaffForm.value = { ...staff };
            showMedicalStaffModal.value = true;
        };
        
        const closeMedicalStaffModal = () => {
            showMedicalStaffModal.value = false;
            editingMedicalStaff.value = null;
            medicalStaffForm.value = {
                full_name: '',
                professional_email: '',
                staff_type: 'medical_resident',
                resident_category: 'department_internal',
                training_year: '1',
                primary_clinic: '',
                work_phone: '',
                can_supervise_residents: false,
                employment_status: 'active',
                special_notes: ''
            };
        };
        
        const handleStaffTypeChange = () => {
            if (medicalStaffForm.value.staff_type !== 'medical_resident') {
                medicalStaffForm.value.resident_category = null;
                medicalStaffForm.value.training_year = null;
            }
            if (medicalStaffForm.value.staff_type !== 'attending_physician') {
                medicalStaffForm.value.can_supervise_residents = false;
            }
        };
        
        // Training Units API
        const loadTrainingUnits = async () => {
            try {
                const { data, error } = await supabase
                    .from('training_units')
                    .select('*')
                    .order('unit_name');
                
                if (error) throw error;
                trainingUnits.value = data;
            } catch (error) {
                console.error('Error loading training units:', error);
                throw error;
            }
        };
        
        const saveTrainingUnit = async () => {
            saving.value = true;
            
            try {
                if (editingTrainingUnit.value) {
                    // Update existing unit
                    const { error } = await supabase
                        .from('training_units')
                        .update(trainingUnitForm.value)
                        .eq('id', editingTrainingUnit.value);
                    
                    if (error) throw error;
                    showToast('Training unit updated successfully', 'success');
                } else {
                    // Add new unit
                    const { data, error } = await supabase
                        .from('training_units')
                        .insert([trainingUnitForm.value])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    trainingUnits.value.push(data);
                    showToast('Training unit added successfully', 'success');
                }
                
                closeTrainingUnitModal();
                await loadTrainingUnits();
                
            } catch (error) {
                console.error('Error saving training unit:', error);
                showToast('Error saving training unit: ' + error.message, 'error');
            } finally {
                saving.value = false;
            }
        };
        
        const editTrainingUnit = (unit) => {
            editingTrainingUnit.value = unit.id;
            trainingUnitForm.value = { ...unit };
            showTrainingUnitModal.value = true;
        };
        
        const closeTrainingUnitModal = () => {
            showTrainingUnitModal.value = false;
            editingTrainingUnit.value = null;
            trainingUnitForm.value = {
                unit_code: '',
                unit_name: '',
                department_name: 'Pulmonology',
                maximum_residents: 4,
                default_supervisor_id: '',
                unit_description: '',
                unit_status: 'active'
            };
        };
        
        const toggleUnitStatus = async (unit) => {
            try {
                const newStatus = unit.unit_status === 'active' ? 'inactive' : 'active';
                const { error } = await supabase
                    .from('training_units')
                    .update({ unit_status: newStatus })
                    .eq('id', unit.id);
                
                if (error) throw error;
                
                unit.unit_status = newStatus;
                showToast(`Unit ${newStatus}`, 'success');
                
            } catch (error) {
                console.error('Error toggling unit status:', error);
                showToast('Error updating unit status', 'error');
            }
        };
        
        // Resident Rotations API
        const loadResidentRotations = async () => {
            try {
                let query = supabase
                    .from('resident_rotations')
                    .select('*')
                    .order('rotation_start_date', { ascending: false });
                
                // Apply filters
                if (rotationFilter.value.rotation_status) {
                    query = query.eq('rotation_status', rotationFilter.value.rotation_status);
                }
                if (rotationFilter.value.start_date) {
                    query = query.gte('rotation_start_date', rotationFilter.value.start_date);
                }
                if (rotationFilter.value.end_date) {
                    query = query.lte('rotation_end_date', rotationFilter.value.end_date);
                }
                
                const { data, error } = await query;
                
                if (error) throw error;
                residentRotations.value = data;
            } catch (error) {
                console.error('Error loading resident rotations:', error);
                throw error;
            }
        };
        
        const saveRotation = async () => {
            saving.value = true;
            
            try {
                const rotationData = {
                    ...rotationForm.value,
                    rotation_status: 'scheduled'
                };
                
                if (editingPlacement.value) {
                    // Update existing rotation
                    const { error } = await supabase
                        .from('resident_rotations')
                        .update(rotationData)
                        .eq('id', editingPlacement.value);
                    
                    if (error) throw error;
                    showToast('Rotation updated successfully', 'success');
                } else {
                    // Create new rotation
                    const newRotation = {
                        ...rotationData,
                        rotation_id: generateSystemId('ROT')
                    };
                    
                    const { data, error } = await supabase
                        .from('resident_rotations')
                        .insert([newRotation])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    residentRotations.value.unshift(data);
                    showToast('Rotation created successfully', 'success');
                }
                
                closePlacementModal();
                await loadTrainingUnits();
                
            } catch (error) {
                console.error('Error saving rotation:', error);
                showToast('Error saving rotation: ' + error.message, 'error');
            } finally {
                saving.value = false;
            }
        };
        
        const extendRotation = async (rotation) => {
            const newEndDate = prompt('Enter new end date (YYYY-MM-DD):', rotation.rotation_end_date);
            if (newEndDate) {
                try {
                    const { error } = await supabase
                        .from('resident_rotations')
                        .update({ 
                            rotation_end_date: newEndDate,
                            rotation_status: 'extended'
                        })
                        .eq('id', rotation.id);
                    
                    if (error) throw error;
                    
                    rotation.rotation_end_date = newEndDate;
                    rotation.rotation_status = 'extended';
                    showToast('Rotation extended successfully', 'success');
                    
                } catch (error) {
                    console.error('Error extending rotation:', error);
                    showToast('Error extending rotation', 'error');
                }
            }
        };
        
        const endRotation = async (rotation) => {
            if (confirm('End this rotation early?')) {
                try {
                    const { error } = await supabase
                        .from('resident_rotations')
                        .update({ 
                            rotation_end_date: new Date().toISOString().split('T')[0],
                            rotation_status: 'terminated_early',
                            clinical_notes: rotation.clinical_notes + ' (Ended early)'
                        })
                        .eq('id', rotation.id);
                    
                    if (error) throw error;
                    
                    rotation.rotation_status = 'terminated_early';
                    showToast('Rotation ended successfully', 'success');
                    await loadResidentRotations();
                    
                } catch (error) {
                    console.error('Error ending rotation:', error);
                    showToast('Error ending rotation', 'error');
                }
            }
        };
        
        // Daily Assignments API
        const loadDailyAssignments = async () => {
            try {
                const { data, error } = await supabase
                    .from('daily_assignments')
                    .select('*')
                    .order('assignment_date', { ascending: true });
                
                if (error) throw error;
                dailyAssignments.value = data;
            } catch (error) {
                console.error('Error loading daily assignments:', error);
                throw error;
            }
        };
        
        const saveAssignment = async () => {
            saving.value = true;
            
            try {
                const newAssignment = {
                    ...assignmentForm.value,
                    assignment_id: generateSystemId('ASSIGN')
                };
                
                const { data, error } = await supabase
                    .from('daily_assignments')
                    .insert([newAssignment])
                    .select()
                    .single();
                
                if (error) throw error;
                
                dailyAssignments.value.push(data);
                showToast('Assignment created successfully', 'success');
                closeAssignmentModal();
                
            } catch (error) {
                console.error('Error creating assignment:', error);
                showToast('Error creating assignment: ' + error.message, 'error');
            } finally {
                saving.value = false;
            }
        };
        
        const updateAssignmentSupervisor = () => {
            if (isResidentSelected.value && assignmentForm.value.staff_member_id) {
                const resident = medicalStaff.value.find(s => s.id === assignmentForm.value.staff_member_id);
                if (resident) {
                    // Find active rotation for this resident
                    const activeRotation = residentRotations.value.find(r => 
                        r.resident_id === resident.id && 
                        (r.rotation_status === 'active' || r.rotation_status === 'scheduled')
                    );
                    if (activeRotation) {
                        assignmentForm.value.supervising_attending_id = activeRotation.supervising_attending_id;
                    }
                }
            }
        };
        
        // Leave Requests API
        const loadLeaveRequests = async () => {
            try {
                const { data, error } = await supabase
                    .from('leave_requests')
                    .select('*')
                    .order('leave_start_date', { ascending: false });
                
                if (error) throw error;
                leaveRequests.value = data;
            } catch (error) {
                console.error('Error loading leave requests:', error);
                throw error;
            }
        };
        
        const saveLeaveRequest = async () => {
            saving.value = true;
            
            try {
                const newLeaveRequest = {
                    ...leaveRequestForm.value,
                    request_id: generateSystemId('LEAVE'),
                    total_days: Math.ceil(
                        (new Date(leaveRequestForm.value.leave_end_date) - 
                         new Date(leaveRequestForm.value.leave_start_date)) / 
                        (1000 * 60 * 60 * 24)
                    ) + 1,
                    approval_status: 'pending_review',
                    coverage_assigned: !leaveRequestForm.value.coverage_required
                };
                
                const { data, error } = await supabase
                    .from('leave_requests')
                    .insert([newLeaveRequest])
                    .select()
                    .single();
                
                if (error) throw error;
                
                leaveRequests.value.unshift(data);
                showToast('Leave request submitted successfully', 'success');
                closeLeaveModal();
                
            } catch (error) {
                console.error('Error submitting leave request:', error);
                showToast('Error submitting leave request: ' + error.message, 'error');
            } finally {
                saving.value = false;
            }
        };
        
        const approveLeaveRequest = async (request) => {
            try {
                const { error } = await supabase
                    .from('leave_requests')
                    .update({ 
                        approval_status: 'approved',
                        reviewed_by: currentUser.value.id,
                        reviewed_at: new Date().toISOString()
                    })
                    .eq('id', request.id);
                
                if (error) throw error;
                
                request.approval_status = 'approved';
                showToast('Leave request approved', 'success');
                
            } catch (error) {
                console.error('Error approving leave request:', error);
                showToast('Error approving leave request', 'error');
            }
        };
        
        const rejectLeaveRequest = async (request) => {
            try {
                const { error } = await supabase
                    .from('leave_requests')
                    .update({ 
                        approval_status: 'rejected',
                        reviewed_by: currentUser.value.id,
                        reviewed_at: new Date().toISOString()
                    })
                    .eq('id', request.id);
                
                if (error) throw error;
                
                request.approval_status = 'rejected';
                showToast('Leave request rejected', 'success');
                
            } catch (error) {
                console.error('Error rejecting leave request:', error);
                showToast('Error rejecting leave request', 'error');
            }
        };
        
        // On-call Schedule API
        const loadOnCallSchedule = async () => {
            try {
                const { data, error } = await supabase
                    .from('oncall_schedule')
                    .select('*')
                    .order('duty_date', { ascending: true });
                
                if (error) throw error;
                onCallSchedule.value = data;
            } catch (error) {
                console.error('Error loading on-call schedule:', error);
                throw error;
            }
        };
        
        const saveOnCallAssignment = async () => {
            saving.value = true;
            
            try {
                const newOnCall = {
                    ...onCallForm.value,
                    schedule_id: generateSystemId('ONCALL')
                };
                
                const { data, error } = await supabase
                    .from('oncall_schedule')
                    .insert([newOnCall])
                    .select()
                    .single();
                
                if (error) throw error;
                
                onCallSchedule.value.push(data);
                showToast('On-call assignment created successfully', 'success');
                closeOnCallModal();
                
            } catch (error) {
                console.error('Error creating on-call assignment:', error);
                showToast('Error creating on-call assignment: ' + error.message, 'error');
            } finally {
                saving.value = false;
            }
        };
        
        // Announcements API
        const loadAnnouncements = async () => {
            try {
                const today = new Date().toISOString().split('T')[0];
                const { data, error } = await supabase
                    .from('department_announcements')
                    .select('*')
                    .lte('publish_start_date', today)
                    .or(`publish_end_date.is.null,publish_end_date.gte.${today}`)
                    .order('priority_level', { ascending: false })
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                announcements.value = data;
            } catch (error) {
                console.error('Error loading announcements:', error);
                throw error;
            }
        };
        
        const saveAnnouncement = async () => {
            saving.value = true;
            
            try {
                const announcementData = {
                    ...announcementForm.value,
                    announcement_id: generateSystemId('ANN'),
                    created_by: currentUser.value.id,
                    visible_to_roles: JSON.stringify(announcementForm.value.visible_to_roles)
                };
                
                if (editingAnnouncement.value) {
                    // Update existing announcement
                    const { error } = await supabase
                        .from('department_announcements')
                        .update(announcementData)
                        .eq('id', editingAnnouncement.value);
                    
                    if (error) throw error;
                    showToast('Announcement updated successfully', 'success');
                } else {
                    // Create new announcement
                    const { data, error } = await supabase
                        .from('department_announcements')
                        .insert([announcementData])
                        .select()
                        .single();
                    
                    if (error) throw error;
                    announcements.value.unshift(data);
                    showToast('Announcement published successfully', 'success');
                }
                
                closeAnnouncementModal();
                
            } catch (error) {
                console.error('Error saving announcement:', error);
                showToast('Error saving announcement: ' + error.message, 'error');
            } finally {
                saving.value = false;
            }
        };
        
        const archiveAnnouncement = async (announcement) => {
            try {
                const { error } = await supabase
                    .from('department_announcements')
                    .update({ publish_end_date: new Date().toISOString().split('T')[0] })
                    .eq('id', announcement.id);
                
                if (error) throw error;
                
                announcement.publish_end_date = new Date().toISOString().split('T')[0];
                showToast('Announcement archived', 'success');
                
            } catch (error) {
                console.error('Error archiving announcement:', error);
                showToast('Error archiving announcement', 'error');
            }
        };
        
        // ============ UI FUNCTIONS ============
        
        // Medical Staff Management
        const showAddMedicalStaffModal = () => {
            editingMedicalStaff.value = null;
            medicalStaffForm.value = {
                full_name: '',
                professional_email: '',
                staff_type: 'medical_resident',
                resident_category: 'department_internal',
                training_year: '1',
                primary_clinic: '',
                work_phone: '',
                can_supervise_residents: false,
                employment_status: 'active',
                special_notes: ''
            };
            showMedicalStaffModal.value = true;
        };
        
        // Training Unit Management
        const showAddTrainingUnitModal = () => {
            editingTrainingUnit.value = null;
            trainingUnitForm.value = {
                unit_code: '',
                unit_name: '',
                department_name: 'Pulmonology',
                maximum_residents: 4,
                default_supervisor_id: '',
                unit_description: '',
                unit_status: 'active'
            };
            showTrainingUnitModal.value = true;
        };
        
        // Rotation/Placement Management
        const showNewRotationModal = () => {
            editingPlacement.value = null;
            const today = new Date();
            const threeMonthsLater = new Date();
            threeMonthsLater.setMonth(today.getMonth() + 3);
            
            rotationForm.value = {
                resident_id: '',
                training_unit_id: '',
                supervising_attending_id: '',
                rotation_start_date: today.toISOString().split('T')[0],
                rotation_end_date: threeMonthsLater.toISOString().split('T')[0],
                rotation_category: 'clinical_rotation',
                clinical_notes: ''
            };
            showPlacementModal.value = true;
        };
        
        const quickPlaceResident = (resident) => {
            const today = new Date();
            const threeMonthsLater = new Date();
            threeMonthsLater.setMonth(today.getMonth() + 3);
            
            rotationForm.value = {
                resident_id: resident.id,
                training_unit_id: '',
                supervising_attending_id: '',
                rotation_start_date: today.toISOString().split('T')[0],
                rotation_end_date: threeMonthsLater.toISOString().split('T')[0],
                rotation_category: 'clinical_rotation',
                clinical_notes: ''
            };
            showPlacementModal.value = true;
        };
        
        const editPlacement = (placement) => {
            editingPlacement.value = placement.id;
            rotationForm.value = {
                resident_id: placement.resident_id,
                training_unit_id: placement.training_unit_id,
                supervising_attending_id: placement.supervising_attending_id,
                rotation_start_date: placement.rotation_start_date,
                rotation_end_date: placement.rotation_end_date,
                rotation_category: placement.rotation_category,
                clinical_notes: placement.clinical_notes
            };
            showPlacementModal.value = true;
        };
        
        const closePlacementModal = () => {
            showPlacementModal.value = false;
            editingPlacement.value = null;
            rotationForm.value = {
                resident_id: '',
                training_unit_id: '',
                supervising_attending_id: '',
                rotation_start_date: '',
                rotation_end_date: '',
                rotation_category: 'clinical_rotation',
                clinical_notes: ''
            };
        };
        
        const updateDefaultSupervisor = () => {
            if (rotationForm.value.training_unit_id) {
                const unit = trainingUnits.value.find(u => u.id === rotationForm.value.training_unit_id);
                if (unit && unit.default_supervisor_id) {
                    rotationForm.value.supervising_attending_id = unit.default_supervisor_id;
                }
            }
        };
        
        // Daily Assignments
        const showNewAssignmentModal = () => {
            const today = new Date();
            assignmentForm.value = {
                assignment_date: today.toISOString().split('T')[0],
                assignment_type: 'outpatient_clinic',
                start_time: '08:00',
                end_time: '17:00',
                location_name: '',
                staff_member_id: '',
                supervising_attending_id: '',
                assignment_notes: ''
            };
            showAssignmentModal.value = true;
        };
        
        const closeAssignmentModal = () => {
            showAssignmentModal.value = false;
        };
        
        // Leave Requests
        const showNewLeaveModal = () => {
            const today = new Date();
            leaveRequestForm.value = {
                leave_category: 'vacation_leave',
                staff_member_id: '',
                leave_start_date: today.toISOString().split('T')[0],
                leave_end_date: today.toISOString().split('T')[0],
                leave_reason: '',
                coverage_notes: '',
                coverage_required: true
            };
            showLeaveModal.value = true;
        };
        
        const closeLeaveModal = () => {
            showLeaveModal.value = false;
        };
        
        // On-call Schedule
        const showNewOnCallModal = () => {
            const today = new Date();
            onCallForm.value = {
                duty_date: today.toISOString().split('T')[0],
                shift_type: 'primary_call',
                start_time: '17:00',
                end_time: '08:00',
                primary_physician_id: '',
                backup_physician_id: '',
                coverage_notes: ''
            };
            showOnCallModal.value = true;
        };
        
        const closeOnCallModal = () => {
            showOnCallModal.value = false;
        };
        
        // Announcements
        const showNewAnnouncementModal = () => {
            editingAnnouncement.value = null;
            const today = new Date();
            announcementForm.value = {
                announcement_title: '',
                announcement_content: '',
                announcement_type: 'general_notice',
                priority_level: 'normal',
                publish_start_date: today.toISOString().split('T')[0],
                publish_end_date: '',
                visible_to_roles: ['resident_manager', 'department_head', 'viewing_doctor']
            };
            showAnnouncementModal.value = true;
        };
        
        const editAnnouncement = (announcement) => {
            editingAnnouncement.value = announcement.id;
            announcementForm.value = {
                ...announcement,
                visible_to_roles: JSON.parse(announcement.visible_to_roles || '[]')
            };
            showAnnouncementModal.value = true;
        };
        
        const closeAnnouncementModal = () => {
            showAnnouncementModal.value = false;
            editingAnnouncement.value = null;
            announcementForm.value = {
                announcement_title: '',
                announcement_content: '',
                announcement_type: 'general_notice',
                priority_level: 'normal',
                publish_start_date: '',
                publish_end_date: '',
                visible_to_roles: []
            };
        };
        
        // Schedule Navigation
        const prevWeek = () => {
            const newStart = new Date(currentWeekStart.value);
            newStart.setDate(newStart.getDate() - 7);
            currentWeekStart.value = newStart;
            
            const newEnd = new Date(newStart);
            newEnd.setDate(newStart.getDate() + 6);
            currentWeekEnd.value = newEnd;
        };
        
        const nextWeek = () => {
            const newStart = new Date(currentWeekStart.value);
            newStart.setDate(newStart.getDate() + 7);
            currentWeekStart.value = newStart;
            
            const newEnd = new Date(newStart);
            newEnd.setDate(newStart.getDate() + 6);
            currentWeekEnd.value = newEnd;
        };
        
        const updateWeekRange = () => {
            const today = new Date();
            const dayOfWeek = today.getDay();
            const diff = today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1);
            
            const start = new Date(today);
            start.setDate(diff);
            start.setHours(0, 0, 0, 0);
            
            const end = new Date(start);
            end.setDate(start.getDate() + 6);
            
            currentWeekStart.value = start;
            currentWeekEnd.value = end;
        };
        
        // Drag & Drop for Placements
        let draggedResident = null;
        
        const dragResident = (resident) => {
            draggedResident = resident;
            event.target.classList.add('dragging');
        };
        
        const dragOverUnit = (event, unit) => {
            event.preventDefault();
            event.currentTarget.classList.add('drop-zone');
        };
        
        const dropResidentOnUnit = async (event, unit) => {
            event.preventDefault();
            event.currentTarget.classList.remove('drop-zone');
            
            if (draggedResident) {
                const today = new Date();
                const threeMonthsLater = new Date();
                threeMonthsLater.setMonth(today.getMonth() + 3);
                
                // Auto-fill rotation form
                rotationForm.value = {
                    resident_id: draggedResident.id,
                    training_unit_id: unit.id,
                    supervising_attending_id: unit.default_supervisor_id || '',
                    rotation_start_date: today.toISOString().split('T')[0],
                    rotation_end_date: threeMonthsLater.toISOString().split('T')[0],
                    rotation_category: 'clinical_rotation',
                    clinical_notes: 'Placed via drag & drop'
                };
                
                showPlacementModal.value = true;
            }
            
            draggedResident = null;
        };
        
        // Other UI Functions
        const viewStaffSchedule = (staff) => {
            showToast(`Schedule for ${staff.full_name} would open here`, 'info');
        };
        
        const assignCoverage = (request) => {
            showToast(`Coverage assignment for ${request.staff_name} would open here`, 'info');
        };
        
        const viewCoverageOptions = (request) => {
            showToast(`Coverage options for ${request.staff_name} would open here`, 'info');
        };
        
        const editLeaveRequest = (request) => {
            showToast(`Editing leave request for ${request.staff_name}`, 'info');
        };
        
        const exportDepartmentReport = () => {
            showToast('Department report exported', 'success');
        };
        
        // ============ INITIALIZATION ============
        onMounted(() => {
            // Set default dates
            const today = new Date();
            assignmentForm.value.assignment_date = today.toISOString().split('T')[0];
            leaveRequestForm.value.leave_start_date = today.toISOString().split('T')[0];
            leaveRequestForm.value.leave_end_date = today.toISOString().split('T')[0];
            onCallForm.value.duty_date = today.toISOString().split('T')[0];
            announcementForm.value.publish_start_date = today.toISOString().split('T')[0];
            
            // Update week range
            updateWeekRange();
        });
        
        // ============ RETURN ============
        return {
            // State
             supabase: supabaseClient, // ← ADD THIS LINE to your existing return statement
            currentUser,
            loginForm,
            loading,
            saving,
            currentView,
            sidebarCollapsed,
            mobileMenuOpen,
            searchQuery,
            
            // Data
            medicalStaff,
            trainingUnits,
            residentRotations,
            dailyAssignments,
            leaveRequests,
            onCallSchedule,
            announcements,
            
            // Modals
            showMedicalStaffModal,
            showTrainingUnitModal,
            showPlacementModal,
            showAssignmentModal,
            showLeaveModal,
            showOnCallModal,
            showAnnouncementModal,
            
            // Forms
            medicalStaffForm,
            trainingUnitForm,
            rotationForm,
            assignmentForm,
            leaveRequestForm,
            onCallForm,
            announcementForm,
            
            // Editing State
            editingMedicalStaff,
            editingTrainingUnit,
            editingPlacement,
            editingAnnouncement,
            
            // Filters
            staffFilter,
            staffSearch,
            rotationFilter,
            
            // UI
            toast,
            
            // Computed Properties
            stats,
            hodStats,
            leaveStats,
            filteredMedicalStaff,
            supervisors,
            unplacedResidents,
            availableUnits,
            activePlacements,
            availableResidentsForAssignment,
            availableAttendingsForAssignment,
            otherStaffForAssignment,
            availableResidentsForRotation,
            availableTrainingUnits,
            seniorResidents,
            allResidents,
            allAttendings,
            allOtherStaff,
            availableAttendingsForOnCall,
            availableResidentsForOnCall,
            weekDays,
            onCallDays,
            pendingLeaveRequests,
            activeLeave,
            isResidentSelected,
            
            // Permission Checks
            canEditMedicalStaff,
            canEditTrainingUnits,
            canEditResidentRotations,
            canEditDailyAssignments,
            canEditOnCallSchedule,
            canCreateLeaveRequest,
            canEditLeaveRequests,
            canApproveLeaveRequest,
            canEditAnnouncements,
            
            // Navigation
            switchView,
            getCurrentTitle,
            getCurrentSubtitle,
            getSearchPlaceholder,
            toggleMobileMenu,
            closeMobileMenu,
            toggleUserMenu,
            handleSearch,
            handleStaffSearch,
            
            // Authentication
            handleLogin,
            
            // Utility Functions
            getInitials,
            formatDate,
            formatDateShort,
            formatDateTime,
            formatTime,
            formatTimeRange,
            formatDateRange,
            formatDayHeader,
            isToday,
            getUserRoleDisplay,
            formatStaffType,
            formatResidentCategory,
            formatEmploymentStatus,
            formatAnnouncementType,
            getStaffTypeClass,
            getPriorityClass,
            getRotationStatusClass,
            
            // Medical Staff Management
            showAddMedicalStaffModal,
            editMedicalStaff,
            closeMedicalStaffModal,
            saveMedicalStaff,
            handleStaffTypeChange,
            viewStaffSchedule,
            
            // Training Unit Management
            showAddTrainingUnitModal,
            editTrainingUnit,
            closeTrainingUnitModal,
            saveTrainingUnit,
            toggleUnitStatus,
            getUnitResidents,
            getUnitName,
            
            // Rotation/Placement Management
            showNewRotationModal,
            quickPlaceResident,
            editPlacement,
            closePlacementModal,
            updateDefaultSupervisor,
            saveRotation,
            extendRotation,
            endRotation,
            getResidentName,
            getSupervisorName,
            getSupervisorResidentsCount,
            getDaysRemaining,
            getDaysRemainingClass,
            
            // Daily Assignments
            showNewAssignmentModal,
            closeAssignmentModal,
            updateAssignmentSupervisor,
            saveAssignment,
            getAssignmentsForDay,
            
            // Leave Management
            showNewLeaveModal,
            closeLeaveModal,
            saveLeaveRequest,
            approveLeaveRequest,
            rejectLeaveRequest,
            assignCoverage,
            viewCoverageOptions,
            editLeaveRequest,
            
            // On-call Management
            showNewOnCallModal,
            closeOnCallModal,
            saveOnCallAssignment,
            
            // Announcements
            showNewAnnouncementModal,
            editAnnouncement,
            closeAnnouncementModal,
            saveAnnouncement,
            archiveAnnouncement,
            
            // Schedule Navigation
            prevWeek,
            nextWeek,
            
            // Drag & Drop
            dragResident,
            dragOverUnit,
            dropResidentOnUnit,
            
            // Other UI Functions
            exportDepartmentReport
        };
    }
}).mount('#app');
</script>
</body>
</html>
